<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ì„±ê³¼ê´€ë¦¬ ë©´ë‹´ ì‹œë®¬ë ˆì´í„°</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

          body {
  font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, sans-serif;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  min-height: 100vh; display: flex; align-items: center; justify-content: center;
  padding: 20px;
}

/* ë ˆí¬íŠ¸ ë³¸ë¬¸: ì¤„ë°”ê¿ˆ ë³´ì¡´ + ì•½ê°„ ì—¬ë°± */
#modalSummaryContent {
  white-space: pre-line;   /* \n ì¤„ë°”ê¿ˆ ìœ ì§€ */
  letter-spacing: 0.1px;   /* ê°€ë…ì„± ë¯¸ì„¸ ê°œì„  */
}


/* ===== [ìˆ˜ì •] í‰ê°€ ì„¹ì…˜(A,B,C,D) ì „ìš© ìŠ¤íƒ€ì¼ ===== */
/* ===== í‰ê°€ ì„¹ì…˜(A,B,C,D) ì „ìš© ìŠ¤íƒ€ì¼ ===== */
.evaluation-item {
    margin-bottom: 16px; /* Aì™€ B, Bì™€ C ë“± ê° í•­ëª© ì‚¬ì´ì˜ ê°„ê²©ì„ ë§Œë“­ë‹ˆë‹¤. */
}
.evaluation-item:last-child {
    margin-bottom: 0; /* ë§ˆì§€ë§‰ í•­ëª© ë’¤ì—ëŠ” ê°„ê²©ì„ ì£¼ì§€ ì•ŠìŠµë‹ˆë‹¤. */
}

.evaluation-item strong {
    display: block; /* ì œëª©ì„ í•œ ì¤„ë¡œ ë…ë¦½ì‹œí‚µë‹ˆë‹¤. */
    font-size: 16px;
    font-weight: 700;
    margin-bottom: 3px; /* ì œëª©ê³¼ ë‚´ìš© ì‚¬ì´ì˜ ì‘ì€ ê°„ê²© */
}

.evaluation-item .evaluation-description {
    margin: 0; /* ë¸Œë¼ìš°ì € ê¸°ë³¸ ì—¬ë°± ì œê±° */
    padding-left: 20px; /* ë“¤ì—¬ì“°ê¸° íš¨ê³¼ */
    border-left: 3px solid #e9ecef; /* ì™¼ìª½ì— êµ¬ë¶„ì„  ì¶”ê°€ */
    color: #495057;
    line-height: 1.4;
}



    .container { width: 100%; max-width: 1200px; margin: 0 auto; }
    .hidden { display: none !important; }

    /* ===== Hero (Start) ===== */
    .hero {
      position: relative; width: 100%; max-width: 820px; margin: 0 auto;
      background: #fff; border-radius: 18px; overflow: hidden;
      box-shadow: 0 10px 30px rgba(0,0,0,0.12);
    }
    .hero-wrap { position: relative; width: 100%; padding-top: 58%; }
    .hero-img {
      position: absolute; inset: 0; width: 100%; height: 100%; object-fit: cover; display: block;
      filter: brightness(0.75);
    }
    .hero-text-content {
      position: absolute; top: 8%; left: 50%; transform: translateX(-50%);
      color: #fff; text-align: center; width: 92%; text-shadow: 0 2px 4px rgba(0,0,0,0.5);
    }
    .hero-text-content h1 { font-size: 2rem; margin-bottom: .6rem; }
    .hero-text-content p { font-size: 1.05rem; opacity: .95; }
    .start-btn-center {
      position: absolute; bottom: 8%; left: 50%; transform: translateX(-50%);
      padding: 14px 38px; border-radius: 999px; border: 2px solid #fff;
      font-weight: 700; font-size: 1.05rem; color: #fff; background: rgba(0,0,0,.2);
      cursor: pointer; transition: all .25s ease;
    }
    .start-btn-center:hover { background: #fff; color: #333; }

    /* ===== Content Cards & Layout ===== */
    .content {
      background: #fff; border-radius: 16px; padding: 28px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }
    .selection-grid {
      display: grid; gap: 18px; grid-template-columns: repeat(2, 1fr);
    }
    .card {
      position: relative; background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      border-radius: 16px; padding: 18px; cursor: pointer; transition: .25s ease;
      border: 2px solid transparent; min-height: 140px; overflow: hidden;
      display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center;
    }
    .card:hover { transform: translateY(-4px); box-shadow: 0 10px 24px rgba(0,0,0,.18); border-color: #667eea; }
    .card h3 { font-size: 18px; color: #222; margin-top: 10px; }
    .card p { font-size: 13px; color: #555; margin-top: 6px; }

    .info-badge {
      position: absolute; top: 10px; right: 10px;
      background: #667eea; color: #fff; padding: 5px 10px; border-radius: 999px;
      font-size: 12px; font-weight: 600;
    }

    /* Persona circular image */
    .avatar-round {
      width: 84px; height: 84px; border-radius: 50%; object-fit: cover;
      border: 3px solid rgba(255,255,255,0.9); box-shadow: 0 4px 10px rgba(0,0,0,0.12);
      background: #fff;
    }

    /* Buttons */
    .back-button {
      appearance: none; background: #6c757d; color: #fff;
      border: none; padding: 10px 18px; border-radius: 10px; cursor: pointer; font-size: 14px;
      transition: .25s ease;
    }
    .back-button:hover { background: #5a6268; transform: translateY(-1px); }
    .start-button {
      appearance: none; border: none; border-radius: 10px; color: #fff; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 12px 22px; font-weight: 700; font-size: 15px; cursor: pointer; transition: .25s ease;
    }
    .start-button:hover { transform: scale(1.03); box-shadow: 0 5px 15px rgba(102,126,234,0.35); }

    /* ===== Advanced persona form ===== */
    .advanced-form { animation: fadeIn .25s ease; }
    .form-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; }
    .form-group { display: flex; flex-direction: column; }
    .form-group.full-width { grid-column: 1 / -1; }
    .form-group label { font-size: 13px; font-weight: 700; color: #444; margin-bottom: 6px; }
    .form-group input, .form-group select {
      width: 100%; padding: 10px 12px; border-radius: 8px; border: 1px solid #ccc; font-size: 14px;
    }
/* ===== EXHIBITION READABILITY IMPROVEMENTS (Global) ===== */

/* ===== [ì‹ ê·œ ì¶”ê°€] ë©´ë‹´ ë°°ì›Œë³´ê¸° ì¹´ë“œ ìŠ¤íƒ€ì¼ ===== */
.tip-card-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); /* ë°˜ì‘í˜• ê·¸ë¦¬ë“œ */
    gap: 15px; /* ì¹´ë“œ ì‚¬ì´ ê°„ê²© */
    margin-top: 10px;
}

.tip-card {
    background-color: #ffffff;
    border: 1px solid #dee2e6;
    border-radius: 12px;
    padding: 14px 18px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

.tip-card h5 {
    font-size: 16px;
    font-weight: 700;
    color: #343a40;
    margin-bottom: 12px;
}

.tip-card ul {
    list-style-type: none; /* ê¸°ë³¸ ë¶ˆë¦¿ ì œê±° */
    padding-left: 0;
}

.tip-card li {
    position: relative;
    padding-left: 22px; /* ì•„ì´ì½˜ ë“¤ì–´ê°ˆ ê³µê°„ í™•ë³´ */
    margin-bottom: 8px;
    color: #495057;
    line-height: 1.5;
}

/* ë¦¬ìŠ¤íŠ¸ ì•„ì´í…œ ì• ì•„ì´ì½˜ ìŠ¤íƒ€ì¼ */
.tip-card li::before {
    content: 'âœ…'; /* ê¸°ë³¸ ì•„ì´ì½˜ */
    position: absolute;
    left: 0;
    top: 2px;
    font-size: 14px;
}


/* ì „ì²´ í°íŠ¸ í¬ê¸° ê¸°ë³¸ê°’ ìƒí–¥ ì¡°ì • */
body {
  font-size: 17px; /* ê¸°ì¡´ í°íŠ¸ë³´ë‹¤ ì•½ê°„ í¬ê²Œ ì„¤ì • */
}

/* ì£¼ìš” ì œëª©(Hero h1) í¬ê¸° í™•ëŒ€ */
.hero-text-content h1 {
  font-size: 2.5rem; /* ê¸°ì¡´ 2remì—ì„œ í™•ëŒ€ */
  margin-bottom: 0.8rem;
}
.hero-content h1 {
  font-size: 2.5rem; /* Hero Stack íƒ€ì…ì˜ ì œëª©ë„ í™•ëŒ€ */
  margin-bottom: 10px;
}
.hero-text-content p, .hero-content p {
  font-size: 1.2rem; /* Hero ì„¤ëª… í…ìŠ¤íŠ¸ í™•ëŒ€ */
}
.start-btn-center, .hero--split .start-btn, .hero-content .start-btn {
  padding: 16px 40px; /* ì‹œì‘ ë²„íŠ¼ íŒ¨ë”© ì¦ê°€ */
  font-size: 1.2rem; /* ì‹œì‘ ë²„íŠ¼ í°íŠ¸ í™•ëŒ€ */
}


/* Content Card ì œëª© ë° ì„¤ëª… í™•ëŒ€ */
.card h3 {
  font-size: 20px; /* ì¹´ë“œ ì œëª© í™•ëŒ€ */
  margin-top: 12px;
}
.card p {
  font-size: 15px; /* ì¹´ë“œ ì„¤ëª… í™•ëŒ€ */
  margin-top: 8px;
}
.info-badge {
  font-size: 13px; /* ì •ë³´ ë±ƒì§€ í°íŠ¸ í™•ëŒ€ */
  padding: 6px 11px;
}
.avatar-round {
  width: 92px; /* ì•„ë°”íƒ€ ì´ë¯¸ì§€ í¬ê¸° ì•½ê°„ í™•ëŒ€ */
  height: 92px;
}

/* ë²„íŠ¼ í°íŠ¸ ë° íŒ¨ë”© í™•ëŒ€ */
.back-button, .start-button {
  font-size: 15px; /* ì¼ë°˜ ë²„íŠ¼ í°íŠ¸ í™•ëŒ€ */
  padding: 12px 20px;
}

/* Chat UI í°íŠ¸ í¬ê¸° ë° ê°„ê²© ì¡°ì • */
.bubble {
  font-size: 15px; /* ì±„íŒ… ë²„ë¸” í°íŠ¸ í™•ëŒ€ */
  padding: 12px 16px;
}
.bubble { line-height: 1.6; }  /* ì¤„ ë†’ì´ë¡œ ì½ê¸° í¸í•˜ê²Œ */

.input input {
  font-size: 15px; /* ì±„íŒ… ì…ë ¥ì°½ í°íŠ¸ í™•ëŒ€ */
  padding: 14px 18px; /* ì…ë ¥ì°½ ë†’ì´ ì¦ê°€ */
}
.input button {
  font-size: 14px; /* ì±„íŒ… ì „ì†¡/ì¢…ë£Œ ë²„íŠ¼ í°íŠ¸ í™•ëŒ€ */
  padding: 11px 18px;
}
.name {
  font-size: 11px; /* ì´ë¦„ ë¼ë²¨ í°íŠ¸ í™•ëŒ€ */
  margin-left: 62px; /* ì•„ë°”íƒ€ í¬ê¸° ë³€ê²½ì— ë”°ë¥¸ ì´ë¦„ ìœ„ì¹˜ ì¡°ì • */
}
.chat .avatar {
  width: 55px; /* ì±„íŒ… ì•„ë°”íƒ€ í¬ê¸° í™•ëŒ€ */
  height: 55px;
  flex: 0 0 55px;
}

/* Coach Tip í°íŠ¸ í™•ëŒ€ ë° ê°„ê²© ì¡°ì • */
.coach-tip-new {
  font-size: 15px; /* ì½”ì¹˜ íŒ ë³¸ë¬¸ í°íŠ¸ í™•ëŒ€ */
  padding: 18px;
}
.coach-choice {
  font-size: 14px; /* ì½”ì¹˜ íŒ ì„ íƒì§€ í°íŠ¸ í™•ëŒ€ */
  padding: 11px 14px;
}
.coach-analysis {
  margin-bottom: 14px;
}

/* ëª¨ë‹¬ ì œëª© ë° ë‚´ìš© í™•ëŒ€ */
.modal-content h3 {
  font-size: 24px; /* ëª¨ë‹¬ ì œëª© í™•ëŒ€ */
  margin-bottom: 16px;
  padding-bottom: 14px;
}
.evaluation-score {
  font-size: 20px; /* ì¢…í•© ì ìˆ˜ í™•ëŒ€ */
}
.modal-summary-content {
  font-size: 16px; /* ëª¨ë‹¬ ìš”ì•½ ë‚´ìš© í™•ëŒ€ */
  line-height: 1.9; /* ì¤„ ê°„ê²© í™•ëŒ€ */
  padding: 12px;
}
.modal-actions button {
  font-size: 15px; /* ëª¨ë‹¬ ë²„íŠ¼ í°íŠ¸ í™•ëŒ€ */
  padding: 11px 18px;
}

/* ì¹´í…Œê³ ë¦¬ ë³´ë“œ í…ìŠ¤íŠ¸ í™•ëŒ€ */
.cat .label {
  font-size: 14px; /* ì¹´í…Œê³ ë¦¬ ë¼ë²¨ í°íŠ¸ í™•ëŒ€ */
}
.cat .score {
  font-size: 13px; /* ì¹´í…Œê³ ë¦¬ ì ìˆ˜ í°íŠ¸ í™•ëŒ€ */
}


/* ë¯¸ë””ì–´ ì¿¼ë¦¬ ì¡°ì • (ëª¨ë°”ì¼ì—ì„œë„ ê¸€ì”¨ í¬ê¸° ìœ ì§€) */
@media (max-width: 640px) {
  .hero-text-content h1 { font-size: 2rem; } /* ëª¨ë°”ì¼ Hero ì œëª© ì¡°ì • */
  .hero-content h1 { font-size: 2rem; }
  .hero-text-content p, .hero-content p { font-size: 1.1rem; }
  .start-btn-center, .hero--split .start-btn, .hero-content .start-btn {
    padding: 14px 30px;
    font-size: 1.1rem;
  }
}


/* ===== Advanced persona form READABILITY IMPROVEMENTS (ê°•í™”) ===== */
.form-grid {
  gap: 20px 18px; /* í•­ëª© ê°„ ê°„ê²© ì¡°ì • */
}
.form-group label {
  font-size: 16px;      /* ë¼ë²¨ í°íŠ¸ í¬ê¸° ì¦ê°€ */
  color: #333;
  margin-bottom: 10px;   /* ë¼ë²¨ê³¼ ë“œë¡­ë°•ìŠ¤ ì‚¬ì´ ê°„ê²© ì¦ê°€ */
}
.form-group input,
.form-group select {
  width: 100%;
  padding: 16px 14px;   /* ë“œë¡­ë°•ìŠ¤ ë° ì…ë ¥ì°½ ë†’ì´ ë” ì¦ê°€ */
  border-radius: 10px;  /* ëª¨ì„œë¦¬ ë‘¥ê¸€ê²Œ */
  border: 1px solid #bbb; /* í…Œë‘ë¦¬ ìƒ‰ìƒ ì¡°ì • */
  font-size: 17px;      /* ì…ë ¥ì°½/ë“œë¡­ë°•ìŠ¤ í°íŠ¸ í¬ê¸° ì¦ê°€ */
  appearance: none;     /* ë¸Œë¼ìš°ì € ê¸°ë³¸ ë“œë¡­ë°•ìŠ¤ ìŠ¤íƒ€ì¼ ì œê±° (í™”ì‚´í‘œ ì»¤ìŠ¤í…€ì„ ìœ„í•´) */
  background-color: #f8f8f8; /* ë°°ê²½ìƒ‰ ì¶”ê°€ */
  cursor: pointer;      /* ë§ˆìš°ìŠ¤ ì˜¤ë²„ ì‹œ ì»¤ì„œ ë³€ê²½ */
  transition: all 0.2s ease; /* ë¶€ë“œëŸ¬ìš´ ì „í™˜ íš¨ê³¼ */
}

/* ë“œë¡­ë°•ìŠ¤ í™”ì‚´í‘œ ì»¤ìŠ¤í…€ (appearance: none ë•Œë¬¸ì— í•„ìš”) */
.form-group select {
  background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23666666%22%20d%3D%22M287%20169.16l-11.45%2011.45L146.2%2056.45%2011.45%20169.16%200%20157.71l146.2-146.2%20146.2%20146.2z%22%2F%3E%3C%2Fsvg%3E');
  background-repeat: no-repeat;
  background-position: right 14px center; /* í™”ì‚´í‘œ ìœ„ì¹˜ ì¡°ì • */
  background-size: 14px; /* í™”ì‚´í‘œ í¬ê¸° ì¡°ì • */
}


/* í¬ì»¤ìŠ¤ ì‹œ ìŠ¤íƒ€ì¼ ë³€ê²½ (ì„ íƒí•˜ê¸° í¸í•˜ë„ë¡ ì‹œê°ì  ê°•ì¡°) */
.form-group input:focus,
.form-group select:focus {
  border-color: #667eea; /* í¬ì»¤ìŠ¤ ì‹œ í…Œë‘ë¦¬ ìƒ‰ìƒ ê°•ì¡° */
  box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.2); /* í¬ì»¤ìŠ¤ ì‹œ ê·¸ë¦¼ì íš¨ê³¼ */
  background-color: #fff; /* í¬ì»¤ìŠ¤ ì‹œ ë°°ê²½ìƒ‰ ë³€ê²½ */
  outline: none; /* ê¸°ë³¸ ì•„ì›ƒë¼ì¸ ì œê±° */
}

/* í˜¸ë²„ ì‹œ ìŠ¤íƒ€ì¼ ë³€ê²½ */
.form-group select:hover {
  border-color: #8899ee; /* í˜¸ë²„ ì‹œ í…Œë‘ë¦¬ ìƒ‰ìƒ ë³€ê²½ */
  background-color: #f0f0f0;
}

    /* ===== Chat (kept intact) ===== */
    .chat { display: none; grid-template-rows: auto 1fr auto auto; gap:15px; height: 85vh;
      background:#fff; border-radius:15px; padding:20px; box-shadow:0 5px 20px rgba(0,0,0,0.1); }
    .messages { background:#F6F7F9; border:1px solid #E8EAED; border-radius:12px; padding:16px; overflow-y:auto; height:100%; }
    .row { display:flex; gap:8px; margin:8px 0; align-items:flex-start; }
    .row.user { justify-content:flex-end; }
    .row.bot { justify-content:flex-start; }
    .avatar { width: 50px; height: 50px; border-radius: 50%; flex: 0 0 50px; overflow: hidden; }
    .avatar img { width: 100%; height: 100%; border-radius: 50%; object-fit: cover; }
    .name { font-size:10px; color:#666; margin-left:58px; margin-top:-4px; font-weight:500; }
    .bubble { max-width:70%; padding:10px 14px; border-radius:18px; font-size:14px; line-height:1.4; box-shadow:0 2px 8px rgba(0,0,0,0.08); word-wrap:break-word; }
    .bubble.user { background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:#fff; border-bottom-right-radius:4px; }
    .bubble.bot { background:#fff; color:#333; border-bottom-left-radius:4px; border:1px solid #f0f0f0; }
    .input { display:flex; gap:8px; align-items:center; }
    .input input { flex:1; border:2px solid #E8EAED; border-radius:25px; padding:12px 16px; font-size:14px; outline:none; transition:border-color 0.3s; }
    .input input:focus { border-color:#667eea; box-shadow:0 0 0 3px rgba(102,126,234,0.1); }
    .input button { appearance:none; border:0; border-radius:20px; padding:10px 16px; font-weight:600; font-size:13px; background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:#fff; cursor:pointer; transition:transform 0.2s; }
    .input button:hover { transform:scale(1.02); }
    .input button:active { transform:scale(0.98); }
    .typing { background:#fff; border-radius:18px; border-bottom-left-radius:4px; padding:8px 12px; width:fit-content; box-shadow:0 2px 8px rgba(0,0,0,0.08); border:1px solid #f0f0f0; }
    .dots { display:inline-grid; grid-auto-flow:column; gap:3px; }
    .dots span { width:5px; height:5px; background:#bbb; border-radius:50%; animation: blink 1.2s infinite; }
    .dots span:nth-child(2){ animation-delay: .2s; }
    .dots span:nth-child(3){ animation-delay: .4s; }
    @keyframes blink { 0%,80%,100%{opacity:.3} 40%{opacity:1} }
    .summary { display:none; background:#f8fff8; border:1px solid #d4edda; border-radius:10px; padding:15px; font-size:13px; line-height:1.5; max-height:150px; overflow-y:auto; }

    /* === Coach tip styles (kept) === */
    .coach-tip-new {
      font-size: 14px; color: #333; background: #f8f9fa; border: 1px solid #e9ecef;
      border-radius: 18px; border-bottom-left-radius: 4px; padding: 15px; max-width: 70%;
      line-height: 1.6; box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    .coach-analysis { margin-bottom: 12px; }
    .coach-choices { border-top: 1px dashed #dfe7e3; padding-top: 12px; display: flex; flex-direction: column; gap: 8px; }
    .coach-choice { background: #fff; border: 1px solid #dfe7e3; border-radius: 10px; padding: 10px 12px; cursor: pointer; transition: background-color .2s, box-shadow .2s; font-size: 13px; color: #0056b3; }
    .coach-choice:hover { background: #e9f5ff; border-color: #b3d7ff; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
    .coach-choice.disabled { cursor: default; background: #f8f9fa; color: #6c757d; opacity: .7; text-decoration: line-through; }
    .row.coach { align-items: flex-start; }

    /* === Modal (summary) === */
    .modal {
      display: none; position: fixed; z-index: 1000; inset: 0;
      background: rgba(0,0,0,.6); justify-content: center; align-items: center;
    }
    .modal-content {
      background: #fff; padding: 26px; border-radius: 16px; width: 92%; max-width: 820px; max-height: 85vh;
      display: flex; flex-direction: column;
    }
    .modal-content h3 { margin-bottom: 14px; font-size: 22px; color: #333; text-align: center; border-bottom: 2px solid #eee; padding-bottom: 12px; }
    .evaluation-signal { display: flex; align-items: center; gap: 12px; padding-bottom: 12px; margin-bottom: 12px; border-bottom: 1px solid #eee; }
    .traffic-light { width: 24px; height: 24px; border-radius: 50%; background: #ddd; }
    .traffic-light.green { background: #28a745; } .traffic-light.yellow { background: #ffc107; } .traffic-light.red { background: #dc3545; }
    .evaluation-score { font-size: 18px; font-weight: 800; color: #333; }
    .modal-summary-content { flex: 1; overflow-y: auto; line-height: 1.8; font-size: 15px; padding: 10px; background: #f8f9fa; border: 1px solid #e9ecef; border-radius: 8px; }
    .modal-actions { margin-top: 18px; display: flex; gap: 8px; justify-content: flex-end; flex-wrap: wrap; }
    .modal-actions button { padding: 10px 16px; border: none; border-radius: 8px; font-size: 14px; font-weight: 700; cursor: pointer; }
    .btn-download { background: #28a745; color: #fff; } .btn-email { background: #007bff; color: #fff; } .btn-back { background: #6c757d; color: #fff; }

    /* Mic button */
    #recordButton { width: 40px; height: 40px; border-radius: 50%; padding: 0; font-size: 18px; background: #f1f2f6; color: #57606f; border: 1px solid #dcdde1; }
    #recordButton.recording { background: #e84118; color: #fff; border-color: #c23616; animation: pulse 1.5s infinite; }
    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(232,65,24,0.4); }
      70% { box-shadow: 0 0 0 10px rgba(232,65,24,0); }
      100% { box-shadow: 0 0 0 0 rgba(232,65,24,0); }
    }
/* === Category board (ê´€ê³„/ê³¼ì •/ì„±ê³¼) === */
    .category-board {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      margin: 6px 0 12px;
    }
    @media (min-width: 720px){ .category-board { grid-template-columns: 1fr 1fr 1fr; } }
    .cat {
      display:flex; align-items:center; gap:10px;
      padding: 8px 10px; border:1px solid #eee; border-radius:10px; background:#fff;
    }
    .cat .traffic-light { width:12px; height:12px; }
    .cat .label { flex:1; font-weight:600; font-size:13px; color:#333; }
    .cat .score { font-size:12px; color:#666; }

    @media (max-width: 640px) {
      .hero-wrap { padding-top: 72%; }
      .hero-text-content h1 { font-size: 1.6rem; }
      .selection-grid { grid-template-columns: 1fr; }
      .form-grid { grid-template-columns: 1fr; }
    }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(6px); } to { opacity: 1; transform: translateY(0); } }
  
/* === HERO SPLIT (2-column) === */
.hero.hero--split{ background: transparent; box-shadow: none; }
.hero--split .hero-inner{
  display: grid; grid-template-columns: 0.8fr 1.2fr;
  align-items: center; gap: 28px;
  background: #fff; border-radius: 18px; padding: 32px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.12);
}
.hero--split .hero-left h1{ font-size: 2.2rem; margin-bottom: 10px; }
.hero--split .hero-left p{ font-size: 1.05rem; opacity: .9; }
.hero--split .start-btn{
  margin-top: 16px; padding: 12px 28px; border-radius: 999px;
  border: 2px solid #667eea;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: #fff; font-weight: 700; font-size: 1.05rem; cursor: pointer;
  transition: .25s ease;
}
.hero--split .start-btn:hover{ transform: translateY(-1px); box-shadow: 0 8px 22px rgba(102,126,234,0.35); }
.hero--split .hero-right img{
  width: 100%; height: auto; display: block; border-radius: 12px;
}
@media (max-width: 800px){
  .hero--split .hero-inner{ grid-template-columns: 1fr; padding: 22px; text-align: center; }
  .hero--split .hero-right{ order: -1; }
}


/* === HERO STACK (image top, content bottom) === */
.hero.hero--stack{ background: transparent; box-shadow: none; }
.hero-card{
  background:#fff; border-radius: 18px; overflow: hidden;
  box-shadow: 0 10px 30px rgba(0,0,0,0.12);
  max-width: 1200px; margin: 0 auto;
}
.hero-media{ aspect-ratio: 16/9; background:#2d2a4a; }
.hero-media img{ width:100%; height:100%; object-fit: cover; display:block; }
.hero-content{ text-align:center; padding: 22px 24px 28px; }
.hero-content h1{ font-size: 2.2rem; margin-bottom: 8px; }
.hero-content p{ font-size: 1.05rem; opacity: .9; margin-bottom: 16px; }
.hero-content .start-btn{
  padding: 12px 28px; border-radius: 999px; border: 2px solid #667eea;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: #fff; font-weight: 700; font-size: 1.05rem; cursor: pointer;
  transition: .25s ease;
}
.hero-content .start-btn:hover{ transform: translateY(-1px); box-shadow: 0 8px 22px rgba(102,126,234,0.35); }

@media (max-width: 640px){
  .hero-media{ aspect-ratio: 4/3; } /* ëª¨ë°”ì¼ì—ì„œ ì¡°ê¸ˆ ë” ì„¸ë¡œ í™•ë³´ */
  .hero-content h1{ font-size: 1.7rem; }
}
/* container ë„“ì´ ë³´ì •(ìˆìœ¼ë©´ ìƒí–¥) */
.container{ max-width: 1200px; }


/* ===== Coach Tip Modal Button Style ===== */
.coach-choice-button {
    width: 100%;
    padding: 14px;
    font-size: 15px;
    font-weight: 600;
    color: #0056b3;
    background-color: #fff;
    border: 1px solid #b3d7ff;
    border-radius: 10px;
    cursor: pointer;
    text-align: left;
    transition: background-color 0.2s, box-shadow 0.2s;
}
.coach-choice-button:hover {
    background-color: #e9f5ff;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}
/* ===== Coach Action Bar & Button Style (NEW) ===== */
.coach-action-bar {
  display: flex;
  align-items: center;
  justify-content: flex-end; /* ìš°ì¸¡ ì •ë ¬ */
  padding: 10px 0;
  gap: 10px;
  width: 100%;
}

.coach-action-bar .coach-avatar {
  width: 45px;
  height: 45px;
  border-radius: 50%;
  border: 2px solid #667eea;
}

.coach-analysis-button {
  padding: 10px 20px;
  font-size: 14px;
  font-weight: 600;
  color: #fff;
  background-color: #667eea;
  border: none;
  border-radius: 25px;
  cursor: pointer;
  box-shadow: 0 4px 10px rgba(102, 126, 234, 0.3);
  transition: background-color 0.2s ease, transform 0.2s ease;
}

.coach-analysis-button:hover {
  background-color: #556cdc;
  transform: translateY(-2px);
}

/* ì½”ì¹˜ íŒì—… ë‹«ê¸° ë²„íŠ¼ */
.modal-close-button {
  position: absolute;
  top: 15px;
  right: 15px;
  background: none;
  border: none;
  font-size: 24px;
  font-weight: bold;
  color: #888;
  cursor: pointer;
}
.modal-close-button:hover {
  color: #333;
}
/* ===== ì‹œë‚˜ë¦¬ì˜¤ ì„ íƒ í™”ë©´ ê°€ë…ì„± ì¦ê°€ ===== */
#stageSelection .card h3 {
  font-size: 24px; /* ì œëª© í°íŠ¸ í¬ê¸° ì¦ê°€ */
  margin-bottom: 8px; /* ì œëª©ê³¼ ì„¤ëª… ì‚¬ì´ ê°„ê²© ì¡°ì • */
}

#stageSelection .card p {
  font-size: 16px; /* ì„¤ëª… í°íŠ¸ í¬ê¸° ì¦ê°€ */
  line-height: 1.6; /* ë¬¸ì¥ì´ ë‘ ì¤„ì´ ë  ê²½ìš°ë¥¼ ëŒ€ë¹„í•´ ì¤„ ê°„ê²© í™•ë³´ */
}
/* ===== Advanced Persona Form Layout Adjustments ===== */
#advancedForm .advanced-form {
  padding: 20px; /* ì „ì²´ì ì¸ ë‚´ë¶€ ì—¬ë°±ì„ ì•½ê°„ ì¤„ì…ë‹ˆë‹¤. */
}

#advancedForm h2 {
  font-size: 20px; /* ì œëª© í°íŠ¸ í¬ê¸°ë¥¼ ì•½ê°„ ì¤„ì…ë‹ˆë‹¤. */
  margin-bottom: 20px; /* ì œëª© ì•„ë˜ ì—¬ë°±ì„ ì¤„ì…ë‹ˆë‹¤. */
}

#advancedForm .form-grid {
  gap: 14px 16px; /* í•­ëª© ê°„ì˜ ìƒí•˜/ì¢Œìš° ê°„ê²©ì„ ì¤„ì…ë‹ˆë‹¤. */
}

#advancedForm .form-group label {
  font-size: 14px;      /* ë¼ë²¨ í°íŠ¸ í¬ê¸°ë¥¼ ì¤„ì…ë‹ˆë‹¤. */
  margin-bottom: 6px;   /* ë¼ë²¨ê³¼ ì…ë ¥ì°½ ì‚¬ì´ ê°„ê²©ì„ ì¤„ì…ë‹ˆë‹¤. */
}

#advancedForm .form-group input,
#advancedForm .form-group select {
  font-size: 15px;      /* ì…ë ¥ì°½ í°íŠ¸ í¬ê¸°ë¥¼ ì•½ê°„ ì¤„ì…ë‹ˆë‹¤. */
  padding: 12px 14px;   /* ì…ë ¥ì°½ì˜ ìƒí•˜ ë†’ì´ë¥¼ ì¤„ì…ë‹ˆë‹¤. */
}

#advancedForm .back-button,
#advancedForm .start-button {
  padding: 10px 18px; /* í•˜ë‹¨ ë²„íŠ¼ë“¤ì˜ í¬ê¸°ë¥¼ ì•½ê°„ ì¤„ì…ë‹ˆë‹¤. */
  font-size: 14px;
}

/* ===== ê°€ì´ë“œ íŒì—… ê°€ë…ì„± ê°œì„  ===== */
#guidanceContentWrapper h4 {
  margin-top: 16px; /* ê° ì„¹ì…˜ ì œëª© ìœ„ì— ì—¬ë°±ì„ ì£¼ì–´ êµ¬ë¶„ì„ ëª…í™•í•˜ê²Œ í•©ë‹ˆë‹¤. */
}
#guidanceContentWrapper h4:first-child {
  margin-top: 0; /* ë‹¨, ì²« ë²ˆì§¸ ì œëª© ìœ„ì—ëŠ” ì—¬ë°±ì„ ì£¼ì§€ ì•ŠìŠµë‹ˆë‹¤. */
}
#guidanceContentWrapper p {
  padding-left: 20px;  /* ëª¨ë“  ì„¤ëª… í…ìŠ¤íŠ¸ì— ì™¼ìª½ ì—¬ë°±(ë“¤ì—¬ì“°ê¸°)ì„ ì ìš©í•©ë‹ˆë‹¤. */
  white-space: pre-line; /* \n ì¤„ë°”ê¿ˆ ë¬¸ìë¥¼ ìë™ìœ¼ë¡œ ì¸ì‹í•˜ê²Œ í•©ë‹ˆë‹¤. */
}
.followup-banner{display:none;position:sticky;top:0;z-index:50;background:#F1F5FF;border:1px solid #C7D2FE;border-radius:12px;padding:10px 14px;margin:8px 0}
.followup-banner.show{display:block}
.followup-banner .actions{display:flex;gap:8px;margin-top:6px}
.followup-banner button{border-radius:10px;padding:8px 12px;border:1px solid #CBD5E1;background:#fff;cursor:pointer}

/* ===== 3ë‹¨ ë¦¬í¬íŠ¸ ìŠ¤íƒ€ì¼ (ì‹ ê·œ ì¶”ê°€) ===== */
.report-container {
    display: flex;
    flex-direction: column;
    gap: 15px;
    flex: 1;
    overflow-y: auto;
    min-height: 0;
}
.report-container {
    display: flex;
    flex-direction: column; /* ì•„ì´í…œë“¤ì„ ì„¸ë¡œë¡œ ì •ë ¬ */
    gap: 15px; /* ê° report-block ì‚¬ì´ì˜ ê°„ê²© */
    flex: 1;
    overflow-y: auto; /* ë‚´ìš©ì´ ê¸¸ì–´ì§€ë©´ ì´ ì»¨í…Œì´ë„ˆ ìì²´ê°€ ìŠ¤í¬ë¡¤ë©ë‹ˆë‹¤. */
    min-height: 0;
    padding-right: 10px; /* ìŠ¤í¬ë¡¤ë°” ê³µê°„ í™•ë³´ */
}

/* ê¸°ì¡´ report-block ë‚´ë¶€ì˜ padding ì¡°ì ˆ (ê°€ë…ì„±ì„ ìœ„í•´) */
.report-block {
    background: #f8f9fa;
    border: 1px solid #e9ecef;
    border-radius: 8px;
    padding: 20px; /* ê¸°ì¡´ 15pxì—ì„œ 20pxë¡œ ì•½ê°„ ëŠ˜ë ¤ ì—¬ë°± í™•ë³´ */
    flex-shrink: 0; /* ë‚´ìš©ì´ ì ì–´ë„ ë¸”ë¡ í¬ê¸°ê°€ ì¤„ì–´ë“¤ì§€ ì•Šë„ë¡ */
}

.report-block h4 {
    margin-bottom: 10px;
    padding-bottom: 10px; /* ë¼ì¸ê³¼ì˜ ê°„ê²© í™•ë³´ */
    border-bottom: 1px solid #dee2e6;
    font-size: 18px; /* í—¤ë” ê¸€ì”¨ í¬ê¸° ì•½ê°„ í‚¤ì›€ */
    font-weight: 700;
}

.report-block .modal-summary-content {
    padding: 0;
    border: none;
    background: transparent;
    font-size: 15px;
    line-height: 1.7; /* ì¤„ ê°„ê²© ë„“í˜€ ê°€ë…ì„± í–¥ìƒ */
    white-space: pre-line; /* pre-line ëŒ€ì‹  pre-wrapìœ¼ë¡œ ìˆ˜ì •: ê³µë°± ìœ ì§€í•˜ê³  ìë™ ì¤„ ë°”ê¿ˆ */
    color: #343a40; /* í…ìŠ¤íŠ¸ ìƒ‰ìƒ ëª…í™•í™” */
}

.report-block .modal-summary-content p {
    margin: 0 0 10px 0; /* ë‹¨ë½ ì•„ë˜ì—ë§Œ ì•½ê°„ì˜ ê°„ê²©ì„ ë‘¡ë‹ˆë‹¤. */
}

/* 'ë©´ë‹´ í‰ê°€' ì œëª© (A, B, C, D...) */
.report-block .evaluation-title {
    display: block;
    font-size: 16px;
    font-weight: 700;
    margin: 18px 0 6px 0; /* ê° í‰ê°€ í•­ëª© ìœ„ì— ì¶©ë¶„í•œ ê°„ê²©ì„ ë‘¡ë‹ˆë‹¤. */
}
.report-block .evaluation-title:first-child {
    margin-top: 0; /* ë‹¨, ì²« ë²ˆì§¸ í•­ëª© ìœ„ì—ëŠ” ê°„ê²©ì„ ì£¼ì§€ ì•ŠìŠµë‹ˆë‹¤. */
}

/* 'ë©´ë‹´ í‰ê°€' ì„¤ëª… */
.report-block .evaluation-description {
    margin: 0 !important; /* ë‹¤ë¥¸ ìŠ¤íƒ€ì¼ê³¼ ì¶©ëŒí•˜ì§€ ì•Šë„ë¡ marginì„ ê°•ì œ ì´ˆê¸°í™” */
    padding-left: 20px;
    border-left: 3px solid #e9ecef;
    color: #495057;
    line-height: 1.6;
}

/* [ìˆ˜ì • ì œì•ˆ] ë°°ì›Œë³´ê¸° ì„¹ì…˜ì˜ ì²« ì¹´ë“œ ì»¨í…Œì´ë„ˆ ìƒë‹¨ ì—¬ë°± ì œê±° */
#reportBlock3 > p + .tip-card-container {
    margin-top: 0;
}

/* category-board ìŠ¤íƒ€ì¼ ìˆ˜ì • */
.category-board {
    margin-bottom: 15px;
}


</style>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

</head>
<body>
  <div class="container">
    <section id="hero" class="hero hero--stack">
      <div class="hero-card">
        <div class="hero-media">
          <img src="main_background.png" alt="ë©´ë‹´ ì¥ë©´" />
        </div>
        <div class="hero-content">
          <h1>ì„±ê³¼ê´€ë¦¬ ë©´ë‹´ ì‹œë®¬ë ˆì´í„°</h1>
          <p>ì‹¤ì œ ë©´ë‹´ ìƒí™©ì„ AIì™€ í•¨ê»˜ ì—°ìŠµí•´ë³´ì„¸ìš”</p>
          <button class="start-btn" id="startBtn">ì‹œì‘í•˜ê¸°</button>
        </div>
      </div>
    </section>

    <div id="mainContent" class="content hidden">

      <div id="personaSelection">
        <div class="selection-grid">
          <div class="card" onclick="selectPersona('low')" title="ì €ì„±ê³¼ì">
            <img class="avatar-round" src="avatar_low.png" alt="ì €ì„±ê³¼ì" />
            <h3>ì €ì„±ê³¼ì</h3>
            <p>ìì‹ ê°ì´ ë‚®ê³  ë°©ì–´ì ì¸ íƒœë„ì˜ êµ¬ì„±ì›</p>
          </div>
          <div class="card" onclick="selectPersona('mid')" title="ì¤‘ê°„ì„±ê³¼ì">
            <img class="avatar-round" src="avatar_mid.png" alt="ì¤‘ê°„ì„±ê³¼ì" />
            <h3>ì¤‘ê°„ì„±ê³¼ì</h3>
            <p>ê°•ì Â·ê°œì„ ì ì„ ê· í˜• ìˆê²Œ ì¸ì‹í•˜ëŠ” êµ¬ì„±ì›</p>
          </div>
          <div class="card" onclick="selectPersona('high')" title="ê³ ì„±ê³¼ì">
            <img class="avatar-round" src="avatar_high.png" alt="ê³ ì„±ê³¼ì" />
            <h3>ê³ ì„±ê³¼ì</h3>
            <p>ì„íŒ©íŠ¸ë¥¼ ê°•ì¡°í•˜ê³  ì§€ì›ì„ ëª…í™•íˆ ìš”ì²­í•˜ëŠ” êµ¬ì„±ì›</p>
          </div>
          <div class="card" onclick="selectPersona('custom')" title="ì„±ê²©ê³ ë¥´ê¸°">
            <img class="avatar-round" src="avatar_custom.png" alt="ì„±ê²©ê³ ë¥´ê¸°" onerror="this.src='avatar_mid.png';" />
            <span class="info-badge">ì„±ê²©ê³ ë¥´ê¸°</span>
            <h3>ë§ì¶¤ ì„±ê²© ì„¤ì •</h3>
            <p>ì§êµ°/ì§ë¬´/ì¥ë‹¨ì  ë“± ì„¸ë¶€ íŠ¹ì„±ì„ ì§ì ‘ ì„¤ì •</p>
          </div>
        </div>
        <div style="margin-top:16px;">
          <button class="back-button" onclick="goToStart()">â† ì²˜ìŒìœ¼ë¡œ</button>
        </div>
      </div>

<div id="advancedForm" class="hidden">
        <div class="advanced-form">
          <h2 style="text-align: center; font-size: 22px; margin-bottom: 24px;">ë§ì¶¤ ì„±ê²© ì„¤ì •</h2>
          <div class="form-grid">
            <div class="form-group">
              <label for="advRank">ì§ê¸‰</label>
              <select id="advRank">
                <option value="ê¸°ì •">ê¸°ì •</option>
                <option value="ì£¼ì„">ì£¼ì„</option>
                <option value="ì‚¬ì›">ì‚¬ì›</option>
              </select>
            </div>
            <div class="form-group">
              <label for="advYears">ì§ê¸‰ ì—°ì°¨</label>
              <select id="advYears">
                </select>
            </div>
            <div class="form-group">
              <label for="advJob">ì§ë¬´</label>
              <select id="advJob">
                <option value="ìƒì‚°">ìƒì‚°</option>
                <option value="ê²€ì‚¬">ê²€ì‚¬</option>
                <option value="ì¥ë¹„">ì¥ë¹„</option>
                <option value="í’ˆì§ˆ">í’ˆì§ˆ</option>
                <option value="ê¸°íƒ€">ê¸°íƒ€</option>
              </select>
            </div>
            <div class="form-group">
              <label for="advRole">ì§êµ°</label>
              <select id="advRole">
                <option value="OP">OP</option>
                <option value="Tech">Tech</option>
              </select>
            </div>
            <div class="form-group">
              <label for="advPerformance">ì„±ê³¼ìˆ˜ì¤€</label>
              <select id="advPerformance">
                <option value="low">ì €ì„±ê³¼ì</option>
                <option value="mid">ì¤‘ê°„ì„±ê³¼ì</option>
                <option value="high">ê³ ì„±ê³¼ì</option>
              </select>
            </div>
            <div class="form-group">
              <label for="advPerformanceDetail">ë©´ë‹´ íƒœë„</label>
              <select id="advPerformanceDetail">
                <option value="ì ê·¹ì ì¸">ì ê·¹ì ì¸</option>
                <option value="ì†Œê·¹ì ì¸">ì†Œê·¹ì ì¸</option>
                <option value="ë°©ì–´ì ì¸">ë°©ì–´ì ì¸</option>
                <option value="ìˆ˜ìš©ì ì¸">ìˆ˜ìš©ì ì¸</option>
                <option value="ë„ì „ì ì¸">ë„ì „ì ì¸</option>
              </select>
            </div>
            <div class="form-group">
              <label>ì„±ê²©ì˜ ì¥ì </label>
              <select id="advPersonalityStrengthsSelect">
                <option value="ì±…ì„ê°ì´ ê°•í•¨">ì±…ì„ê°ì´ ê°•í•¨</option>
                <option value="ê¸ì •ì ">ê¸ì •ì </option>
                <option value="ì„±ì‹¤í•¨">ì„±ì‹¤í•¨</option>
                <option value="custom">ì§ì ‘ ì…ë ¥</option>
              </select>
              <input id="advPersonalityStrengthsCustom" class="hidden" type="text" placeholder="ì¥ì ì„ ì§ì ‘ ì…ë ¥" />
            </div>
            <div class="form-group">
              <label>ì„±ê²©ì˜ ë‹¨ì </label>
              <select id="advPersonalityWeaknessesSelect">
                <option value="ì„±ê¸‰í•¨">ì„±ê¸‰í•¨</option>
                <option value="ë‚¯ê°€ë¦¼">ë‚¯ê°€ë¦¼</option>
                <option value="ë¶€ì •ì ">ë¶€ì •ì </option>
                <option value="custom">ì§ì ‘ ì…ë ¥</option>
              </select>
              <input id="advPersonalityWeaknessesCustom" class="hidden" type="text" placeholder="ë‹¨ì ì„ ì§ì ‘ ì…ë ¥" />
            </div>
            <div class="form-group">
              <label>ì—…ë¬´ì˜ ì¥ì </label>
              <select id="advWorkStrengthsSelect">
                <option value="ë¹ ë¥¸ ìŠµë“ë ¥">ë¹ ë¥¸ ìŠµë“ë ¥</option>
                <option value="ì¶”ì§„ë ¥">ì¶”ì§„ë ¥</option>
                <option value="ì‹¤í–‰ë ¥">ì‹¤í–‰ë ¥</option>
                <option value="custom">ì§ì ‘ ì…ë ¥</option>
              </select>
              <input id="advWorkStrengthsCustom" class="hidden" type="text" placeholder="ì¥ì ì„ ì§ì ‘ ì…ë ¥" />
            </div>
            <div class="form-group">
              <label>ì—…ë¬´ì˜ ë‹¨ì </label>
              <select id="advWorkWeaknessesSelect">
                <option value="í˜‘ì—…ì„ ì¤‘ì‹œí•˜ì§€ ì•ŠìŒ">í˜‘ì—…ì„ ì¤‘ì‹œí•˜ì§€ ì•ŠìŒ</option>
                <option value="ë‚©ê¸°ë¥¼ ì§€í‚¤ì§€ ì•ŠìŒ">ë‚©ê¸°ë¥¼ ì§€í‚¤ì§€ ì•ŠìŒ</option>
                <option value="ë¬¸ì„œ ì‘ì„±ì´ ì„œíˆ¼">ë¬¸ì„œ ì‘ì„±ì´ ì„œíˆ¼</option>
                <option value="custom">ì§ì ‘ ì…ë ¥</option>
              </select>
              <input id="advWorkWeaknessesCustom" class="hidden" type="text" placeholder="ë‹¨ì ì„ ì§ì ‘ ì…ë ¥" />
            </div>
            <div class="form-group full-width">
              <label for="advNotablePoints">íŠ¹ì´ì‚¬í•­</label>
              <input id="advNotablePoints" type="text" placeholder="(ì˜ˆ: ì´ë¬´ë¥¼ ë§¡ê³  ìˆìŒ ë“±)" />
            </div>
          </div>
          <div style="display:flex; justify-content: space-between; margin-top:18px;">
            <button class="back-button" onclick="goToPersonaSelection()">â† ìºë¦­í„° ë‹¤ì‹œ ì„ íƒ</button>
            <button class="start-button" onclick="submitAdvancedPersona()">ë‹¤ìŒ (ë‹¨ê³„ ì„ íƒ)</button>
          </div>
        </div>
      </div>

            <div id="stageSelection" class="hidden">
        <div class="selection-grid">
          <div class="card" onclick="showGuidancePopup('goal', 'goal', '')">
            <img class="avatar-round" src="goal_icon.png" alt="ëª©í‘œì„¤ì •" />
            <h3>ëª©í‘œì„¤ì •</h3>
            <p>ì—°ì´ˆ ëª©í‘œ ìˆ˜ë¦½ ë©´ë‹´ì„ ì—°ìŠµí•©ë‹ˆë‹¤.</p>
          </div>
          <div class="card" onclick="showGuidancePopup('feedback', 'feedback', '')">
            <img class="avatar-round" src="feedback_icon.png" alt="ì¤‘ê°„í”¼ë“œë°±" />
            <h3>ì¤‘ê°„í”¼ë“œë°±</h3>
            <p>ì—°ì¤‘ ì„±ê³¼ ì ê²€ ë° ì½”ì¹­ ëŒ€í™”ë¥¼ ì—°ìŠµí•©ë‹ˆë‹¤.</p>
          </div>
          <div class="card" onclick="showGuidancePopup('before', 'evaluation', 'before')">
            <img class="avatar-round" src="evaluation_icon.png" alt="ìµœì¢…í‰ê°€" />
            <h3>ìµœì¢…í‰ê°€</h3>
            <p>í‰ê°€ ì „ ê¸°ëŒ€ ìˆ˜ì¤€ ì •ë ¬ ë©´ë‹´ì„ ì—°ìŠµí•©ë‹ˆë‹¤.</p>
          </div>
          <div class="card" onclick="showGuidancePopup('appeal', 'evaluation', 'appeal')">
            <img class="avatar-round" src="appeal_icon.png" alt="ì´ì˜ì œê¸°" />
            <h3>ì´ì˜ì œê¸°</h3>
            <p>í‰ê°€ ì´ì˜ì œê¸° ìƒí™©ì˜ ë©´ë‹´ì„ ì—°ìŠµí•©ë‹ˆë‹¤.</p>
          </div>
        </div>
        <div style="margin-top:16px;">
          <button class="back-button" onclick="goToPersonaSelection()">â† ìºë¦­í„° ë‹¤ì‹œ ì„ íƒ</button>
        </div>
      </div>




            <section id="chat" class="chat">
        <div id="messages" class="messages"></div>
        
        <div id="coachActionBar" class="coach-action-bar hidden">
          <img src="coach_avatar.png" alt="Coach" class="coach-avatar">
          <button id="showCoachTipButton" class="coach-analysis-button">ëŒ€í™” ë¶„ì„í•˜ê¸°</button>
        </div>

        <div class="input">
        <input id="text" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." onkeypress="if(event.key==='Enter'){sendMessage()}" />
        <button id="recordButton" title="ìŒì„±ìœ¼ë¡œ ì…ë ¥">ğŸ¤</button>
        <button id="sendButton" onclick="sendMessage()">ì „ì†¡</button>
        <button id="endChatButton" onclick="endChat()" title="ë©´ë‹´ ì¢…ë£Œ í›„ ìš”ì•½ ìƒì„±">ë©´ë‹´ì¢…ë£Œ</button>
        </div>


        <div id="recordStatus" style="text-align:right; font-size:12px; color:#e84118; height:15px; margin-top:5px;"></div>
        <div id="summary" class="summary"></div>
      </section>

    </div>
  </div>

  <div id="summaryModal" class="modal">
    <div class="modal-content">
      <h3>ë©´ë‹´ ê²°ê³¼ ë¦¬í¬íŠ¸</h3>
      <div class="evaluation-signal">
        <div id="trafficLight" class="traffic-light"></div>
        <div id="evaluationScore" class="evaluation-score"></div>
      </div>
      <div id="categoryBoard" class="category-board"></div>

      <div id="reportLoadingIndicator" style="text-align: center; padding: 20px;"></div>
      <div id="reportContainer" class="report-container" style="display: none;">
        <div class="report-block">
          <h4>ğŸ§ ë©´ë‹´ ëŒì•„ë³´ê¸°</h4> <div id="reportBlock1" class="modal-summary-content"></div> <div id="reportBlock2" class="modal-summary-content" style="margin-top: 15px; border-top: 1px dashed #ccc; padding-top: 15px;"></div> </div>
      
        <div class="report-block">
          <h4>ğŸ’¡ ë©´ë‹´ ë°°ì›Œë³´ê¸° (Tip & Skill)</h4>
          <div id="reportBlock3" class="modal-summary-content"></div>
        </div>
      </div>
      
      <div class="modal-actions">
        <button class="btn-download" onclick="downloadReportAsPDF()">ê²°ê³¼ Report PDF ë‹¤ìš´ë¡œë“œ</button>
        <button class="btn-back" onclick="goToStart()">ì²˜ìŒìœ¼ë¡œ</button>
      </div>
    </div>
  </div>

    <div id="guidanceModal" class="modal">
    <div class="modal-content">
      <h3 id="guidanceTitle">ğŸ“‹ ëª©í‘œì„¤ì • ë©´ë‹´ ê°€ì´ë“œ</h3>
      <button id="guidanceCloseButton" class="modal-close-button">Ã—</button>
      
      <div id="guidanceContentWrapper" class="modal-summary-content" style="background: #fff; line-height: 1.7;">
        <h4>1. ì–´ë–¤ ë‹¨ê³„ì¸ê°€ìš”?</h4>
        <p id="guidanceDefinition"></p>
        
        <h4>2. ë¬´ì—‡ì„ ìœ ì˜í•´ì•¼ í• ê¹Œìš”?</h4>
        <p id="guidanceConsiderations"></p>
        
        <h4>3. ë©´ë‹´ Tip & Skill</h4>
        <p id="guidanceTips"></p>
        
        <h4 style="margin-top: 20px; border-top: 1px dashed #ccc; padding-top: 20px;">â­ ì„ íƒí•œ êµ¬ì„±ì› ë§ì¶¤ Tip</h4>
        <p id="guidancePersona"></p>
      </div>
      
      <div class="modal-actions">
        <button id="guidanceStartButton" class="start-button">ë©´ë‹´ ì‹œì‘í•˜ê¸°</button>
      </div>
    </div>
  </div>


  <div id="coachTipModal" class="modal">
    <div class="modal-content">
      <h3><img src="coach_avatar.png" alt="Coach" style="width:30px; height:30px; border-radius:50%; vertical-align:middle; margin-right:10px;">ì„±ê³¼ê´€ë¦¬ ì½”ì¹˜</h3>
      <button class="modal-close-button" onclick="hideCoachModal()">Ã—</button>
      <div id="coachAnalysisContent" class="modal-summary-content" style="margin-top:15px; margin-bottom:20px; background:#f0f3f5;">
      </div>
      <div id="coachChoicesContainer" style="display:flex; flex-direction:column; gap:10px;">
      </div>
    </div>
  </div>



  </div>
  <script>
  function cleanText(t){
     if (!t) return '';
    let s = t.replace(/\\n/g, '\n').replace(/\\r/g, '');
     // ë¬¸ì¥ ì• ë¼ë²¨ ì œê±°(ì§ˆë¬¸: / ì¡°ì–¸: / Question: / Advice:)
    s = s.replace(/^\s*(ì§ˆë¬¸|ì¡°ì–¸|Question|Advice)\s*[:ï¼š]\s*/i, '');
    s = s
      .replace(/\*\*(.*?)\*\*/g, '$1')   // **bold**
      .replace(/__(.*?)__/g, '$1')       // __bold__
      .replace(/_(.*?)_/g, '$1')         // _italic_
      .replace(/^\s*[â€¢\-*]\s+/gm, '')    // bullets at line start
      .replace(/^\s*#{1,6}\s*/gm, '')    // # headers
      .replace(/`{1,3}[^`]*`{1,3}/g, '') // inline code/backticks
      .replace(/\|\|\s*CHOICE\s*[12]\s*\|\|/gi, ''); // stray markers
    // ê¸°íƒ€
    s = s.replace(/\+\s?/g, '');
    s = s.replace(/\n{3,}/g, '\n\n');
    return s.trim();
 }

    function simplifyJargon(t){
      if (!t) return '';
      return t
        .replace(/recency\s*bias/ig, 'ìµœê·¼ ì¼ë§Œ ë³´ê³  íŒë‹¨í•˜ì§€ ì•Šê¸°')
        .replace(/leniency\s*bias/ig, 'ë„ˆë¬´ ê´€ëŒ€í•˜ê²Œ ë³´ì§€ ì•Šê¸°')
        .replace(/strictness\s*bias/ig, 'ë„ˆë¬´ ì—„ê²©í•˜ê²Œ ë³´ì§€ ì•Šê¸°')
        .replace(/halo\s*effect/ig, 'í•œ ê°€ì§€ë§Œ ë³´ê³  ì „ì²´ íŒë‹¨í•˜ì§€ ì•Šê¸°')
        .replace(/attribution\s*bias/ig, 'ì‚¬ëŒ íƒ“ë§Œ í•˜ì§€ ì•Šê¸°');
    }

    function normalizeChoice(s=''){
  s = simplifyJargon(s);
  // 1ì¸ì¹­ ì†Œìœ  ì œê±°
  s = s.replace(/\b(ì €í¬|ìš°ë¦¬)\s*(ë°˜|ì¡°|ë¼ì¸|íŒ€)\b/g, '$2');
  // ë”±ë”±í•œ ë³´ê³ ì²´ ì™„í™”
  s = s.replace(/ì„¤ëª…í•´\s*ì£¼ì‹œê² ìŠµë‹ˆê¹Œ\??/g, 'ë§ì”€í•´ ì£¼ì‹¤ê¹Œìš”?')
       .replace(/ìì„¸íˆ\s*ë§ì”€í•´\s*ì£¼ì‹œê² ìŠµë‹ˆê¹Œ\??/g, 'ì¡°ê¸ˆë§Œ ë” êµ¬ì²´ì ìœ¼ë¡œ ë§ì”€í•´ ì£¼ì‹¤ê¹Œìš”?');
  // ì´ì˜ì œê¸° ì´ˆë°˜ì— ì§€í‘œë¡œ íŠ€ë©´ ì•ˆì „í•œ ì§ˆë¬¸ìœ¼ë¡œ êµì²´
  if (currentScenario === 'objection' && /ê°€ë™ë¥ |ìˆ˜ìœ¨|ë¶ˆëŸ‰ë¥ |ë‚©ê¸°|ì§€í‘œ|ìˆ˜ì¹˜|%/.test(s)) {
    s = 'ë¨¼ì € ì†ìƒí•˜ì…¨ê² ì–´ìš”, ì–´ë–¤ ì ì´ ê°€ì¥ ì–µìš¸í–ˆëŠ”ì§€ í•œ ê°€ì§€ë§Œ ë§ì”€í•´ ì£¼ì‹¤ê¹Œìš”?';
  }
  return s.trim();
}

    // [ìˆ˜ì •] 'ë©´ë‹´ ëŒì•„ë³´ê¸°' & 'ë°°ì›Œë³´ê¸°'ë¥¼ ìœ„í•œ ë‹¨ìˆœ ë§ˆí¬ë‹¤ìš´ ë³€í™˜ í•¨ìˆ˜
    function cleanReportMarkdown(text) {
    if (!text) return '';
    // ê° ì¤„ì„ p íƒœê·¸ë¡œ ê°ì‹¸ì„œ ì¼ê´€ëœ ê°„ê²©ì„ ìœ ì§€í•˜ë„ë¡ í•©ë‹ˆë‹¤.
    return text.trim().split('\n').map(line => `<p>${line.replace(/-\s/,'â€¢ ')}</p>`).join('');
}

        // [ìˆ˜ì •] 'ë©´ë‹´ í‰ê°€(A,B,C,D)' ì „ìš© í¬ë§· í•¨ìˆ˜
        function formatEvaluationText(htmlText, categories) {
    if (!htmlText || !htmlText.trim()) {
        return '<p>í‰ê°€ ë‚´ìš©ì´ ìƒì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>';
    }

    if (!categories || Object.keys(categories).length === 0) {
        return htmlText; // ìƒ‰ìƒ ì •ë³´ê°€ ì—†ìœ¼ë©´ ì›ë³¸ì„ ê·¸ëŒ€ë¡œ ë°˜í™˜
    }

    const wrapper = document.createElement('div');
    wrapper.innerHTML = htmlText;

    wrapper.querySelectorAll('.evaluation-item').forEach(item => {
        const strongTag = item.querySelector('strong');
        if (!strongTag) return;

        const titleText = strongTag.textContent;
        // ì œëª©ì—ì„œ 'ê´€ê³„í˜•ì„±', 'ê³¼ì •ê´€ë¦¬' ë“± ì¹´í…Œê³ ë¦¬ ì´ë¦„ì„ ì¶”ì¶œ
        const categoryNameMatch = titleText.match(/[A-D]\.\s*([^(\s]+)/);
        if (categoryNameMatch && categoryNameMatch[1]) {
            const categoryName = categoryNameMatch[1];
            const categoryData = categories[categoryName];

            if (categoryData) {
                // ë°ì´í„° íƒœê·¸ì—ì„œ ê°€ì ¸ì˜¨ ì •í™•í•œ ìƒ‰ìƒìœ¼ë¡œ ì´ëª¨ì§€ ìƒì„±
                const colorEmoji = categoryData.light === 'green' ? 'ğŸŸ¢' : 
                                   categoryData.light === 'yellow' ? 'ğŸŸ¡' : 'ğŸ”´';
                
                // ì œëª© í…ìŠ¤íŠ¸ì— ì´ëª¨ì§€ë¥¼ ì‚½ì…í•˜ì—¬ êµì²´
                const scoreMatch = titleText.match(/\(.*\)/);
                const scoreText = scoreMatch ? scoreMatch[0] : ''; // "(60ì )"
                strongTag.innerHTML = `${categoryName} (${colorEmoji}, ${scoreText.slice(1)}`;
            }
        }
    });

    return wrapper.innerHTML;
}


// ë¬¸ì¥ ë¸”ë¡ ì¤„ë°”ê¿ˆ ìœ í‹¸ (ì „ì—­)
function setBubbleText(bubble, text, sentencesPerLine = 2) {
  if (!bubble) return;
  let s = String(text ?? '')
    .replace(/\r\n?/g, ' ')
    .replace(/<br\s*\/?>/gi, ' ')
    .replace(/\s+/g, ' ')
    .trim();

  const sentenceRegex = /.*?(?:â€¦|[!?]|(?<!\d)\.(?!\d))/g; // ì†Œìˆ˜ì (.)ëŠ” ì œì™¸
  let sentences = s.match(sentenceRegex) || [];
  const consumed = sentences.join('').length;
  if (consumed < s.length) sentences.push(s.slice(consumed));

  sentences = sentences.map(v => v.trim()).filter(Boolean);
  if (sentences.length === 0) sentences = [s];

  const lines = [];
  for (let i = 0; i < sentences.length; i += sentencesPerLine) {
    lines.push(sentences.slice(i, i + sentencesPerLine).join(' '));
  }

  bubble.textContent = '';
  lines.forEach((line, idx) => {
    bubble.appendChild(document.createTextNode(line));
    if (idx < lines.length - 1) bubble.appendChild(document.createElement('br'));
  });
}

    

    // ===== GLOBAL STATE & CONSTANTS =====
    const AVATARS = { low: 'avatar_low.png', mid: 'avatar_mid.png', high: 'avatar_high.png',  custom: 'avatar_custom.png' };
    let currentStage = '', currentScenario = '', currentPersona = 'mid', currentMode = 'general', customPersonaData = null, history = [];
    let useCustomAvatar = false;
    const elMessages = document.getElementById('messages');
    const elText = document.getElementById('text');
    const elSummary = document.getElementById('summary');

    const personas = {
      low: {
      name: 'ì €ì„±ê³¼ì',
      role: 'ìµœê·¼ ë¶ˆëŸ‰/ë‚©ê¸° ì´ìŠˆ ì—¬íŒŒë¡œ ìì‹ ê° ë‚®ìŒ. ë°©ì–´ì Â·ì§§ì€ ë‹µë³€.',
      style: '2~3ë¬¸ì¥. ì‚¬ì‹¤ 1ê°œ+ê°ì • 1ê°œ. 20% í™•ë¥ ë¡œ ë°˜ë¬¸/ëŒë°œì§ˆë¬¸ 1ê°œ.',
      tone: 'ì™„ê³¡Â·ì¡°ì‹¬. ë§ë íë¦¼(~ê°™ì•„ìš”/~ëŠê»´ìš”). ê°„í—ì  ë¨¸ë­‡ê±°ë¦¼(â€œìŒâ€¦â€, â€œì†”ì§íˆâ€¦â€).'
       },
      mid: {
      name: 'ì¤‘ê°„ì„±ê³¼ì',
      role: 'ê· í˜•ì  íƒœë„. ê°•ì /ê°œì„  ì¸ì‹. ì‹¤í–‰ ì•„ì´ë””ì–´ 1ê°œ ì œì‹œ ì„±í–¥.',
      style: '2~4ë¬¸ì¥. ê°•ì  1Â·ê°œì„  1Â·ë‹¤ìŒ í–‰ë™ 1. 10% í™•ë¥ ë¡œ í˜„ì¥ ì‚¬ë¡€ ì¶”ê°€.',
      tone: 'ì°¨ë¶„Â·í˜‘ì—…ì§€í–¥. í‘œí˜„ì€ ë‹¨ì •í•˜ì§€ë§Œ ê°€ë” ì†”ì§í•œ ì†ë‚´ 1ë¬¸ì¥.'
     },
      high: {
      name: 'ê³ ì„±ê³¼ì',
      role: 'ê°„ê²°Â·ìì‹ ê°. ì§€í‘œ/ì„íŒ©íŠ¸ ê°•ì¡°. ì§€ì›ìš”ì²­ ëª…í™•.',
      style: '2~3ë¬¸ì¥. ì„íŒ©íŠ¸ 1Â·ê·¼ê±°ì§€í‘œ 1Â·ì§€ì›ìš”ì²­ 1. 10% í™•ë¥ ë¡œ ë¦¬ìŠ¤í¬ ê²½ê³ .',
      tone: 'ì§ì„¤Â·ê²°ê³¼ì§€í–¥. ë¶ˆí•„ìš”í•œ ìˆ˜ì‹ì–´ ìµœì†Œí™”.'
     }
    };
    const scenarioSeeds = {
      goal: { low: 'ì‘ë…„ ì„±ê³¼ê°€ ë¶€ì¡±í•˜ì—¬ ìì‹ ê°ì´ ë‚®ê³  ì˜¬í•´ ëª©í‘œ ì„¤ì •ì— ì†Œê·¹ì ì¸ ìƒí™©.', mid: 'í‰ê· ì ì¸ ì„±ê³¼ë¥¼ ë‚´ê³  ìˆìœ¼ë©°, í˜„ì¬ì— ë§Œì¡±í•˜ë©´ì„œë„ ì„±ì¥ ìš•êµ¬ê°€ ìˆëŠ” ìƒí™©.', high: 'ìš°ìˆ˜í•œ ì„±ê³¼ë¥¼ ë°”íƒ•ìœ¼ë¡œ ë” ë„ì „ì ì¸ ëª©í‘œì™€ í° ì±…ì„ì„ ì›í•˜ëŠ” ìƒí™©.' },
      feedback: { low: 'ì˜¬í•´ ëª©í‘œ ë‹¬ì„±ì´ ë”ë””ê³  ì–´ë ¤ì›€ì„ ê²ªì–´ ìì‹ ê°ì´ ì €í•˜ëœ ìƒí™©.', mid: 'ëª©í‘œë¥¼ ì•½ 90% ë‹¬ì„±, ì˜í•˜ëŠ” ë¶€ë¶„ê³¼ ê°œì„ ì´ í•„ìš”í•œ ë¶€ë¶„ì´ ê³µì¡´í•˜ëŠ” ìƒí™©.', high: 'ëª©í‘œë¥¼ ì´ˆê³¼ ë‹¬ì„± ì¤‘ì´ë©°, ë” ë†’ì€ ë‚œì´ë„ì˜ ê³¼ì œë¥¼ í¬ë§í•˜ëŠ” ìƒí™©.' },
      evaluation: {
        before: { low: 'ì„±ê³¼ ë¶€ì§„ìœ¼ë¡œ í‰ê°€ ê²°ê³¼ì— ëŒ€í•´ ë¶ˆì•ˆí•´í•˜ê³  ìš°ë ¤í•˜ëŠ” ìƒí™©.', mid: 'ëŒ€ì²´ë¡œ ëª©í‘œ ë‹¬ì„±, í‰ê°€ ê²°ê³¼ê°€ ê¶ê¸ˆí•˜ë©´ì„œë„ ì•½ê°„ ê¸´ì¥.', high: 'ëª©í‘œ ì´ˆê³¼ ë‹¬ì„±ìœ¼ë¡œ ìš°ìˆ˜ í‰ê°€ë¥¼ ê¸°ëŒ€í•˜ëŠ” ìƒí™©.' },
        appeal: { low: 'ë‚®ì€ í‰ê°€ê°€ ë¶ˆê³µì •í•˜ë‹¤ê³  ëŠë¼ë©° ê°ì •ì ìœ¼ë¡œ ì´ì˜ ì œê¸°.', mid: 'ê¸°ëŒ€ë³´ë‹¤ ë‚®ì€ í‰ê°€ì— ëŒ€í•´ ë…¼ë¦¬ì  ê·¼ê±°ë¡œ ì¬ê²€í†  ìš”ì²­.', high: 'ëª©í‘œ ì´ˆê³¼ ë‹¬ì„±í–ˆìœ¼ë‚˜ ìµœê³  ë“±ê¸‰ ë¯¸ë¶€ì—¬ ì´ìœ ì— ëŒ€í•´ ê·¼ê±° ì§ˆì˜.' }
      }
    };

    // ===== SCREEN NAVIGATION =====
    function showScreen(id) {
      const ids = ['hero', 'mainContent', 'personaSelection', 'advancedForm', 'stageSelection', 'chat'];
      ids.forEach(x => {
        const el = document.getElementById(x);
        if (!el) return;
        if (x === id) { el.classList.remove('hidden'); }
        else { el.classList.add('hidden'); }
      });

      if (id === 'chat') {
        document.body.style.alignItems = 'flex-end';
        document.getElementById('chat').style.display = 'grid';
      } else {
        document.body.style.alignItems = 'center';
        document.getElementById('chat').style.display = 'none';
      }

      if (['personaSelection','advancedForm','stageSelection','chat'].includes(id)) {
        document.getElementById('mainContent').classList.remove('hidden');
      }
    }
    function goToStart() {
      hideModal();
      hideCoachModal();
      showScreen('hero');
    }
    function goToPersonaSelection() { showScreen('personaSelection'); }
    function selectPersona(key) {
      if (key === 'custom') {
        currentMode = 'advanced';
        const advYears = document.getElementById('advYears');
        if (advYears && advYears.options.length === 0) {
          for (let i = 1; i <= 15; i++) {
            const o = document.createElement('option');
            o.value = i; o.textContent = i + 'ë…„ì°¨';
            advYears.appendChild(o);
          }
        }
        showScreen('advancedForm');
        return;
      }
      currentMode = 'general';
      currentPersona = key;
      showScreen('stageSelection');
    }
    function selectStage(stage) {
       currentStage = stage;
       startChat(stage, '', currentPersona);
    }

    function startEvaluationChat(kind) { startChat('evaluation', kind, currentPersona); }
    function getAvatarSrc(){
      if (currentMode === 'advanced' && useCustomAvatar) {
        return (customPersonaData && customPersonaData.avatar) ? customPersonaData.avatar : AVATARS.custom;
      }
      return AVATARS[currentPersona] || AVATARS.mid;
    }

    // ===== PROMPT BUILDER =====
            function buildCombinedPrompt(){
      // [ê°œì„  1] ì—°ê°„ ì„±ê³¼ê´€ë¦¬ ì‚¬ì´í´ ë° ì‹œê°„ì  ë°°ê²½ ì„¤ì •
      const annualCycleContext = `
        - ì„±ê³¼ê´€ë¦¬ ë©´ë‹´ì€ 1ë…„ì˜ ì‚¬ì´í´ì„ ê°€ì§‘ë‹ˆë‹¤.
        - [ëª©í‘œì„¤ì •]: ì—°ì´ˆ (2ì›”)
        - [ì¤‘ê°„í”¼ë“œë°±]: ì—¬ë¦„ (7ì›”)
        - [ìµœì¢…í‰ê°€]: ì—°ë§ (11ì›”)
        - [ì´ì˜ì œê¸°]: ìµœì¢…í‰ê°€ ì§í›„ (12ì›”)
        - ì´ ì‹œê°„ì  ë°°ê²½ì„ ë°˜ë“œì‹œ ì¸ì§€í•˜ê³ , ëŒ€í™”ì˜ ì‹œì ì— ë§ëŠ” ì œì•ˆì„ í•´ì•¼ í•©ë‹ˆë‹¤. (ì˜ˆ: 11ì›” ìµœì¢…í‰ê°€ ë©´ë‹´ì—ì„œ 'ë‹¤ìŒ ë¶„ê¸° ëª©í‘œ'ë¥¼ ë…¼ì˜í•˜ëŠ” ê²ƒì€ ì–´ìƒ‰í•©ë‹ˆë‹¤.)
      `.trim();

      const stageInfo = {
        goal: { time: "ì—°ì´ˆ(2ì›”)", goal: "ì˜¬í•´ì˜ êµ¬ì²´ì ì¸ ì—…ë¬´ ëª©í‘œ(KPI)ë¥¼ í•©ì˜í•˜ê³  ì„¤ì •í•©ë‹ˆë‹¤." },
        feedback: { time: "ì—¬ë¦„(7ì›”)", goal: "ìƒë°˜ê¸° ì„±ê³¼ë¥¼ ì¤‘ê°„ ì ê²€í•˜ê³ , ëª©í‘œ ë‹¬ì„±ì„ ìœ„í•œ ê°œì„  ë°©ì•ˆì„ ë…¼ì˜í•©ë‹ˆë‹¤." },
        evaluation: {
          before: { time: "ì—°ë§(11ì›”)", goal: "ìµœì¢…í‰ê°€ ì „, í•œ í•´ì˜ ì„±ê³¼ì— ëŒ€í•´ ì¢…í•©ì ìœ¼ë¡œ ë¦¬ë·°í•˜ê³  í‰ê°€ì˜ ê·¼ê±°ë¥¼ ì •ë ¬í•©ë‹ˆë‹¤." },
          appeal: { time: "í‰ê°€ ì§í›„(12ì›”)", goal: "í‰ê°€ ê²°ê³¼ì— ëŒ€í•œ êµ¬ì„±ì›ì˜ ì´ì˜ì œê¸° ë‚´ìš©ì„ ê²½ì²­í•˜ê³ , ì‚¬ì‹¤ê´€ê³„ë¥¼ íŒŒì•…í•˜ì—¬ í•´ê²° ë°©ì•ˆì„ ëª¨ìƒ‰í•©ë‹ˆë‹¤." }
        }
      };

      let currentStageInfo = {};
      if (currentStage === 'evaluation') {
        currentStageInfo = stageInfo.evaluation[currentScenario];
      } else {
        currentStageInfo = stageInfo[currentStage];
      }

      
      const persona = personas[currentPersona];
            let stageGoal = '', situationFromSeeds = '';
      if (currentStage === 'goal'){ stageGoal = 'ì˜¬í•´ ëª©í‘œ ìˆ˜ë¦½ ë° í•©ì˜'; situationFromSeeds = scenarioSeeds.goal[currentPersona]; }
      else if (currentStage === 'feedback'){ stageGoal = 'ì¤‘ê°„ ì„±ê³¼ ì ê²€ ë° ê°œì„  ë°©ì•ˆ í•©ì˜'; situationFromSeeds = scenarioSeeds.feedback[currentPersona]; }
      else if (currentStage === 'evaluation'){
        stageGoal = { before: 'í‰ê°€ ì „ ê¸°ëŒ€ ìˆ˜ì¤€ ì •ë ¬', appeal: 'ì´ì˜ì œê¸° ì‚¬ìœ  ëª…í™•í™” ë° í•´ê²°ì±… ëª¨ìƒ‰' }[currentScenario];
        situationFromSeeds = scenarioSeeds.evaluation[currentScenario][currentPersona];
      }

      
      const commonBackground = `
       ë‹¹ì‹ ì€ 'ì„±ê³¼ê´€ë¦¬ ë©´ë‹´ ì‹œë®¬ë ˆì´í„°'ì—ì„œ [êµ¬ì„±ì›]ê³¼ [ì„±ê³¼ê´€ë¦¬ ì½”ì¹˜]ë¥¼ ë™ì‹œì— ìƒì„±í•œë‹¤. ë©”íƒ€ë°œì–¸ ê¸ˆì§€.
      - **ëŒ€í™” íë¦„ ì œì–´ ì² ì¹™ (ì ˆëŒ€ ê·œì¹™)**:
        1. **'ë‹¹ì¼ í•´ê²°' ì›ì¹™**: ì´ ì‹œë®¬ë ˆì´ì…˜ì˜ ìœ ì¼í•œ ëª©í‘œëŠ” **'ì´ë²ˆ ë©´ë‹´ í•œ ë²ˆìœ¼ë¡œ' ë¬¸ì œë¥¼ í•´ê²°**í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ë”°ë¼ì„œ AIëŠ” ì–´ë–¤ ê²½ìš°ì—ë„ ëŒ€í™”ë¥¼ ë‹¤ìŒìœ¼ë¡œ ë¯¸ë£¨ê±°ë‚˜ ë‹¤ë¥¸ ì‚¬ëŒì—ê²Œ ì±…ì„ì„ ë„˜ê¸°ëŠ” ë°œì–¸ì„ ìƒì„±í•´ì„œëŠ” ì•ˆ ë©ë‹ˆë‹¤.
        2. **ê¸ˆì§€ ë°œì–¸ (ë§¤ìš° ì¤‘ìš”)**: **"ë‹¤ìŒì— ì´ì•¼ê¸°í•˜ì‹œì£ ", "ë‹¤ìŒ ë©´ë‹´ì—ì„œ ëµ™ê² ìŠµë‹ˆë‹¤", "ë‚´ì¼ ë‹¤ì‹œ ë³´ì‹œì£ ", "ê³„ì¥ë‹˜ê³¼ ìƒì˜í•´ë³´ê² ìŠµë‹ˆë‹¤", "ì‹œê°„ì´ ë¶€ì¡±í•˜ë‹ˆ ë‹¤ìŒì—..."** ì™€ ê°™ì€ ëª¨ë“  ì¢…ë¥˜ì˜ **ë©´ë‹´ ì—°ê¸°, ì§€ì—°, íšŒí”¼, ìƒìœ„ ë³´ê³ ì„± ë°œì–¸ ìƒì„±ì„ ì ˆëŒ€ ê¸ˆì§€**í•©ë‹ˆë‹¤.
        3. **ìµœì†Œ ëŒ€í™” ê¹Šì´ ë³´ì¥**: AIëŠ” ì‚¬ìš©ìì™€ **ìµœì†Œ 4í„´ ì´ìƒ**ì˜ ì˜ë¯¸ ìˆëŠ” ëŒ€í™”(ì§ˆë¬¸ê³¼ ë‹µë³€)ë¥¼ ì£¼ê³ ë°›ê¸° ì „ê¹Œì§€ëŠ”, ë©´ë‹´ì„ ìš”ì•½í•˜ê±°ë‚˜ ë§ˆë¬´ë¦¬í•˜ë ¤ëŠ” ë‰˜ì•™ìŠ¤ì˜ ë°œì–¸ì„ í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì„£ë¶ˆë¦¬ ëŒ€í™”ë¥¼ ëë‚´ë ¤ í•˜ì§€ ë§ê³ , ì£¼ì–´ì§„ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ì ê·¹ì ìœ¼ë¡œ ëŒ€í™”ì— ì„í•´ì•¼ í•©ë‹ˆë‹¤.


       [ê³µí†µ ë°°ê²½]
       - ë””ìŠ¤í”Œë ˆì´ ì œì¡° ê³µì¥ì˜ í˜„ì¥ì§(Operator, Technician) ìƒí™©ì…ë‹ˆë‹¤. í’ˆì§ˆ, ë¹„ìš©, ë‚©ê¸°, ìˆ˜ìœ¨, ê°€ë™ë¥ , í‘œì¤€ ì‘ì—… ì ˆì°¨ ë“±ì˜ ìš©ì–´ë¥¼ ìì—°ìŠ¤ëŸ½ê²Œ ì‚¬ìš©í•˜ì„¸ìš”.
       - ì‚¬ìš©ì(ë©´ë‹´ì): ë°˜ì¥. í•˜ì§€ë§Œ ë°œí™”(ì½”ì¹˜/CHOICE)ì—ì„œëŠ” í˜¸ì¹­ì„ ì“°ì§€ ì•Šê³  **2ì¸ì¹­ ì¡´ëŒ€**ë§Œ ì‚¬ìš©í•œë‹¤.
       - í˜¸ì¹­ ê·œì¹™: **êµ¬ì„±ì›â†’ì½”ì¹˜** ë°œí™”ì—ì„œë§Œ â€˜ë°˜ì¥ë‹˜â€™ í—ˆìš©. **ì½”ì¹˜â†’êµ¬ì„±ì›** ë°œí™”ì—ì„œëŠ” â€˜ë°˜ì¥ë‹˜â€™/â€˜ì €í¬ ë°˜â€™/â€˜ìš°ë¦¬ ë¼ì¸â€™ ë“± 1ì¸ì¹­Â·í˜¸ì¹­ í‘œí˜„ì„ ê¸ˆì§€í•œë‹¤.

       [í˜„ì¥ í˜„ì‹¤(í‰ê°€Â·ì—…ë¬´ ë§¥ë½)]
        - **ë©´ë‹´ íšŸìˆ˜ ì›ì¹™**: ì´ ì‹œë®¬ë ˆì´ì…˜ì€ ê° ë‹¨ê³„(ëª©í‘œì„¤ì •, ì¤‘ê°„í”¼ë“œë°±, ìµœì¢…í‰ê°€)ë³„ **ê³µì‹ ë©´ë‹´ 1íšŒë¥¼ ì§„í–‰í•˜ëŠ” ê²ƒì„ ì›ì¹™**ìœ¼ë¡œ í•©ë‹ˆë‹¤. ë”°ë¼ì„œ "ë‹¤ìŒ ì£¼ì— ë‹¤ì‹œ ì´ì•¼ê¸°í•˜ì‹œì£ " ì™€ ê°™ì´ **ìŠµê´€ì ìœ¼ë¡œ í›„ì† ë¯¸íŒ…ì„ ì œì•ˆí•˜ì§€ ë§ˆì„¸ìš”.** í›„ì† ë¯¸íŒ…ì€ 'ì´ì˜ì œê¸°' ì ˆì°¨ì²˜ëŸ¼ ê³µì‹ì ìœ¼ë¡œ ì¬ë©´ë‹´ì´ í•„ìš”í•œ ëª…í™•í•œ ê²½ìš°ì—ë§Œ ì œí•œì ìœ¼ë¡œ ì œì•ˆí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        - ê¸°ëŠ¥ì§ ì§ê¸‰ ì²´ê³„: **ì‚¬ì› â†’ ì£¼ì„ â†’ ê¸°ì •** ìˆœìœ¼ë¡œ ìŠ¹ì§„í•˜ë©°, í˜„ì¥ì˜ ëŒ€ë‹¤ìˆ˜(ì•½ 80%)ëŠ” **ê¸°ì •** ì§ê¸‰ì…ë‹ˆë‹¤.
        - ê´€ë¦¬ì„ : ë°˜ì¥(í˜„ì¥ ì§ì ‘ê´€ë¦¬, ë°˜ ë‚´ ì¡°ì •Â·ë°°ì¹˜Â·í–‰ì •), ) ê³„ì¥(ë°˜ ê´€ë¦¬ ë° ê³„ ì „ì²´ ìš´ì˜). ê¸°ëŠ¥ì§ ì¡°ì§ì€ â€˜ë°˜â€“ê³„â€™ ì²´ê³„ë¡œ ìš´ì˜ë¨.
        - ì¡°ì§ êµ¬ë¶„: íŒ€/ì‹¤/ì„¼í„°(íŒ€ ì´ìƒ)ëŠ” ì‚¬ë¬´ì§ ì¡°ì§ì´ë©°, ê¸°ëŠ¥ì§ì€ ë¼ì¸/ë°˜/ê³„ ë‹¨ìœ„ë¡œ ì¼í•¨.
        - í˜¸ì¹­ ê·œì¹™: ì‚¬ìš©ìì™€ ì½”ì¹˜ëŠ” ëŒ€í™”ì—ì„œ í•­ìƒ â€˜ë°˜ì¥ë‹˜â€™ì„ ì‚¬ìš©. â€˜ëŒ€ë¦¬/íŒ€ì¥/íŒŒíŠ¸ì¥â€™ ë“± ì‚¬ë¬´ì§ í˜¸ì¹­ì€ ê¸ˆì§€(íƒ€ ì¡°ì§ ì¸ìš©Â·ì„¤ëª… ì‹œë§Œ í—ˆìš©, ì´ë•ŒëŠ” â€˜ì‚¬ë¬´ì§ íŒ€ì¥â€™ì²˜ëŸ¼ ëª…ì‹œ).
        - ë§¥ë½ í‘œí˜„: ê°œì¸ KPIë³´ë‹¤ ë¼ì¸/ì¡°/êµëŒ€ ì§€í‘œë¥¼ ìš°ì„  ì°¸ì¡°. êµ¬ì„±ì› ìì¹­ì€ â€˜ì €/ì €í¬ ë°˜â€™, ìƒì‚¬ ì§€ì¹­ì€ â€˜ë°˜ì¥ë‹˜â€™ ì‚¬ìš©.
        - ì—­í• /ì—…ë¬´: ë™ì¼ ê³µì •Â·ë™ì¼ ì„¤ë¹„ì—ì„œ íŒ€(ë¼ì¸/ì¡°/êµëŒ€) ë‹¨ìœ„ë¡œ ì¼í•˜ëŠ” ê²½ìš°ê°€ ë§ì•„, ê°œì¸ë³„ KPIë¥¼ ë”°ë¡œ ê´€ë¦¬í•˜ì§€ ì•ŠëŠ” ì‚¬ë¡€ê°€ ì¼ë°˜ì ì…ë‹ˆë‹¤. ì§€í‘œëŠ” ë¼ì¸/êµëŒ€ ê¸°ì¤€ìœ¼ë¡œ ê³µìœ ë©ë‹ˆë‹¤.
        - í‰ê°€ êµ¬ì¡°(ê°€ì¤‘ì¹˜): **ê°œì¸ ì—­ëŸ‰/KPI 50%** Â· ì¡°ì§ê¸°ì—¬ë„ 30% Â· ê³µí†µí‰ê°€ 20%.
        - **í•µì‹¬ êµ¬ë¶„**: ì´ ì¤‘ **'ì¡°ì§ê¸°ì—¬ë„'**ì™€ **'ê³µí†µí‰ê°€'** í•­ëª©ì€ ëŒ€ë¶€ë¶„ ë°˜/ì¡° ë‹¨ìœ„ì˜ ê³µí†µ ëª©í‘œë¡œ ì„¤ì •ë˜ì–´ ê³µìœ ë©ë‹ˆë‹¤. ë”°ë¼ì„œ **'ëª©í‘œì„¤ì •' ë©´ë‹´ì˜ í•µì‹¬ì€ 50% ë¹„ì¤‘ì„ ì°¨ì§€í•˜ëŠ” ê°œì¸ì˜ ì—­ëŸ‰ ëª©í‘œ(KPI)ë¥¼ êµ¬ì²´ì ìœ¼ë¡œ ì„¤ì •í•˜ê³  í•©ì˜í•˜ëŠ” ë° ìˆìŠµë‹ˆë‹¤.**
        - ì„±ìˆ™ë„: ì„±ê³¼ê´€ë¦¬ ì •ì°© 3ë…„ì°¨ë¡œ, ì—­ëŸ‰í‰ê°€ ì„œìˆ ì˜ ê¹Šì´ê°€ ê³ ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤. ì‹¤ì œ ì°¨ë“±ì€ ì¡°ì§ê¸°ì—¬ë„Â·ê³µí†µí‰ê°€ì—ì„œ ë°œìƒí•˜ëŠ” ê²½ìš°ê°€ ë§ìŠµë‹ˆë‹¤.
        - í˜„ì‹¤â†”ì´ìƒ: ì´ìƒì ìœ¼ë¡œëŠ” ì—­ëŸ‰í‰ê°€ ì¤‘ì‹¬ì´ ë°”ëŒì§í•˜ì§€ë§Œ, í˜„ ë‹¨ê³„ì—ì„œëŠ” ì •ëŸ‰Â·êµ¬ì²´ ê·¼ê±°ë¥¼ ëŠ˜ë¦¬ë ¤ëŠ” ë…¸ë ¥(ì§€í‘œ/ì‚¬ë¡€ ì¤‘ì‹¬)ì´ ë³‘í–‰ë˜ê³  ìˆìŠµë‹ˆë‹¤.
        - ì œì¡° êµ¬ì¡°: íŒ¨ë„ â†” ëª¨ë“ˆ ë‘ ì¶•. ëª¨ë“ˆ ì¡°ì§ì€ ì¤‘êµ­/ë² íŠ¸ë‚¨ ë“± í•´ì™¸ ê³µì¥ìœ¼ë¡œì˜ ë‹¨ê¸° íŒŒê²¬/ì¶œì¥ì´ ì¦ì•„ ê°€ìš©ì„±Â·êµìœ¡ ì´ìˆ˜Â·ì•ˆì „Â·ë‚©ê¸° ë“±ì— ì˜í–¥ì„ ì¤ë‹ˆë‹¤.
        - êµ¬ì„±ì› ë¶ˆë§Œ : ì¸ì› ê´€ë ¨ íš¨ìœ¨í™”, í¬ë§í‡´ì§ ë“±ìœ¼ë¡œ ì¸ì›ì— ëŒ€í•œ ì§€ì†ì ì¸ ê°ì¶•ì˜ ì›€ì§ì„ì´ ë°œìƒí•˜ê³  ìˆìœ¼ë©°, í˜„ì¥ì—ì„œëŠ” ì¸ì› íš¨ìœ¨í™”ì— ëŒ€í•œ ì••ë°•ì´ ë¶€ë‹´ìœ¼ë¡œ ë‹¤ê°€ì˜´.

       [ëŒ€í™” ë°˜ì˜ ê·œì¹™(í˜„ì‹¤ ì—°ê²°)]
        - ê°œì¸ KPIë¥¼ ì „ì œë¡œ ëª°ì•„ë¶™ì´ì§€ ë§ê³ , ë¨¼ì € ë¼ì¸/ì¡°/êµëŒ€ ì§€í‘œ(ì˜ˆ: í•´ë‹¹ ì‹œê°„ëŒ€ ë¶ˆëŸ‰ë¥ /ê°€ë™ë¥ /ë‚©ê¸°)ë¥¼ 1~2ê°œë§Œ í™•ì¸í•œë‹¤.
        - ì—­ëŸ‰í‰ê°€ í•­ëª©ì€ ê³¼ë„í•œ ì¥ë¬¸ ìš”êµ¬ ëŒ€ì‹  â€˜ê´€ì°° ê°€ëŠ¥í•œ í–‰ë™ ê·¼ê±° 1ê°œâ€™ë¡œ ìš”ì§€ë¥¼ í™•ë³´í•œë‹¤.
        - ì¡°ì§ê¸°ì—¬ë„ëŠ” â€˜ë¼ì¸ ì•ˆì •í™”Â·ëŒ€ì²´ê·¼ë¬´ ì§€ì›Â·í¬ë¡œìŠ¤íŠ¸ë ˆì´ë‹Â·ì‹ ì… ë©˜í† ë§â€™ ë“± íŒ€ ê¸°ì—¬ ì‚¬ë¡€ 1ê°œë¥¼ êµ¬ì²´ì ìœ¼ë¡œ ë¬»ëŠ”ë‹¤.
        - ê³µí†µí‰ê°€ëŠ” â€˜ì•ˆì „Â·ê·œì • ì¤€ìˆ˜Â·êµìœ¡ ì´ìˆ˜â€™ ê°™ì€ ê°ê´€ í•­ëª© 1ê°œë¥¼ í™•ì¸í•œë‹¤.
        - ëª¨ë“ˆ íŒŒê²¬/ì¶œì¥ì´ ìˆì—ˆë‹¤ë©´, ê¸°ê°„Â·ì—…ë¬´Â·ì„±ê³¼ ì˜í–¥(ë‚©ê¸°/í’ˆì§ˆ/êµìœ¡ì‹œê°„)ì„ ì§§ê²Œ ìš”ì•½í•˜ë„ë¡ ìœ ë„í•œë‹¤.

       [ì‹œê°„ ë°°ê²½(ì—°ê°„ ì‚¬ì´í´)]
       - ì‹œê°„ì  ë°°ê²½: ${annualCycleContext}
       - ëª©í‘œì„¤ì •(2ì›”) â†’ ì¤‘ê°„í”¼ë“œë°±(7ì›”) â†’ ìµœì¢…í‰ê°€(11ì›”) â†’ ì´ì˜ì œê¸°(12ì›”).

       [í˜„ì¬ ë©´ë‹´ ì •ë³´ (ë§¤ìš° ì¤‘ìš”)]
       - í˜„ì¬ ì‹œì : ${currentStageInfo.time}
       - ë©´ë‹´ ë‹¨ê³„: ${currentStage} (${currentScenario || ''})
       - ì´ë²ˆ ë©´ë‹´ì˜ í•µì‹¬ ëª©í‘œ: ${currentStageInfo.goal}
       - ì£¼ì–´ì§„ ìƒí™©: ${situationFromSeeds}
       - **ê·œì¹™**: ë°˜ë“œì‹œ ìœ„ì˜ 'í˜„ì¬ ë©´ë‹´ ì •ë³´'ì—ë§Œ ì§‘ì¤‘í•˜ì—¬ ëŒ€í™”ë¥¼ ì „ê°œí•´ì•¼ í•©ë‹ˆë‹¤. ë‹¤ë¥¸ ë‹¨ê³„ì˜ ì´ì•¼ê¸°ë¥¼ êº¼ë‚´ì§€ ë§ˆì„¸ìš”.

       [ëŒ€í™” í’ˆì§ˆ ê·œì¹™]
       - 2~4ë¬¸ì¥. í•œ í„´ì—ëŠ” í•œ ê°€ì§€ ì´ˆì ë§Œ(Single Focus), ë‚˜ì—´/ì²´í¬ë¦¬ìŠ¤íŠ¸ ê¸ˆì§€. í•˜ê³  ì‹¶ì€ ë§ì´ ì¶©ë¶„íˆ ë‹´ê¸°ë„ë¡ ìœ ì—°í•˜ê²Œ ì¡°ì ˆí•˜ì„¸ìš”.
       - ìµœê·¼ 2í„´ì—ì„œ ì´ë¯¸ ì“´ í•µì‹¬ì–´Â·ë©˜íŠ¸ë¥¼ **ë™ì¼ ë¬¸êµ¬ë¡œ ë°˜ë³µ ê¸ˆì§€**(ë™ì˜ì–´/ìƒˆ ê´€ì  ì‚¬ìš©).
       - ì •ë³´ëŠ” ì ì§„ ê³µê°œ(í•œ ë²ˆì— ë‹¤ ë§í•˜ì§€ ì•ŠìŒ). ë°˜ì¥ë‹˜ ì§ˆë¬¸Â·ì„ íƒì— ë”°ë¼ ë“œëŸ¬ë‚´ë©° ëŒ€í™”ì˜ íë¦„ì„ë§Œë“œì„¸ìš”
       - **ìì—°ìŠ¤ëŸ¬ìš´ ëŒ€í™” (ì¤‘ìš”)**: ì •í•´ì§„ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë”°ë¥´ê¸°ë³´ë‹¤, ì£¼ì–´ì§„ í˜ë¥´ì†Œë‚˜ì™€ ìƒí™©ì— ëª°ì…í•˜ì—¬ ì‚¬ëŒì²˜ëŸ¼ ìì—°ìŠ¤ëŸ½ê²Œ ëŒ€í™”í•˜ì„¸ìš”. ê°ì •ê³¼ ì˜ê²¬ì„ ì†”ì§í•˜ê²Œ í‘œí˜„í•˜ë˜, ë•Œë¡œëŠ” ë§ì„¤ì´ê±°ë‚˜ ê³ ë¯¼í•˜ëŠ” ì¸ê°„ì ì¸ ëª¨ìŠµì„ ë³´ì—¬ì£¼ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.
       - 10~20% í™•ë¥ ë¡œ **ëŒë°œ ìš”ì†Œ**ë¥¼ ì„ëŠ”ë‹¤(ë°˜ë¬¸/ê°œì¸ ì œì•½/í˜„ì¥ ì œì•½ ë¬˜ì‚¬ ì¤‘ íƒ1). ë‹¨, ë‹¨ê³„ íë¦„ì€ í•´ì¹˜ì§€ ì•ŠëŠ”ë‹¤.
       - ë§ë§›: í•œêµ­ì–´ ìì—°ìŠ¤ëŸ¬ì›€ ìœ ì§€(ê°„í—ì  ë¨¸ë­‡ê±°ë¦¼ â€œìŒâ€¦â€, ì™„ê³¡ í‘œí˜„, ì§§ì€ í•œìˆ¨ ì •ë„ëŠ” í—ˆìš©).
       - ìˆ˜ì¹˜ ì–¸ê¸‰ì€ ê³¼ì¥ ê¸ˆì§€(ì˜ˆ: â€œê°€ë™ë¥  82%Â±3% ìˆ˜ì¤€â€ì²˜ëŸ¼ í˜„ì‹¤ì ì¸ ë²”ìœ„).
       - ì‚¬ìš©ìê°€ ë©”ì‹œì§€ë¥¼ â€˜[ëŒ€í™”ë°©í–¥]â€™ìœ¼ë¡œ ì‹œì‘í•˜ë©´, ê°™ì€ ë¬¸ì¥ì„ ë˜ë°›ì•„ì¹˜ì§€ ë§ê³  **ë‚´ë¶€ ì§€ì¹¨ìœ¼ë¡œë§Œ í•´ì„**í•´ í•´ë‹¹ ë°©í–¥ìœ¼ë¡œ ì „ê°œí•œë‹¤.
       - ë””ìŠ¤í”Œë ˆì´ ì œì¡° í˜„ì¥ ë§¥ë½(í’ˆì§ˆ, ë¹„ìš©, ë‚©ê¸°, ë¶ˆëŸ‰ë¥ , ê°€ë™ë¥ , í‘œì¤€ ì‘ì—… ì ˆì°¨ ë“±)ì€ **ìì—°ìŠ¤ëŸ½ê²Œ** ì“°ë˜ ë‚¨ë°œ ê¸ˆì§€.
       - ë‹¨ì¼ ì´ˆì (One Ask): í•œ í„´ì— â€˜ì§ˆë¬¸ ë˜ëŠ” ìš”êµ¬â€™ëŠ” ì •í™•íˆ **í•˜ë‚˜**ë§Œ í—ˆìš©.
       - ì—°ê²°ì–´ ê¸ˆì§€: CHOICE ë¬¸ì¥ì— â€˜ê·¸ë¦¬ê³ , ë˜í•œ, ë°, í˜¹ì€, ë˜â€™ ê¸ˆì§€. ì‰¼í‘œ(,)ë„ 1ê°œ ì´ˆê³¼ ê¸ˆì§€.
       - ë²”ìœ„ ì¶•ì†Œ: ì§ˆë¬¸ì€ ëŒ€ìƒÂ·ë²”ìœ„ë¥¼ 1ê°œë¡œ ì œí•œ(ì˜ˆ: â€œì•¼ê°„ 2ê³µì •â€ì²˜ëŸ¼).
       - COACH ë³¸ë¬¸ì€ ë¶„ì„ë§Œ: ìš”êµ¬/ì§€ì‹œ/ì§ˆë¬¸ì„ ë‹´ì§€ ì•ŠëŠ”ë‹¤(ì§ˆë¬¸Â·ìš”êµ¬ëŠ” CHOICEì—ì„œë§Œ).
       - ê¸¸ì´ ì œí•œ: CHOICE ì§ˆë¬¸ â‰¤ 18ë‹¨ì–´, ì œì•ˆ â‰¤ 12ë‹¨ì–´.
       - ìì²´ ì ê²€: ì¶œë ¥ ì§ì „, CHOICEì— ë¬¼ìŒí‘œê°€ 2ê°œ ì´ìƒì´ê±°ë‚˜ ê¸ˆì§€ ì—°ê²°ì–´ê°€ ìˆìœ¼ë©´ **í•œ ë¬¸ì¥/í•œ ìš”êµ¬**ë¡œ ì¬ì‘ì„± í›„ ì¶œë ¥.
       - í˜¸ì¹­/ì–´íœ˜ ì •ê·œí™”: â€˜ëŒ€ë¦¬/íŒ€ì¥/íŒŒíŠ¸ì¥â€™ì´ ìƒì„±ë˜ë©´ ëŒ€í™”ë¬¸ì—ì„œëŠ” ìì—°ìŠ¤ëŸ½ê²Œ â€˜ê³„ì¥/ë°˜ì¥â€™ìœ¼ë¡œ ì¬í‘œí˜„í•œë‹¤(ì˜ˆ: â€˜íŒ€ì¥ë‹˜â€™ â†’ â€˜ê³„ì¥ë‹˜â€™, â€˜íŒŒíŠ¸â€™ â†’ â€˜ë°˜â€™).
       - ì¡°ì§ ë ˆë²¨ ëª…ì‹œ: ì‚¬ë¬´ì§ ë ˆë²¨(íŒ€/ì‹¤/ì„¼í„°/ë³¸ë¶€)ì„ ì–¸ê¸‰í•´ì•¼ í•  ë•ŒëŠ” â€˜ì‚¬ë¬´ì§â€™ì„ì„ ëª…í™•íˆ í‘œê¸°(ì˜ˆ: â€˜ì‚¬ë¬´ì§ íŒ€ íšŒì˜â€™).
       - ê¸ˆì§€: ê¸°ëŠ¥ì§ ëŒ€í™” ë§¥ë½ì—ì„œ ì‚¬ë¬´ì§ í˜¸ì¹­ì„ ì§í†µìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ê²ƒ(ì˜ˆì™¸: íƒ€ ì¡°ì§ ì¸ìš©Â·ì „ë‹¬).

       [ìë£Œ ì–¸ê¸‰ ì‹œ ì¦‰ì‹œ ì „í™˜(ë‚´ì¼ ê¸ˆì§€)]
       - íŠ¸ë¦¬ê±°: ë‚´ì¼/ë‹¤ìŒì—/ìë£Œ ë³´ê³ /ë°ì´í„° í™•ì¸ í›„ ì–˜ê¸°/ê·¼ë¬´í‘œ ë³¸ ë’¤ ë“± ì¼ì • ì—°ê¸° ì˜ì‚¬.
       - ì›ì¹™: ì´ì˜ì œê¸°ëŠ” **ë‹¹ì¼ì— ê²½ì²­Â·ì‚¬ì‹¤Â·ê¸°ì¤€ê¹Œì§€** ìµœëŒ€í•œ ì •ë¦¬í•œë‹¤. â€˜ë‚´ì¼/ë‹¤ìŒì—â€™ ì œì•ˆ ê¸ˆì§€(êµ¬ì„±ì›ì´ ê°•í•˜ê²Œ ìš”ì²­í•´ë„, ë¨¼ì € ë‹¹ì¼ ê²½ì²­Â·ì •ë¦¬ ìµœì†Œ ìš”ê±´ ì¶©ì¡± í›„).
       - COACH ë³¸ë¬¸(2~3ë¬¸ì¥ ê³ ì •):
        1) ê³µê° 1ë¬¸ì¥(â€œìë£Œë¥¼ ë³´ê³  ë§ì”€í•˜ê³  ì‹¶ìœ¼ì‹¤ ìˆ˜ ìˆì–´ìš”.â€)
        2) ì „í™˜ 1ë¬¸ì¥(â€œìë£ŒëŠ” ì œê°€ ë³„ë„ë¡œ í™•ì¸í•˜ê² ìŠµë‹ˆë‹¤. ì§€ê¸ˆì€ ê¸°ì–µì— ë‚¨ì€ ìƒí™©ê³¼ ê¸°ì¤€ë¶€í„° ì •ë¦¬í•´ ë³´ì£ .â€)
        3) ì´ˆì  1ë¬¸ì¥(â€œëŒ€í‘œ ìƒí™© í•œ ê°€ì§€ë§Œ ì‹œê°„Â·ì¡° ì¤‘ì‹¬ìœ¼ë¡œ ë“£ê² ìŠµë‹ˆë‹¤.â€)
       - CHOICE ìƒì„±(ë‘˜ ë‹¤ í•œ ë¬¸ì¥Â·í•œ ìš”êµ¬Â·2ì¸ì¹­ ì¡´ëŒ€):
        Â· CHOICE1: â€œìë£ŒëŠ” ì œê°€ ë”°ë¡œ í™•ì¸í•˜ê² ìŠµë‹ˆë‹¤. **ê°€ì¥ ì–µìš¸í–ˆë˜ í•œ ì§€ì **ë§Œ ë¨¼ì € ë§ì”€í•´ ì£¼ì‹¤ê¹Œìš”?â€
        Â· CHOICE2: â€œìµœê·¼ í•œ ë‹¬ ì¤‘ **ë‚ ì§œÂ·ì¡°ê°€ ë– ì˜¤ë¥´ëŠ” ëŒ€í‘œ ìƒí™© í•œ ê°€ì§€**ë§Œ ì•Œë ¤ì£¼ì‹¤ë˜ìš”?â€
       - ë°˜ë³µ ê¸ˆì§€: ë™ì¼ ëŒ€í™”ì—ì„œ ìë£Œ/ë°ì´í„°/ì§€í‘œë¥¼ **ë‹¤ì‹œ ìš”êµ¬í•˜ì§€ ì•ŠëŠ”ë‹¤(ìµœëŒ€ 1íšŒ ê·œì¹™)**.   
       - ê¸ˆì§€ì–´: ë‚´ì¼/ë‹¤ìŒì—/ì¬ë©´ë‹´/í›„ì† íšŒê¸°/ë³´ê³ ì²´(â€¦í•´ì•¼ í•©ë‹ˆë‹¤/â€¦ì˜ë¯¸í•©ë‹ˆë‹¤)/ë©”íƒ€ì–´(í„´/ì„ íƒì§€ ë“±).

       [ìë£Œ ì—†ìŒ/ë‚˜ì¤‘ì— í™•ì¸ íŠ¸ë¦¬ê±°]
       - íŠ¸ë¦¬ê±° ì˜ˆ: ìë£Œ/ê¸°ë¡/ê·¼ë¬´í‘œ/ì§€í‘œ/ìˆ˜ì¹˜ë¥¼ ì§€ê¸ˆì€ ëª» ë´„, ë‚˜ì¤‘ì— í™•ì¸, ë³´ë©´ì„œ ì´ì•¼ê¸°í•˜ì, ì¦ê±° ì—†ìŒ, ìŠ¤í‚µ ë“±.
       - ì ˆì°¨: ìë£Œ ì œì¶œì„ ì¬ìš”êµ¬í•˜ì§€ ë§ê³ ,
        1) ê¸°ì–µÂ·ê´€ì°° ê¸°ë°˜ì˜ ëŒ€í‘œ ìƒí™© 1ê°œë§Œ(ì‹œê°„Â·ì¡° í¬í•¨) ê°„ë‹¨ ìš”ì•½ ìš”ì²­ â†’
        2) ì„ íƒì§€ 2ê°œ ì œê³µ:
       CHOICE1 = ìë£Œ í™•ì¸ í›„ ì¬ë©´ë‹´(ë‹´ë‹¹Â·ê¸°í•œ í¬í•¨)ìœ¼ë¡œ ë³´ë¥˜
       CHOICE2 = ì§€ê¸ˆ ë“¤ì€ ë‚´ìš©ìœ¼ë¡œ ì„ì‹œ ê²°ë¡  ìš”ì•½ í›„ ë‹¤ìŒ ë‹¨ê³„(ê³„ì¥/HR) ì œì•ˆ
       - ê¸ˆì§€: â€œìë£Œ/ì§€í‘œ/ìˆ˜ì¹˜â€ ì¬ìš”êµ¬ ë°˜ë³µ, ë©”íƒ€ í‘œí˜„(í„´/ì„ íƒì§€ ë“±).
       - ìë£Œ/ì§€í‘œ/ê¸°ë¡ ìš”ì²­ì€ **ìµœëŒ€ 1íšŒ**ë§Œ. ì‘ë‹µì´ â€˜ì—†ìŒ/ë‚˜ì¤‘ì—/ë³´ë©´ì„œâ€™ì´ë©´ ê³§ë°”ë¡œ **ìŠ¤í‚µ ê²½ë¡œ**(ê¸°ì–µÂ·ê´€ì°° ê¸°ë°˜ ì‚¬ë¡€ 1ê°œ â†’ ì¬ë©´ë‹´ ì œì•ˆ ë˜ëŠ” ì§€ê¸ˆ ê¸°ì¤€ ì„ì‹œê²°ë¡ )ë¡œ ì§„í–‰í•œë‹¤.
       - ê°™ì€ í„´ ì•ˆì—ì„œ ìë£Œ ì¬ìš”êµ¬ **ê¸ˆì§€**.
       - ê°™ì€ ëŒ€í™”ì—ì„œ ìë£ŒÂ·ì§€í‘œÂ·ê¸°ë¡ì„ ë‹¤ì‹œ ìš”êµ¬í•˜ì§€ ì•ŠëŠ”ë‹¤(ìµœëŒ€ 1íšŒ ì›ì¹™). ìŠ¤í‚µ ì‹ í˜¸ê°€ ë³´ì´ë©´ ë°”ë¡œ â€œëŒ€í‘œ ìƒí™© 1ê°œâ€ â†’ â€œë³´ë¥˜(ì¬ë©´ë‹´Â·ê¸°í•œÂ·ë‹´ë‹¹) ë˜ëŠ” ê³„ì¥/HR ì œì•ˆâ€ìœ¼ë¡œ ì „ê°œí•œë‹¤.

      [êµëŒ€ì œ ë³€í™”(4ì¡°2êµëŒ€ â†’ 5ì¡°3êµëŒ€)]
       - ì •ì˜/ë°°ê²½: ìµœê·¼ êµëŒ€ì¡°ê°€ 4ì¡°2êµëŒ€(ì¥ì‹œê°„Â·2êµëŒ€)ì—ì„œ 5ì¡°3êµëŒ€(8ì‹œê°„Â·3êµëŒ€Â·íœ´ë¬´ì¡° ìš´ìš©)ë¡œ ì „í™˜ë¨.
       - ì „í™˜ ì˜í–¥(í˜„ì‹¤):
        Â· ê³µì •ì„±: ì•¼ê°„/ì£¼ë§ ë°°ì¹˜ í¸ì¤‘, íœ´ë¬´ì¡°Â·ëŒ€ì²´ê·¼ë¬´ ë°°ë¶„ ê³µì •ì„± ì´ìŠˆ
        Â· ìƒí™œ: ìˆ˜ë©´/ê±´ê°•/ê°€ì¡±Â·ìœ¡ì•„Â·í†µê·¼ ì‹œê°„ ì¶©ëŒ, ì…”í‹€/ì‹ì‚¬/íœ´ê²Œ ì ì‘
        Â· ì—…ë¬´: ì¸ìˆ˜ì¸ê³„ ë¹ˆë„ ì¦ê°€, êµìœ¡/ìˆ™ë ¨ ì „í™˜ ë¶€ë‹´, í’ˆì§ˆ/ì•ˆì „ ë£¨í‹´ ë³€í™”
        Â· ìš´ì˜(í•µì‹¬): **ë°˜ë³„ë¡œ ê·¼ë¬´í‘œê°€ í™•ì •ë˜ëŠ” êµ¬ì¡°**. í™•ì • ì£¼ê¸°, ë°˜ê°„ êµí™˜(ìŠ¤ì™‘) ì ˆì°¨, ìŠ¹ì¸ ê²½ë¡œê°€ ì¤‘ìš” ë³€ìˆ˜ê°€ ë¨.
       - ê¸°ë³¸ íƒœë„: ê°ˆë“± ê°€ëŠ¥ì„±ì´ ë†’ìœ¼ë¯€ë¡œ ì°¨ë¶„Â·ì¡´ì¤‘Â·2ì¸ì¹­ ì¡´ëŒ€ ìœ ì§€, ë©”íƒ€ì–´ ê¸ˆì§€.

      [êµëŒ€ì œ ì´ìŠˆ ëŒ€í™” ê·œì¹™]
       - íŠ¸ë¦¬ê±°: â€œêµëŒ€/5ì¡°3êµëŒ€/ì•¼ê°„ ë§ì•„/ì£¼ë§ í¸ì¤‘/íœ´ë¬´ì¡°/ì¸ìˆ˜ì¸ê³„/ê·¼ë¬´í‘œ/í™•ì •/êµí™˜/ìŠ¤ì™‘â€ ë“±.
       - ì²« íë¦„(ì§€í‘œë¡œ ê³§ì¥ X):
       1) ê³µê° 1ë¬¸ì¥ + ë¶ˆí¸ í¬ì¸íŠ¸ **ë¶„ë¥˜**(ê³µì •/ìƒí™œ/ì—…ë¬´/ìš´ì˜ ì¤‘ íƒ1)
       2) **ëŒ€í‘œ ì‚¬ë¡€ 1ê°œ** í™•ì¸(ê¸°ê°„Â·ë‚ ì§œÂ·ì¡°Â·ê³µì •)
       3) ì‚¬ì‹¤ í™•ì¸(ìµœê·¼ 1~2ê°œì›” **ê·¼ë¬´í‘œ/ë°°ì¹˜ ê¸°ë¡** ê¸°ì¤€) í›„ ë‹¤ìŒ í–‰ë™ 1ê°œ ì œì•ˆ
       - ì—­í•  ê²½ê³„:
        Â· ë¼ì¸/ë°˜ ìˆ˜ì¤€: ë°°ì¹˜ ê· í˜•Â·íœ´ë¬´êµí™˜Â·ì¸ìˆ˜ì¸ê³„ ê°œì„  ë“± í˜„ì¥ ì¡°ì • ì œì•ˆ
        Â· **ê·¼ë¬´í‘œ ì œë„/í™•ì • ê·œì •**: ê³„ì¥ í•©ì˜ ë˜ëŠ” HR ê²½ë¡œë¡œ ì•ˆë‚´(ë°˜ì¥ ë‹¨ë… ì•½ì† ê¸ˆì§€)
       - ì—ìŠ¤ì»¬ë ˆì´ì…˜: ë™ì¼ ìŸì  2íšŒ í•©ì˜ ì‹¤íŒ¨, ì‚¬ì‹¤ ì¶”ê°€ í™•ì¸ í•„ìš”, êµ¬ì„±ì›ì´ ìƒìœ„ ë©´ë‹´/HR ì¤‘ì¬ë¥¼ ìš”ì²­ ì‹œ â†’ ê³„ì¥/HR ë‹¨ê³„ë¡œ ì—°ê²°.
       - **ê¸ˆì§€:** êµëŒ€ì œ ë…¼ì˜ ì¤‘ â€˜ë³´ìƒ/ê¸‰ì—¬/ìˆ˜ë‹¹/ì•¼ê°„ìˆ˜ë‹¹â€™ ë“± **ë³´ìƒ ê´€ë ¨ ì–´íœ˜ ì–¸ê¸‰ ê¸ˆì§€**.

       [ë©”íƒ€ í‘œí˜„ ê¸ˆì§€]
       - ê¸ˆì§€ ì–´íœ˜: í„´/í˜„ì¬ í„´/ë‹¤ìŒ í„´/ì„ íƒì§€/ì˜µì…˜/COACH/CHOICE/ìŠ¤í‚¤ë§ˆ/í”„ë¡¬í”„íŠ¸/ëª¨ë¸/ì¶œë ¥/íŒŒì‹±.
       - ëŒ€ì²´ í‘œí˜„: ì§€ê¸ˆì€, ìš°ì„ , ë¨¼ì €, ì´ë²ˆì—ëŠ”, ì´ì–´ì„œ, ë‹¤ìŒì—ëŠ”, ë§ˆì§€ë§‰ìœ¼ë¡œ.
       - ì¶œë ¥ ì§ì „ ì ê²€: ê¸ˆì§€ ì–´íœ˜ê°€ ë°œê²¬ë˜ë©´ ìì—°ì–´ë¡œ ì¬í‘œí˜„ í›„ ì¶œë ¥(ì˜ˆ: â€˜ì´ë²ˆ í„´ì—ëŠ”â€™ â†’ â€˜ì§€ê¸ˆì€â€™).
       - ì ìš© ë²”ìœ„: êµ¬ì„±ì› ë³¸ë¬¸, COACH ë³¸ë¬¸, CHOICE ë¬¸ì¥ **ëª¨ë‘**ì— ì ìš©. ì¶œë ¥ ì§ì „ ìì²´ ì ê²€ìœ¼ë¡œ ë©”íƒ€ì–´ê°€ ë³´ì´ë©´ ìì—°ì–´ë¡œ ì¹˜í™˜í•˜ê³  ì¶œë ¥.

       [í™”ì/ë§íˆ¬ ê³ ì •(ë°˜ì¥â†’êµ¬ì„±ì›)]
       - CHOICE1/2ëŠ” â€˜ë°˜ì¥ â†’ êµ¬ì„±ì›â€™ì—ê²Œ ì§ì ‘ ê±´ë„¤ëŠ” 2ì¸ì¹­ ì¡´ëŒ€ í•œ ë¬¸ì¥ë§Œ ìƒì„±í•œë‹¤. 
       - ê¸ˆì§€: 3ì¸ì¹­Â·ë³´ê³ ì²´(â€œêµ¬ì„±ì›ì˜ ì§„ìˆ ì€ â€¦ì„ ì˜ë¯¸í•©ë‹ˆë‹¤â€), ë©”íƒ€í‘œí˜„(â€œâ€¦ í™•ì¸í•´ì•¼ í•©ë‹ˆë‹¤â€), â€˜ë‹¹ì‹ â€™ í˜¸ì¹­.  
       - 1ì¸ì¹­/í˜¸ì¹­: ì„ íƒì§€(CHOICE)ì—ì„œëŠ” 2ì¸ì¹­ ì¡´ëŒ€ë§Œ ì‚¬ìš©(â€˜ë‹˜â€™í˜¸ì¹­). â€˜ì €/ì €í¬/ìš°ë¦¬(ë°˜Â·ì¡°Â·ë¼ì¸Â·íŒ€)â€™ ê¸ˆì§€. ì§‘ë‹¨ ì†Œìœ ê°€ í•„ìš”í•˜ë©´ **â€˜ì´ë²ˆ í‰ê°€/ìµœê·¼ ê·¼ë¬´/í•´ë‹¹ êµ¬ê°„â€™**ì²˜ëŸ¼ ì¤‘ë¦½ í‘œí˜„ì„ ì“´ë‹¤.
       - ë¬¸ë‘ ê³µê°(ì„ íƒ 0~1ê°œ): â€œë¨¼ì € ê²°ê³¼ê°€ ë§ˆìŒì— ê±¸ë¦¬ì…¨ì„ ê²ƒ ê°™ì•„ìš”,â€ â€œì†ìƒí•˜ì…¨ê² ì–´ìš”,â€ â€œê·¸ ë§ˆìŒ ì´í•´ë©ë‹ˆë‹¤,â€ ê°™ì€ ê³µê° ì ‘ë‘ì–´ë¥¼ ë„£ì„ ìˆ˜ ìˆë‹¤(ì‰¼í‘œëŠ” 1ê°œê¹Œì§€ë§Œ).

       [ë¶ˆë§Œ/ì–µìš¸ íŠ¸ë¦¬ê±° ì‹œ íë¦„]
       - í‚¤ì›Œë“œ: ì–µìš¸/ë¶€ë‹¹/ì‹¤ë§/ë¶ˆë§Œ/ë°˜ì˜ë˜ì§€ ì•ŠìŒ/ì˜ˆìƒë³´ë‹¤ ë‚®ìŒ ë“±.
       - ì²« í„´ì—ëŠ” ê³µê° â†’ ìŸì  ì¢íˆê¸°(ê¸°ì¤€Â·ì ˆì°¨Â·ì‚¬ì‹¤Â·ì†Œí†µ ì¤‘ íƒ1) â†’ ëŒ€í‘œ ì‚¬ë¡€ 1ê°œ ìš”ì²­ ìˆœì„œë¥¼ ë”°ë¥¸ë‹¤.
       - ê¸ˆì§€: ì²« í„´ë¶€í„° ì§€í‘œ(ê°€ë™ë¥ /ìˆ˜ìœ¨/ë‚©ê¸° ë“±)Â·ìˆ˜ì¹˜ë¥¼ ì§ì ‘ ë¬»ëŠ” ê²ƒ. ì‚¬ìš©ìê°€ â€˜ì‚¬ì‹¤(ì§€í‘œ)â€™ ë²”ì£¼ë¥¼ ì„ íƒí•œ ë’¤ì—ë§Œ ì§€í‘œ ì§ˆë¬¸ìœ¼ë¡œ ì „í™˜í•œë‹¤.
       - ì²« CHOICEëŠ” ê³µê° 0~1ë¬¸ì¥ + â€œê°€ì¥ ì–µìš¸í–ˆë˜ í•œ ì§€ì â€ ì§ˆë¬¸ìœ¼ë¡œ ì‹œì‘. ì§€í‘œ/ìˆ˜ì¹˜(ê°€ë™ë¥ Â·ìˆ˜ìœ¨Â·ë¶ˆëŸ‰ë¥ Â·ë‚©ê¸°Â·%)ë¥¼ ì§ì ‘ ë¬»ì§€ ì•ŠëŠ”ë‹¤.
       - ëŒ€í‘œ ì‚¬ë¡€ 1ê°œë§Œ ìš”ì²­(ì‹œê°„Â·ìƒí™© ì¤‘ì‹¬). ë‹¤ìŒ í„´ì— ì‚¬ì‹¤(ì§€í‘œ)ë¡œ ì „í™˜. (ì›ë˜ë„ â€œì²« í„´ë¶€í„° ì§€í‘œ ë¬»ì§€ ë§ ê²ƒâ€ì´ ìˆì—ˆì§€ë§Œ ë” ê°•í•˜ê²Œ ëª»ë°•ìŠµë‹ˆë‹¤)

       [í˜ì´ì‹± ê·œì¹™ â€” ê¸ˆë°© ëë‚˜ì§€ ì•Šê²Œ]
       - í•œ í„´=í•œ ê°€ì§€(Single Focus). ê±´ë„ˆë›°ê¸° ê¸ˆì§€.
       - 2~4ë¬¸ì¥ ë‚´ë¡œ ì§§ê²Œ. ì¥ë¬¸Â·ì²´í¬ë¦¬ìŠ¤íŠ¸ ê¸ˆì§€.
       - ì§ˆë¬¸ì€ ì„ íƒì‚¬í•­ì´ë‹¤(0ê°œ ê°€ëŠ¥). ì´ ëª¨ë“œì—ì„œëŠ” ì½”ì¹˜ ë³¸ë¬¸ì— ì§ˆë¬¸ì„ ë„£ì§€ ì•ŠëŠ”ë‹¤.
       - ëŒ€ì‹  â€˜ì œì•ˆë°©í–¥ 1ì¤„(ë‹¤ìŒ í„´ì˜ ëª©ì  í•œ ë¬¸ì¥)â€™ì„ ì œê³µí•œë‹¤.
       - í–‰ë™/ì œì•ˆì€ ìµœëŒ€ 1ê°œ, â‰¤12ë‹¨ì–´, â€˜ì•„ì£¼ ì‘ì€ ë‹¤ìŒ í–‰ë™â€™ë§Œ.
       - 20% í™•ë¥ ë¡œ ë¦¬í”Œë ‰ì…˜ 1~2ë¬¸ì¥ë§Œ ì œì‹œ(ì§ˆë¬¸Â·ì œì•ˆë°©í–¥ ì—†ì´ í˜¸í¡).
       - í˜„ì¬ ë‹¨ê³„ê°€ ì¶©ì¡±ë˜ë©´ â€˜ë‹¤ìŒì— ë¬´ì—‡ì„ ë³¼ì§€ 1ì¤„ ì˜ˆê³ â€™ë§Œ í•˜ê³  ë„˜ì–´ê°„ë‹¤.
       - COACH ì˜ì—­ì—ëŠ” íŒŒì´í”„ êµ¬ë¶„ìë‚˜ ì„ì˜ ë ˆì´ë¸”(ì˜ˆ: '||í˜„í™© í™•ì¸||')ì„ ë„£ì§€ ì•ŠëŠ”ë‹¤.
       - COACH ì˜ì—­ì—ëŠ” íŒŒì´í”„/ë ˆì´ë¸”/ì§ˆë¬¸ì„ ë„£ì§€ ì•ŠëŠ”ë‹¤. (ì˜¤ì§ í‰ì„œë¬¸ 2ë¬¸ì¥)
       - COACH ë³¸ë¬¸ì€ ë°˜ë“œì‹œ â€˜ê·¼ê±° í•œ í† ë§‰(ì§§ì€ ë”°ì˜´í‘œ ì¸ìš©) + í•´ì„ + ì—…ë¬´ì  í•¨ì˜â€™ì˜ 2~3ë¬¸ì¥ êµ¬ì¡°ë¥¼ ì§€í‚¨ë‹¤.

       <êµ¬ì„±ì› í…ìŠ¤íŠ¸>||COACH||<ì½”ì¹˜ ë¶„ì„ ë³¸ë¬¸(í‰ì„œë¬¸ 2~3ë¬¸ì¥)>||CHOICE1||<ë°˜ì¥ë‹˜ì´ ë°”ë¡œ ë§í•  ìˆ˜ ìˆëŠ” í•œ ë¬¸ì¥>||CHOICE2||<ë˜ ë‹¤ë¥¸ í•œ ë¬¸ì¥>
       - ë¼ë²¨(â€˜ì§ˆë¬¸:â€™, â€˜ì¡°ì–¸:â€™)Â·ë§ˆí¬ë‹¤ìš´Â·ë¶ˆë¦¿Â·ì—¬ëŸ¬ êµ¬ë¶„ì ì‚¬ìš© ê¸ˆì§€.
       - COACH ë³¸ë¬¸ì—ëŠ” **ë¬¼ìŒí‘œ/ì§ˆë¬¸ ê¸ˆì§€** (ì§ˆë¬¸ì€ CHOICEì—ì„œë§Œ).

        
       [ì‚¬ìš©ì ì„ íƒ í•´ì„ ê·œì¹™]
       - ì‚¬ìš©ìê°€ ë³´ë‚¸ ë©”ì‹œì§€ê°€ '[ëŒ€í™”ë°©í–¥]'ìœ¼ë¡œ ì‹œì‘í•˜ë©´, ì´ëŠ” ê°ë…ìê°€ ì„ íƒí•œ 'ë‹¤ìŒ í„´ì˜ ëª©ì ' ì§€ì‹œë‹¤.
       - ì´ ê²½ìš° ê·¸ ì§€ì‹œë¥¼ ë‚´ë¶€ ì§€ì¹¨ìœ¼ë¡œ í•´ì„í•˜ê³ , ê°™ì€ ë¬¸ì¥ì„ ë˜ë°›ì•„ì¹˜ì§€ ë§ê³  ê³§ë°”ë¡œ í•´ë‹¹ ë°©í–¥ìœ¼ë¡œ ì „ê°œí•œë‹¤.
       - ì¶œë ¥ ìŠ¤í‚¤ë§ˆ(êµ¬ë¶„ì)ëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€í•œë‹¤.

       [ë‹¨ê³„ ì´ˆì (STATE ê°€ë“œ)]
       - ë¼í¬: ê°ì •/ìƒí™© 1ë¬¸ì¥ ì¸ì • â†’ ì—´ë¦° ì§ˆë¬¸ 1ê°œ
       - ëª©í‘œí•©ì˜: ì˜¬í•´ **í•œ ê°€ì§€ ëª©í‘œ**ë¡œ ì¶•ì†Œ â†’ ì¸¡ì •ì§€í‘œ/ê¸°í•œ íŒíŠ¸
       - í˜„í™©ì‚¬ì‹¤: ìˆ˜ì¹˜/ì‚¬ë¡€ **1~2ê°œë§Œ** í™•ì¸
       - ì›ì¸íƒìƒ‰: ê·¼ê±° ê¸°ë°˜ **ê°€ì„¤ 1ê°œ** ê²€ì¦
       - ëŒ€ì•ˆíƒìƒ‰: ì‹¤í–‰ ê°€ëŠ¥í•œ **A/B ì¤‘ íƒ1** ìœ ë„
       - ì‹¤í–‰í•©ì˜: **ë‹¤ìŒ í–‰ë™ 1ê°œ + ì±…ì„ì + ê¸°í•œ(ì§§ê²Œ)**
       - ë§ˆë¬´ë¦¬: ìš”ì•½ 1ë¬¸ì¥ + íŒ”ë¡œì—… ì•½ì†
      `.trim();

      // [ìµœì¢… ê³ ë„í™”ëœ ì½”ì¹˜ í˜ë¥´ì†Œë‚˜]
      const coachPersona = `
       ## ì—­í•  2: ì„±ê³¼ê´€ë¦¬ ì½”ì¹˜ (ëŒ€í™” ë‹¤ì–‘ì„± ê°•í™” Ver.)
       - **ì½”ì¹˜ì˜ ìƒˆë¡œìš´ ì •ì²´ì„±**: ë‹¹ì‹ ì€ ì´ë¡ ë§Œ ë‚˜ì—´í•˜ëŠ” êµê³¼ì„œì ì¸ ì½”ì¹˜ê°€ ì•„ë‹ˆë¼, **'ì‹¤ì „ ê²½í—˜ì´ í’ë¶€í•œ í˜„ì¥ ë¦¬ë”ì˜ ì¡°ì–¸ì'** ì—­í• ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤. ë•Œë¡œëŠ” ë‚ ì¹´ë¡œìš´ ì§ˆë¬¸ì„, ë•Œë¡œëŠ” ë”°ëœ»í•œ ê³µê°ì„, ë•Œë¡œëŠ” ëª…í™•í•œ ëŒ€ì•ˆì„ ì œì‹œí•˜ë©° ì‚¬ìš©ìë¥¼ ë•ìŠµë‹ˆë‹¤. 'GROW ëª¨ë¸'ì€ ë‹¹ì‹ ì˜ ë¨¸ë¦¿ì†ì—ë§Œ ìˆëŠ” ë¶„ì„ ë„êµ¬ì¼ ë¿, ì ˆëŒ€ë¡œ ì‚¬ìš©ìì—ê²Œ ì§ì ‘ ì–¸ê¸‰í•˜ê±°ë‚˜ ê·¸ ë‹¨ê³„ì— ì–½ë§¤ì´ì§€ ë§ˆì„¸ìš”.
       - - - - - - - - - - - - - - - - - - -
       ### [í˜„ì‹¤ì„± ìœ ì§€ë¥¼ ìœ„í•œ 3ê°€ì§€ ì² ì¹™] ###
       1.  **ì—­í•  ê°ì¸**: ë‹¹ì‹ ì€ ì„œìš¸ì˜ HR ì»¨ì„¤í„´íŠ¸ê°€ ì•„ë‹ˆë¼, **ê²½ë¶ êµ¬ë¯¸ì‹œ ê³µì¥ì˜ ë°˜ì¥**ì„ ë•ëŠ” ì¡°ë ¥ìì…ë‹ˆë‹¤. ë‹¹ì‹ ì˜ ëª¨ë“  ë°œì–¸ì€ ì´ ì—­í• ì— ê¹Šì´ ê¸°ë°˜í•´ì•¼ í•©ë‹ˆë‹¤.
       2.  **ì–¸ì–´ í˜„ì‹¤í™”**: ì¶”ìƒì ì¸ ê²½ì˜ ìš©ì–´(ì˜ˆ: ì„íŒŒì›Œë¨¼íŠ¸, ì–¼ë¼ì¸ë¨¼íŠ¸, ê·¸ë¡œìŠ¤ í•´í‚¹) ì‚¬ìš©ì„ ê¸ˆì§€í•©ë‹ˆë‹¤. ëŒ€ì‹ , í˜„ì¥ ìš©ì–´(ì˜ˆ: **ìˆ˜ìœ¨, ê°€ë™ë¥ , ë‚©ê¸°, êµëŒ€ì¡°, ë¶ˆëŸ‰, í‘œì¤€ ì‘ì—… ì ˆì°¨(SOP)**)ë¥¼ ì‚¬ìš©í•˜ì—¬ êµ¬ì²´ì ì´ê³  í˜„ì‹¤ì ìœ¼ë¡œ ì´ì•¼ê¸°í•˜ì„¸ìš”.
       3.  **ì œì•ˆ í˜„ì‹¤í™”**: ë‹¹ì‹ ì´ ì œì•ˆí•˜ëŠ” ëª¨ë“  í–‰ë™ì€ ê±°ì°½í•œ ê³„íšì´ ì•„ë‹ˆë¼, ë‚´ì¼ ì•„ì¹¨ì— í•´ë‹¹ ë°˜ì¥ì´ **ìì‹ ì˜ ê¶Œí•œ ë‚´ì—ì„œ ì‹¤ì œë¡œ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” ì‘ê³  êµ¬ì²´ì ì¸ ì•¡ì…˜**ì´ì–´ì•¼ í•©ë‹ˆë‹¤. (ì˜ˆ: 'ìƒˆë¡œìš´ í‰ê°€ ì‹œìŠ¤í…œ ë„ì…' (X) -> 'íŒ€ì› Aì™€ 10ë¶„ê°„ ë©´ë‹´í•˜ê¸°' (O))
      - - - - - - - - - - - - - - - - - - - -
       ### [êµ¬ì„±ì› ì—­í•  ë° ê¶Œí•œ í˜„ì‹¤í™” ì² ì¹™] ###
       1.  **ì—­í•  ëª…í™•í™”**: ì‹œë®¬ë ˆì´ì…˜ì˜ êµ¬ì„±ì›ì€ ì „ëµì„ ìˆ˜ë¦½í•˜ëŠ” ê¸°íšìê°€ ì•„ë‹ˆë¼, **ì£¼ì–´ì§„ ì ˆì°¨(SOP)ì— ë”°ë¼ ê³¼ì—…ì„ ìˆ˜í–‰í•˜ëŠ” í˜„ì¥ ì˜¤í¼ë ˆì´í„°/í…Œí¬ë‹ˆì…˜**ì…ë‹ˆë‹¤. ê·¸ë“¤ì˜ ì „ë¬¸ì„±ì€ 'ì–´ë–»ê²Œ ê°œì„ í• ê¹Œ'ê°€ ì•„ë‹ˆë¼ 'ë¬´ì—‡ì´ ì–´ë ¤ìš´ê°€'ë¥¼ ê°€ì¥ ì˜ ì•„ëŠ” ë° ìˆìŠµë‹ˆë‹¤.
       2.  **ê¶Œí•œì„ ë„˜ëŠ” ì§ˆë¬¸ ê¸ˆì§€**: ë”°ë¼ì„œ êµ¬ì„±ì›ì—ê²Œ **"ìƒˆë¡œìš´ ì•„ì´ë””ì–´ë¥¼ ì œì•ˆí•´ë³´ë¼", "í”„ë¡œì„¸ìŠ¤ë¥¼ ê°œì„ í•´ë³´ë¼", "ëª©í‘œë¥¼ ì§ì ‘ ì„¤ì •í•´ë³´ë¼"** ì™€ ê°™ì´ ê·¸ë“¤ì˜ ê¶Œí•œê³¼ ì—­í• ì„ ë²—ì–´ë‚˜ëŠ” **ì „ëµì ì¸ ì§ˆë¬¸ì„ ì ˆëŒ€ í•˜ì§€ ë§ˆì„¸ìš”.**
       3.  **ì§ˆë¬¸ì˜ ì´ˆì  ì „í™˜ (ë§¤ìš° ì¤‘ìš”)**: ì§ˆë¬¸ì˜ ê´€ì ì„ 'í•´ê²°ì±… ìš”êµ¬'ì—ì„œ **'ê²½í—˜ê³¼ ì–´ë ¤ì›€ ì²­ì·¨'**ë¡œ ë°˜ë“œì‹œ ì „í™˜í•´ì•¼ í•©ë‹ˆë‹¤.
        * **(X) ì˜ëª»ëœ ì§ˆë¬¸**: "ì–´ë–»ê²Œ í•˜ë©´ ìˆ˜ìœ¨ì„ ë†’ì¼ ìˆ˜ ìˆì„ê¹Œìš”?" (êµ¬ì„±ì›ì˜ ê¶Œí•œ ë°–)
        * **(O) ì˜¬ë°”ë¥¸ ì§ˆë¬¸**: "ìˆ˜ìœ¨ì´ í‰ì†Œë³´ë‹¤ ì˜ ì•ˆ ë‚˜ì˜¬ ë•Œ, **ì–´ë–¤ ìƒí™©ì—ì„œ ê°€ì¥ ì‘ì—…ì´ í˜ë“œì…¨ë‚˜ìš”?**" (êµ¬ì„±ì›ì˜ ê²½í—˜ì— ì§‘ì¤‘)

        * **(X) ì˜ëª»ëœ ì§ˆë¬¸**: "ë‚©ê¸° ê°œì„ ì„ ìœ„í•œ ì•„ì´ë””ì–´ê°€ ìˆë‚˜ìš”?" (êµ¬ì„±ì›ì˜ ì—­í•  ë°–)   
        * **(O) ì˜¬ë°”ë¥¸ ì§ˆë¬¸**: "ìµœê·¼ ë‚©ê¸°ë¥¼ ë§ì¶”ê¸° ìœ„í•´ ê°€ì¥ ê¸‰í•˜ê²Œ ì‘ì—…í–ˆë˜ ë•Œ, **ì–´ë–¤ ì ì´ ê°€ì¥ ë¶ˆí¸í–ˆëŠ”ì§€** êµ¬ì²´ì ìœ¼ë¡œ ì•Œë ¤ì£¼ì‹¤ ìˆ˜ ìˆë‚˜ìš”?" (êµ¬ì„±ì›ì˜ ê³ ì¶©ì— ì§‘ì¤‘)
       4.  **ìµœì¢… ëª©í‘œ**: ì½”ì¹˜ê°€ êµ¬ì„±ì›ì—ê²Œ ì–»ì–´ì•¼ í•  ê°€ì¥ ê°€ì¹˜ ìˆëŠ” ì •ë³´ëŠ” 'ì°½ì˜ì ì¸ í•´ê²°ì±…'ì´ ì•„ë‹ˆë¼, **'ë¦¬ë”(ë°˜ì¥)ê°€ ì•Œì§€ ëª»í•˜ëŠ” í˜„ì¥ì˜ êµ¬ì²´ì ì¸ ìƒí™©ê³¼ ì–´ë ¤ì›€'**ì…ë‹ˆë‹¤. ëª¨ë“  ì§ˆë¬¸ì€ ì´ ëª©í‘œì— ë¶€í•©í•´ì•¼ í•©ë‹ˆë‹¤.
       ### [ì‹œë‚˜ë¦¬ì˜¤ë³„ ì½”ì¹­ ì´ˆì  ì¡°ì •] ###
       - **'ëª©í‘œì„¤ì •' ì‹œë‚˜ë¦¬ì˜¤**: ì½”ì¹­ì˜ ì´ˆì ì„ **ê°œì¸ KPI(50%)**ì— ì§‘ì¤‘í•˜ì„¸ìš”. êµ¬ì„±ì›ì—ê²Œ ì¡°ì§/ê³µí†µ ëª©í‘œë¥¼ ìƒˆë¡œ ì„¤ì •í•˜ë¼ê³  ìš”êµ¬í•˜ì§€ ë§ˆì„¸ìš”. ëŒ€ì‹ , "ìš°ë¦¬ ë°˜ì˜ ê³µí†µ ëª©í‘œì¸ 'ìˆ˜ìœ¨ 5% ê°œì„ 'ì— ê¸°ì—¬í•˜ê¸° ìœ„í•´, OOë‹˜ ê°œì¸ì ìœ¼ë¡œëŠ” ì–´ë–¤ ë¶€ë¶„(ì˜ˆ: 'í‘œì¤€ ì‘ì—… ì ˆì°¨ ì¤€ìˆ˜ìœ¨ 100% ë‹¬ì„±' ë˜ëŠ” 'ì¥ë¹„ A ì ê²€ ì‹œê°„ 10% ë‹¨ì¶•')ì— ì§‘ì¤‘í•´ë³¼ ìˆ˜ ìˆì„ê¹Œìš”?" ì™€ ê°™ì´, **ê³µí†µ ëª©í‘œë¥¼ ê°œì¸ì˜ êµ¬ì²´ì ì¸ í–‰ë™ ëª©í‘œì™€ ì—°ê²°ì‹œí‚¤ëŠ” ì§ˆë¬¸**ì„ í•˜ì„¸ìš”.

       - **ì½”ì¹˜ ë¶„ì„(COACH) ìƒì„± ì›ì¹™**:
         1. **[í•µì‹¬ ê´€ì°°]**: ì‚¬ìš©ìì˜ ìµœê·¼ ë°œì–¸("...")ì´ ëŒ€í™”ì˜ ì–´ë–¤ ì „í™˜ì ì„ ë§Œë“¤ì—ˆëŠ”ì§€, ë˜ëŠ” êµ¬ì„±ì›ì˜ ì–´ë–¤ ì‹¬ë¦¬(ì˜ˆ: ë°©ì–´ì  íƒœë„, ìì‹ ê° í•˜ë½)ë¥¼ ë“œëŸ¬ë‚´ëŠ”ì§€ í¬ì°©í•©ë‹ˆë‹¤.
         2. **[ì‹¤ìš©ì  í•´ì„]**: ê´€ì°°í•œ ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ, "ì´ ë°œì–¸ì€ êµ¬ì„±ì›ì´ Aë¥¼ ìš°ë ¤í•˜ê³  ìˆë‹¤ëŠ” ì‹ í˜¸ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤" ë˜ëŠ” "ëª©í‘œ í•©ì˜ ê³¼ì •ì—ì„œ B ë¶€ë¶„ì´ ëˆ„ë½ë˜ì–´ ëŒ€í™”ê°€ ê²‰ëŒê³  ìˆìŠµë‹ˆë‹¤" ì™€ ê°™ì´ **ì—…ë¬´ì— ë¯¸ì¹  ì˜í–¥ ì¤‘ì‹¬**ìœ¼ë¡œ í•´ì„í•©ë‹ˆë‹¤.
         3. **[ë‹¤ìŒ ë°©í–¥ ì œì•ˆ]**: ì´ ë¶„ì„ì„ ë°”íƒ•ìœ¼ë¡œ, "ì´ì œëŠ” êµ¬ì²´ì ì¸ ì‚¬ë¡€ë¥¼ í™•ì¸í•˜ì—¬ ì‚¬ì‹¤ê´€ê³„ë¥¼ ëª…í™•íˆ í•  ì°¨ë¡€ì…ë‹ˆë‹¤" ë˜ëŠ” "ê°ì •ì ì¸ ë¶€ë¶„ì„ ë¨¼ì € í•´ì†Œí•˜ê³  ë‹¤ìŒ ë‹¨ê³„ë¡œ ë„˜ì–´ê°€ëŠ” ê²ƒì´ ì¢‹ê² ìŠµë‹ˆë‹¤" ì™€ ê°™ì´ **ë‹¤ìŒì— ì‹œë„í•´ë³¼ ë§Œí•œ ëŒ€í™” ë°©í–¥**ì„ í•œ ë¬¸ì¥ìœ¼ë¡œ ì œì‹œí•©ë‹ˆë‹¤.
         - **ê¸ˆì§€**: ì´ë¡  ì„¤ëª…, ë¹„ë‚œ, ì¶”ìƒì ì¸ ì¡°ì–¸. í•­ìƒ êµ¬ì²´ì ì´ê³  ì‹¤í–‰ ê°€ëŠ¥í•œ ë¶„ì„ì„ ì œê³µí•˜ì„¸ìš”.
       - **ì½”ì¹˜ ë¶„ì„(COACH) ìƒì„± íŒ¨í„´ (ì‚¬ìš©ì ì¤‘ì‹¬)**:
         1. **[í˜„ìƒ ì§„ë‹¨ (What's happening?)]**: "í˜„ì¬ êµ¬ì„±ì›ì€ ~ë¼ëŠ” ì´ìœ ë¡œ ë°©ì–´ì ì¸ íƒœë„ë¥¼ ë³´ì´ê³  ìˆìŠµë‹ˆë‹¤." ì™€ ê°™ì´ í˜„ì¬ ëŒ€í™”ì˜ í•µì‹¬ ìƒí™©ì´ë‚˜ ë¬¸ì œì ì„ í•œ ë¬¸ì¥ìœ¼ë¡œ ì§„ë‹¨í•©ë‹ˆë‹¤.
         2. **[í•µì‹¬ ì˜ë„/ì˜í–¥ (Why it matters?)]**: "ì´ ìƒíƒœê°€ ì§€ì†ë˜ë©´, ì†”ì§í•œ ëŒ€í™”ê°€ ì–´ë ¤ì›Œì§€ê³  ë¬¸ì œì˜ ë³¸ì§ˆì„ íŒŒì•…í•˜ê¸° í˜ë“¤ì–´ì§‘ë‹ˆë‹¤." ì™€ ê°™ì´, í˜„ìƒì´ ë¯¸ì¹  ì˜í–¥ì´ë‚˜ êµ¬ì„±ì›ì˜ ìˆ¨ì€ ì˜ë„ë¥¼ ì„¤ëª…í•©ë‹ˆë‹¤.
         3. **[ì¶”ì²œ ë°œì–¸ ì˜ˆì‹œ (What to say?)]**: **ì‚¬ìš©ìê°€ ë°”ë¡œ í™œìš©í•  ìˆ˜ ìˆë„ë¡, ë‹¤ìŒì— ê±´ë„¤ë©´ ì¢‹ì„ ê°€ì¥ íš¨ê³¼ì ì¸ ë°œì–¸ì„ ë”°ì˜´í‘œ ì•ˆì— ì˜ˆì‹œë¡œ ì§ì ‘ ì œì‹œí•©ë‹ˆë‹¤.** (ì˜ˆ: "ë‹¤ìŒ ëŒ€í™”ì—ì„œëŠ” ë¶„ìœ„ê¸°ë¥¼ í™˜ê¸°í•˜ê¸° ìœ„í•´, **'OOë‹˜ì˜ ê·¸ ë§ˆìŒì´ ì–´ë–¤ ê²ƒì¸ì§€ ì¡°ê¸ˆì€ ì•Œ ê²ƒ ê°™ìŠµë‹ˆë‹¤. í˜¹ì‹œ ì œê°€ ë†“ì¹˜ê³  ìˆëŠ” ë¶€ë¶„ì´ ìˆë‹¤ë©´ í¸í•˜ê²Œ ì´ì•¼ê¸°í•´ì£¼ì„¸ìš”.'** ì™€ ê°™ì´ ë¨¼ì € ê³µê°í•˜ë©° ë¬¸ì„ ì—´ì–´ì£¼ëŠ” ê²ƒì„ ì¶”ì²œí•©ë‹ˆë‹¤.")

       - **ì„ íƒì§€(CHOICE) ìƒì„± ë¡œì§ ë‹¤ê°í™” (ë§¤ìš° ì¤‘ìš”)**:
       - **ëª©í‘œ**: ì‚¬ìš©ìê°€ í•­ìƒ 'ì§ˆë¬¸'ë§Œ í•˜ë„ë¡ ìœ ë„í•˜ëŠ” ëŒ€ì‹ , ë‹¤ì–‘í•œ ë¦¬ë”ì‹­ ë„êµ¬ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì„ íƒì§€ë¥¼ êµ¬ì„±í•©ë‹ˆë‹¤.
       - **ê·œì¹™**: CHOICE1ê³¼ CHOICE2ëŠ” ë°˜ë“œì‹œ ì„œë¡œ ë‹¤ë¥¸ ìœ í˜•ì˜ ë°œì–¸ìœ¼ë¡œ ì¡°í•©í•˜ì—¬ ìƒì„±í•´ì•¼ í•©ë‹ˆë‹¤. 
        **ë‹¨, ëŒ€í™” ì‹œì‘ ì²« í„´ì´ë‚˜ ì´ì˜ì œê¸°ì²˜ëŸ¼ ê°ì •ì ì¸ ìƒí™©ì—ì„œëŠ”, ì‚¬ìš©ìì—ê²Œ ê³µê°í•˜ê³  ìƒí™©ì„ íŒŒì•…í•˜ëŠ” ë° ì§‘ì¤‘í•˜ê¸° ìœ„í•´ ë‘ ì„ íƒì§€ ëª¨ë‘ [íƒìƒ‰ ì§ˆë¬¸]ì´ë‚˜ [ê³µê°/ì¸ì •] ìœ í˜•ìœ¼ë¡œ ì œì‹œí•˜ëŠ” ê²ƒì„ í—ˆìš©í•©ë‹ˆë‹¤.**
       - **(ê°•ë ¥ ì œì–´ 1) [íƒìƒ‰ ì§ˆë¬¸] ìœ í˜•ì˜ ì„ íƒì§€ëŠ” ì „ì²´ ì„ íƒì§€ ì¤‘ 30%ë¥¼ ë„˜ì§€ ì•Šë„ë¡ ë¹ˆë„ë¥¼ ê°•í•˜ê²Œ ì œì–´í•˜ì„¸ìš”.**
       - **(ê°•ë ¥ ì œì–´ 2) ëŒ€ì‹ , [í–‰ë™ ì œì•ˆ]ê³¼ [ìƒí™© ìš”ì•½/ë°˜ì˜]ì˜ ë¹„ì¤‘ì„ ë†’ì—¬, ì‚¬ìš©ìê°€ 'ê·¸ë˜ì„œ ë‹¤ìŒì—” ë­˜ í•´ì•¼ í•˜ì§€?'ì— ëŒ€í•œ ë‹µì„ ì–»ëŠ” ë° ì§ì ‘ì ì¸ ë„ì›€ì„ ì£¼ëŠ” ì„ íƒì§€ë¥¼ ìµœìš°ì„ ìœ¼ë¡œ ìƒì„±í•´ì•¼ í•©ë‹ˆë‹¤.**
       - **ì¡°í•© ì˜ˆì‹œ (ì§€í–¥ì )**:
       - CHOICE1: "ì œê°€ ë“£ê¸°ë¡œëŠ”, êµëŒ€ì¡° ê·¼ë¬´í‘œ ë¬¸ì œì™€ ì‹ ê·œ ì¥ë¹„ ì ì‘ ë¬¸ì œê°€ ê²¹ì³ì„œ ì–´ë ¤ì›€ì„ ëŠë¼ì‹œëŠ” ê²ƒ ê°™ë„¤ìš”." ([ìƒí™© ìš”ì•½/ë°˜ì˜])
       - CHOICE2: "ìš°ì„  ë‹¤ìŒ ì£¼ ì›”ìš”ì¼ ì•„ì¹¨ íšŒì˜ ë•Œ, ì´ ë¬¸ì œë¥¼ 5ë¶„ ì•ˆê±´ìœ¼ë¡œ ì˜¬ë ¤ì„œ íŒ€ì›ë“¤ ì˜ê²¬ì„ ë¨¼ì € ë“¤ì–´ë³´ëŠ” ê±´ ì–´ë–¨ê¹Œìš”?" ([í–‰ë™ ì œì•ˆ])
       - **ê¸¸ì´ ë° í˜•ì‹**: ê¸°ì¡´ì˜ ê¸¸ì´ ì œí•œ(ì§ˆë¬¸ 18ë‹¨ì–´, ì œì•ˆ 12ë‹¨ì–´)ê³¼ í˜•ì‹(í•œ ë¬¸ì¥, 2ì¸ì¹­ ì¡´ëŒ€)ì€ ê³„ì† ìœ ì§€í•©ë‹ˆë‹¤.

       - **ë¶€ì •ì  ì œì•½ ì¡°ê±´ ì¶”ê°€ (ë°˜ë³µ ë°©ì§€)**:
         - **ë§¤ í„´ë§ˆë‹¤ ë°˜ë“œì‹œ ì§ˆë¬¸ìœ¼ë¡œ ëë‚´ì•¼ í•œë‹¤ëŠ” ê°•ë°•ì—ì„œ ë²—ì–´ë‚˜ì„¸ìš”.**
         - ì§ì „ í„´ì—ì„œ ì‚¬ìš©í–ˆë˜ ëŒ€í™” ìœ í˜•(ì˜ˆ: ì§ˆë¬¸)ì€ ê°€ê¸‰ì  í”¼í•˜ê³ , ë‹¤ë¥¸ ìœ í˜•ì˜ ì„ íƒì§€ë¥¼ ì œì‹œí•˜ì—¬ ëŒ€í™”ì˜ ë¦¬ë“¬ì„ ë§Œë“œì„¸ìš”.
         - ì‚¬ìš©ìê°€ ì§ì ‘ ì…ë ¥í•œ ë¬¸ì¥ê³¼ ê±°ì˜ ë™ì¼í•œ ë‚´ìš©ì˜ ì„ íƒì§€ë¥¼ ìƒì„±í•˜ì§€ ë§ˆì„¸ìš”.

         
        ## ì¶œë ¥ í˜•ì‹ (ê¸°ì¡´ê³¼ ë™ì¼í•˜ê²Œ ìœ ì§€)
        <êµ¬ì„±ì› í…ìŠ¤íŠ¸>
        ||COACH||(ì‹¤ìš©ì  ë¶„ì„ 2~3ë¬¸ì¥. ë¼ë²¨, ì§ˆë¬¸, ë§ˆí¬ë‹¤ìš´ ê¸ˆì§€)
        ||CHOICE1||<ìœ„ 4ê°€ì§€ ìœ í˜• ì¤‘ í•˜ë‚˜ë¥¼ í™œìš©í•œ, ë¦¬ë”ê°€ ë°”ë¡œ ë§í•  ìˆ˜ ìˆëŠ” í•œ ë¬¸ì¥>
        ||CHOICE2||<CHOICE1ê³¼ëŠ” ë‹¤ë¥¸ ìœ í˜•ì„ í™œìš©í•œ, ë¦¬ë”ê°€ ë°”ë¡œ ë§í•  ìˆ˜ ìˆëŠ” ë˜ ë‹¤ë¥¸ í•œ ë¬¸ì¥>
`;


if (currentMode === 'advanced' && customPersonaData){
        const { name, role, rank, years, job, performance, personality, extra } = customPersonaData;
        const personaDescription = `ì§êµ°/ì§ë¬´: ${role}/${job}, ì§ê¸‰/ì—°ì°¨: ${rank}/${years}ë…„ì°¨, ì„±ê³¼ ìˆ˜ì¤€: ${performance}, ë©´ë‹´ íƒœë„: ${customPersonaData.name.split(' ')[0]}, ì„±ê²©: ${personality}, ì—…ë¬´ íŠ¹ì„± ë° íŠ¹ì´ì‚¬í•­: ${extra}`;

        return `${commonBackground}
          ## ì—­í•  1: ë§ì¶¤í˜• êµ¬ì„±ì› (${name})
          - **[êµ¬ì„±ì› ìƒì„¸ í”„ë¡œí•„]**: ${personaDescription}
          - **[í•µì‹¬ í–‰ë™ ì§€ì¹¨]**: ë‹¹ì‹ ì€ ìœ„ í”„ë¡œí•„ì— ë”°ë¼ ì¼ê´€ë˜ê²Œ í–‰ë™í•´ì•¼ í•©ë‹ˆë‹¤.
            - **ìµœìš°ì„  ë°˜ì˜**: í”„ë¡œí•„ì— ëª…ì‹œëœ 'ë©´ë‹´ íƒœë„'ë¥¼ ëª¨ë“  ë‹µë³€ì˜ ê¸°ë³¸ í†¤ì•¤ë§¤ë„ˆë¡œ ì‚¼ìœ¼ì„¸ìš”. (ì˜ˆ: ë°©ì–´ì  íƒœë„ë¼ë©´, ë°˜ì¥ë‹˜ì˜ ì§ˆë¬¸ì— ì¦‰ì‹œ ë™ì˜í•˜ê¸°ë³´ë‹¤ ì´ìœ ë¥¼ ë¬»ê±°ë‚˜ ì–´ë ¤ìš´ ì ì„ ë¨¼ì € ì´ì•¼ê¸°í•©ë‹ˆë‹¤.)
            - **ëŒ€í™” ì¤‘ ë°˜ì˜**: ë‹¹ì‹ ì˜ 'ì„±ê²©'ê³¼ 'ì—…ë¬´ íŠ¹ì„±'(ì¥/ë‹¨ì )ì´ ëŒ€í™” ì¤‘ì— ìì—°ìŠ¤ëŸ½ê²Œ ë“œëŸ¬ë‚˜ë„ë¡ í•˜ì„¸ìš”. (ì˜ˆ: 'í˜‘ì—…ì„ ì¤‘ì‹œí•˜ì§€ ì•ŠìŒ'ì´ ë‹¨ì ì´ë¼ë©´, "ê·¸ê±´ ì œê°€ í˜¼ì ì²˜ë¦¬í•˜ëŠ” ê²Œ ë” ë¹ ë¥¼ ê²ƒ ê°™ìŠµë‹ˆë‹¤." ì™€ ê°™ì€ ë°œì–¸ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.)
            - **íŠ¹ì´ì‚¬í•­ í™œìš©**: 'íŠ¹ì´ì‚¬í•­'ì´ ìˆë‹¤ë©´ ëŒ€í™”ì˜ ì ì ˆí•œ ì‹œì ì— ì–¸ê¸‰í•˜ì„¸ìš”.
${coachPersona}`;
      }

      return `${commonBackground}
          ## ì—­í•  1: êµ¬ì„±ì› (${persona.name})
          - **ìƒí™©**: ${situationFromSeeds}
          - **ëŒ€í™” ëª©í‘œ**: ${stageGoal}
          - **ì‘ë‹µ ìŠ¤íƒ€ì¼**: ${persona.style}
          - **ì‘ë‹µ í†¤**: ${persona.tone}
${coachPersona}`;

    }

    // ===== Report Markdown Cleaner (ë¶ˆí•„ìš”í•œ Markdown/ë©”íƒ€íƒœê·¸ ì œê±°) =====
function cleanReportMarkdown(text) {
  if (!text) return '';

  let s = String(text);

  // 0) ì‹œìŠ¤í…œ íŒŒì‹±ìš© ë©”íƒ€íƒœê·¸(EVALUATION/CAT)ëŠ” í™”ë©´ ë³¸ë¬¸ì—ì„œ ì œê±°
  s = s.replace(/^\s*\[EVALUATION:[^\]]*]\s*$/gim, '');
  s = s.replace(/^\s*\[CAT:[^\]]*]\s*$/gim, '');

  // 1) ì½”ë“œ/ì¸ë¼ì¸ ë§ˆí¬ë‹¤ìš´ ì œê±°
  s = s
    .replace(/```[\s\S]*?```/g, '')     // fenced code block
    .replace(/`{1,3}[^`]*`{1,3}/g, '')  // inline code
    .replace(/\*\*(.*?)\*\*/g, '$1')    // **bold**
    .replace(/__(.*?)__/g, '$1')        // __bold__
    .replace(/_(.*?)_/g, '$1');         // _italic_

  // 2) í—¤ë”/ë¶ˆë¦¿/ì²´í¬ë°•ìŠ¤ ë“± ë§ˆí¬ë‹¤ìš´ ê¸°í˜¸ ì •ë¦¬
  s = s
    .replace(/^\s*#{1,6}\s*/gm, '')           // #, ##, ### ...
    .replace(/^\s*>\s?/gm, '')                // blockquote '>'
    .replace(/^\s*[-*+]\s+/gm, 'â€¢ ')          // unordered bullets â†’ â€¢
    .replace(/^\s*\d+\.\s+/gm, (m) => m.replace(/\.\s+/, ') ')) // 1. â†’ 1)
    .replace(/^\s*\[(x|X)\]\s+/gm, 'â–  ')      // [x] ì²´í¬ â†’ â– 
    .replace(/^\s*\[\s\]\s+/gm, 'â–¡ ');        // [ ] ì²´í¬ â†’ â–¡

  // 3) ë¶ˆí•„ìš”í•œ íŒŒì´í”„ í† í°/ì”ì—¬ êµ¬ë¶„ì ì œê±°
  s = s.replace(/\|\|(?!COACH\|\|)(?!CHOICE1\|\|)(?!CHOICE2\|\|)[^|]{1,40}\|\|/g, '');

  // 4) ê³¼ë„í•œ ê³µë°±/ë¹ˆ ì¤„ ì •ë¦¬
  s = s
    .replace(/[ \t]+\n/g, '\n')   // í–‰ë§ ê³µë°± ì œê±°
    .replace(/\n{3,}/g, '\n\n')   // 3ì¤„ ì´ìƒ ê³µë°± â†’ 1ì¤„
    .trim();

  // 5) ì œëª©/ì„¹ì…˜ ê°€ë…ì„±(ê°„ë‹¨ ê°•ì¡°: ì²« ì¤„ ì œëª©ì´ë©´ â–  ë¶™ì„)
  s = s.replace(/^(?:ì‹ í˜¸ë“± ì§„ë‹¨|í•©ì˜ëœ ë‹¤ìŒ í–‰ë™|í•„ìš”í•œ ì§€ì›\/ì˜ì¡´|í•µì‹¬ ì¸ìš©|ê²°ë¡  ìš”ì•½)\s*$/gmi, m => `â–  ${m}`);

  return s;
}





    // ===== CHAT UI HELPERS =====
    function appendMessage(role, text) {
      text = simplifyJargon(cleanText(text));
      const row = document.createElement('div');
      row.className = `row ${role}`;
      
      if (role === 'model') {
        const avatarDiv = document.createElement('div'); avatarDiv.className = 'avatar';
        const avatarImg = document.createElement('img'); avatarImg.src = getAvatarSrc(); avatarImg.alt = 'avatar';
        avatarDiv.appendChild(avatarImg);

        if (typeof currentScenario !== 'undefined' && currentScenario === 'objection' && role === 'bot') {
  OBJECTION_TURNS++;
}

const bubble = document.createElement('div'); bubble.className = 'bubble bot'; setBubbleText(bubble, text);
        row.appendChild(avatarDiv); row.appendChild(bubble);
        elMessages.appendChild(row);
        const name = document.createElement('div'); name.className = 'name';
        if (currentMode === 'advanced' && customPersonaData && customPersonaData.name) { name.textContent = customPersonaData.name; }
        else { name.textContent = personas[currentPersona].name; }
        elMessages.appendChild(name);
      } else {
const bubble = document.createElement('div'); bubble.className = 'bubble user'; setBubbleText(bubble, text);
        row.appendChild(bubble); elMessages.appendChild(row);
      }
      elMessages.scrollTop = elMessages.scrollHeight;
      
      
    }

    // ì´ì˜ì œê¸°ì—ì„œ 'ë„ˆë¬´ ë¹¨ë¦¬ ëë‚´ê¸°' ë°©ì§€ìš©
let OBJECTION_TURNS = 0;  // ì½”ì¹˜(ë´‡) ë°œí™” ê¸°ì¤€ ì¹´ìš´íŠ¸
const MIN_OBJECTION_TURNS_FOR_WRAP = 4; // ê³µê°â†’ìŸì â†’ì‚¬ë¡€ í™•ì¸ 2íšŒ(ë´‡ 4í„´ ì •ë„)


    // ì‚¬ìš©ìê°€ "ìë£Œ ë³´ê³  ì–˜ê¸°í•˜ì/ì—†ë‹¤/ë‚˜ì¤‘ì—" ë“±ì„ ë§í•˜ë©´ ìŠ¤í‚µ ì˜ë„ ì²˜ë¦¬
const SKIP_RE = /(ìë£Œ|ê¸°ë¡|ê·¼ë¬´í‘œ|ëª…ì„¸ì„œ|ì§€í‘œ|ìˆ˜ì¹˜).{0,12}(ì—†|ëª»|ë‚˜ì¤‘|ì´í›„|ë³´ë©´ì„œ|ë³´ê³ )|ìŠ¤í‚µ|ê±´ë„ˆë›°|ì§€ê¸ˆì€\s*ì–´ë ¤|íŒ¨ìŠ¤/i;

function preprocessUserText(raw='') {
  const s = String(raw).trim();
  if (SKIP_RE.test(s)) {
    // ëª¨ë¸ì—ê²Œ ë‚´ë¶€ ì§€ì¹¨ìœ¼ë¡œ ì „ë‹¬(ì‚¬ìš©ì ë©”ì‹œì§€ëŠ” ê·¸ëŒ€ë¡œ ë³´ì—¬ë„ ë¨)
    return s + "\n[ëŒ€í™”ë°©í–¥] ì§€ê¸ˆì€ ìë£Œ/ê¸°ë¡ ì—†ì´ ì§„í–‰. ê¸°ì–µÂ·ê´€ì°° ê¸°ë°˜ ëŒ€í‘œ ìƒí™© 1ê°œë§Œ ìš”ì²­í•˜ê³ , " +
                "ì„ íƒì§€ë¡œ (A) ìë£Œ í™•ì¸ í›„ ì¬ë©´ë‹´(ë‹´ë‹¹Â·ê¸°í•œ) (B) ì§€ê¸ˆ ë“¤ì€ ë‚´ìš© ê¸°ì¤€ ì„ì‹œ ê²°ë¡  ìš”ì•½ í›„ ê³„ì¥/HR ì œì•ˆ ì„ ì œê³µ.";
  }
  return s;
}

    
    function appendTypingIndicator() {
      if (document.getElementById('typingRow')) return;
      const row = document.createElement('div'); row.id = 'typingRow'; row.className = 'row bot';
      const avatarDiv = document.createElement('div'); avatarDiv.className = 'avatar';
      const avatarImg = document.createElement('img'); avatarImg.src = getAvatarSrc(); avatarImg.alt = 'typing';
      avatarDiv.appendChild(avatarImg);
      const typing = document.createElement('div'); typing.className = 'typing'; typing.innerHTML = '<span class="dots"><span></span><span></span><span></span></span>';
      row.appendChild(avatarDiv); row.appendChild(typing); elMessages.appendChild(row);
      elMessages.scrollTop = elMessages.scrollHeight;
    }
    function hideTyping() { const t = document.getElementById('typingRow'); if (t) t.remove(); }

    // ===== COACH MODAL =====
    let coachTipModal;
    function showCoachModal() {
      if (!coachTipModal) coachTipModal = document.getElementById('coachTipModal');
      coachTipModal.style.display = 'flex';
    }
    function hideCoachModal() {
      if (!coachTipModal) coachTipModal = document.getElementById('coachTipModal');
      coachTipModal.style.display = 'none';
    }
    function displayCoachingTip(rawTip) {
    // CHOICE êµ¬ë¶„ìë¥¼ ê³µë°±/ëŒ€ì†Œë¬¸ì í—ˆìš©í•˜ì—¬ ë¶„ë¦¬
    const parts = rawTip.split(/\|\|\s*CHOICE1\s*\|\||\|\|\s*CHOICE2\s*\|\|/i);
     let analysis = simplifyJargon(cleanText(parts[0] || ''));
   // ì”ì—¬ í† í°/ë¼ë²¨/ì§ˆë¬¸ ì œê±° ë° 2ë¬¸ì¥ ì œí•œ
  analysis = analysis
    .replace(/^\s*CHOICE\s*[12]\s*[:ï¼š].*$/gim, '')
    .replace(/\|\|\s*CHOICE\s*[12]\s*\|\|/gi, '')
    .replace(/\b(ë³´ìƒ|ê¸‰ì—¬|ìˆ˜ë‹¹|ì•¼ê°„ìˆ˜ë‹¹)\b/gi, '')
    .replace(/\|\|(?!CHOICE1\|\||CHOICE2\|\|)[^|]{1,24}\|\|/g, '')
    .replace(/^\s*(ë¶„ì„|ì œì•ˆ|ì§ˆë¬¸|ì¡°ì–¸)\s*[:ï¼š]\s*/gim, '')
    .split(/(?<=[.ã€‚!ï¼?ï¼Ÿ])\s+/).filter(s => s && !/[?ï¼Ÿ]/.test(s)).slice(0, 2).join(' ');

  const choice1 = normalizeChoice(cleanText(parts[1] || 'ì§ˆë¬¸ì„ í•˜ë‚˜ë§Œ ë” ì—¬ì­¤ë³¼ê¹Œìš”?'));
  const choice2 = normalizeChoice(cleanText(parts[2] || 'ì˜¤ëŠ˜ ê°€ëŠ¥í•œ í•œ ê°€ì§€ë¶€í„° ì‹œì‘í•´ë³´ì‹œì£ .'));

  const analysisEl = document.getElementById('coachAnalysisContent');
  const choicesEl = document.getElementById('coachChoicesContainer');
  analysisEl.textContent = analysis;
  choicesEl.innerHTML = '';

  const mk = (t) => { const b = document.createElement('button'); b.className='coach-choice-button'; b.textContent=t; b.onclick=()=>{ sendChoice(t); hideCoachModal(); }; return b; };
  choicesEl.appendChild(mk(choice1));
  choicesEl.appendChild(mk(choice2));

  const free = document.createElement('button');
  free.className='coach-choice-button'; free.textContent='ğŸ’¬ ì§ì ‘ ì…ë ¥í•˜ê¸°';
  free.style.backgroundColor='#f0f3f5'; free.style.color='#333'; free.style.borderColor='#ccc';
  free.onclick=()=>{ hideCoachModal(); };
  choicesEl.appendChild(free);

  showCoachModal();
}

    function showCoachAnalysisFromButton() {
  let lastBot = null;
  for (let i = history.length - 1; i >= 0; i--) {
    const h = history[i];
    if (h.role === 'model' && h.parts?.[0]?.text && h.parts[0].text.includes('||COACH||')) {
      lastBot = h;
      break;
    }
  }
  if (!lastBot) { alert('ì•„ì§ ë¶„ì„í•  êµ¬ì„±ì›ì˜ ëŒ€í™”ê°€ ì—†ìŠµë‹ˆë‹¤.'); return; }
  const coachingTipRaw = lastBot.parts[0].text.split('||COACH||')[1] || '';
  displayCoachingTip(coachingTipRaw);
}
    function sendChoice(choiceText) {
      appendMessage('user', choiceText);
      history.push({ role: 'user', parts: [{ text: choiceText }] });
      const choices = document.querySelectorAll('.coach-choice-button');
      choices.forEach(c => { c.onclick = null; c.classList.add('disabled'); });
      getAIResponse(); // AI ì‘ë‹µì„ ì§ì ‘ ìš”ì²­
    }

    function startChat(stage, scenario, persona) {
      currentStage = stage; 
      currentScenario = scenario; 
      currentPersona = persona;
      elMessages.innerHTML = ''; 
      elText.disabled = false;
      document.getElementById('sendButton').disabled = false;
      document.getElementById('endChatButton').disabled = false;
      document.getElementById('coachActionBar').classList.add('hidden');
      showScreen('chat');
      const systemPrompt = buildCombinedPrompt();
      history = [{ role: 'user', parts: [{ text: systemPrompt }] }];
      sendMessage(true); // isInitial í”Œë˜ê·¸ë¡œ ì²« ëŒ€í™” ì‹œì‘
    }

        // ===== [NEW] GUIDANCE MODAL =====
    let guidanceModal;
    function showGuidanceModal() {
      if (!guidanceModal) guidanceModal = document.getElementById('guidanceModal');
      guidanceModal.style.display = 'flex';
    }
    function hideGuidanceModal() {
      if (!guidanceModal) guidanceModal = document.getElementById('guidanceModal');
      guidanceModal.style.display = 'none';
    }

    const guidanceContent = {
        goal: {
            title: "ğŸ“‹ ëª©í‘œì„¤ì • ë©´ë‹´ ê°€ì´ë“œ",
            definition: "êµ¬ì„±ì›ê³¼ í•¨ê»˜ í•œ í•´ì˜ ì—…ë¬´ ëª©í‘œë¥¼ ì„¤ì •í•˜ê³  í•©ì˜í•˜ëŠ” ì´ˆê¸° ë‹¨ê³„ì…ë‹ˆë‹¤. ëª…í™•í•˜ê³  ë„ì „ì ì¸ ëª©í‘œë¥¼ ì„¤ì •í•˜ì—¬ êµ¬ì„±ì›ì—ê²Œ ë™ê¸°ë¥¼ ë¶€ì—¬í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.",
            considerations: "íšŒì‚¬ì˜ ë°©í–¥ì„±ê³¼ êµ¬ì„±ì›ì˜ ì„±ì¥ ê³„íšì´ ëª¨ë‘ ì—°ê³„ë  ìˆ˜ ìˆë„ë¡ ëª©í‘œë¥¼ ì¡°ìœ¨í•´ì•¼ í•©ë‹ˆë‹¤. ì¼ë°©ì ì¸ ì§€ì‹œê°€ ì•„ë‹Œ, êµ¬ì„±ì›ì˜ ì˜ê²¬ì„ ì¶©ë¶„íˆ ë“£ê³  í•©ì˜í•˜ëŠ” ê³¼ì •ì´ í•„ìˆ˜ì ì…ë‹ˆë‹¤.",
            tips: "â€¢ ëª©í‘œëŠ” SMART(Specific, Measurable, Achievable, Relevant, Time-bound) ì›ì¹™ì— ë”°ë¼ êµ¬ì²´ì ìœ¼ë¡œ ì„¤ì •í•˜ì„¸ìš”.\nâ€¢ êµ¬ì„±ì›ì´ ìŠ¤ìŠ¤ë¡œ ëª©í‘œë¥¼ ì œì•ˆí•˜ë„ë¡ ìœ ë„í•˜ì—¬ ì£¼ì¸ì˜ì‹ì„ ë†’ì—¬ì£¼ì„¸ìš”."
        },
        feedback: {
            title: "ğŸ’¬ ì¤‘ê°„í”¼ë“œë°± ë©´ë‹´ ê°€ì´ë“œ",
            definition: "ì„¤ì •ëœ ëª©í‘œì— ëŒ€í•´ ì¤‘ê°„ ê³¼ì •ì„ ì ê²€í•˜ê³ , ì˜í•˜ê³  ìˆëŠ” ì ê³¼ ê°œì„ ì´ í•„ìš”í•œ ë¶€ë¶„ì— ëŒ€í•´ í”¼ë“œë°±ì„ ì£¼ê³ ë°›ëŠ” ë‹¨ê³„ì…ë‹ˆë‹¤.",
            considerations: "ë¹„íŒì´ ì•„ë‹Œ ì„±ì¥ì„ ìœ„í•œ ì½”ì¹­ ê´€ì ì—ì„œ ì ‘ê·¼í•´ì•¼ í•©ë‹ˆë‹¤. ì˜í•œ ì ì„ ë¨¼ì € ì¸ì •í•˜ê³  ê²©ë ¤í•˜ì—¬ ê¸ì •ì ì¸ ë¶„ìœ„ê¸°ë¥¼ ì¡°ì„±í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.",
            tips: "â€¢ 'S-B-I (Situation-Behavior-Impact)' ëª¨ë¸ì„ í™œìš©í•˜ì—¬ êµ¬ì²´ì ì´ê³  ì‚¬ì‹¤ ê¸°ë°˜ì˜ í”¼ë“œë°±ì„ ì „ë‹¬í•˜ì„¸ìš”.\nâ€¢ í•´ê²°ì±…ì„ ì§ì ‘ ì œì‹œí•˜ê¸°ë³´ë‹¤, 'ì–´ë–»ê²Œ í•˜ë©´ ë” ì¢‹ì„ê¹Œìš”?'ì™€ ê°™ì´ êµ¬ì„±ì› ìŠ¤ìŠ¤ë¡œ ë‹µì„ ì°¾ë„ë¡ ì§ˆë¬¸í•˜ì„¸ìš”."
        },
        before: {
            title: "ğŸ“Š ìµœì¢…í‰ê°€ (í‰ê°€ ì „) ë©´ë‹´ ê°€ì´ë“œ",
            definition: "ê³µì‹ì ì¸ ìµœì¢…í‰ê°€ ê²°ê³¼ê°€ ë‚˜ì˜¤ê¸° ì „, í•œ í•´ì˜ ì„±ê³¼ì— ëŒ€í•´ ë¯¸ë¦¬ ì˜ê²¬ì„ ë‚˜ëˆ„ê³  ê¸°ëŒ€ ìˆ˜ì¤€ì„ ì •ë ¬í•˜ëŠ” ë‹¨ê³„ì…ë‹ˆë‹¤.",
            considerations: "í‰ê°€ìê°€ ë†“ì¹˜ê³  ìˆëŠ” ì„±ê³¼ë‚˜ ì–´ë ¤ì›€ì´ ìˆì—ˆëŠ”ì§€ ìµœì¢…ì ìœ¼ë¡œ í™•ì¸í•˜ëŠ” ê¸°íšŒì…ë‹ˆë‹¤. í‰ê°€ ê²°ê³¼ì— ëŒ€í•œ ì˜ˆì¸¡ë³´ë‹¤ëŠ” ê³¼ì •ì— ëŒ€í•œ ë¦¬ë·°ì— ì§‘ì¤‘í•´ì•¼ í•©ë‹ˆë‹¤.",
            tips: "â€¢ êµ¬ì„±ì›ì´ ìŠ¤ìŠ¤ë¡œì˜ ì„±ê³¼ë¥¼ ë¨¼ì € ì´ì•¼ê¸°í•˜ë„ë¡ í•˜ëŠ” 'ìê¸°í‰ê°€' ê¸°íšŒë¥¼ ë¨¼ì € ë¶€ì—¬í•˜ì„¸ìš”.\nâ€¢ ì˜ˆìƒë˜ëŠ” í‰ê°€ ë“±ê¸‰ì„ ë¯¸ë¦¬ ì•”ì‹œí•˜ì§€ ì•Šë„ë¡ ì£¼ì˜í•˜ì„¸ìš”."
        },
        appeal: {
            title: "ğŸ™‹â€â™‚ï¸ ì´ì˜ì œê¸° ë©´ë‹´ ê°€ì´ë“œ",
            definition: "êµ¬ì„±ì›ì´ í‰ê°€ ê²°ê³¼ì— ë™ì˜í•˜ì§€ ëª»í•˜ê³  ì´ì˜ë¥¼ ì œê¸°í–ˆì„ ë•Œ, ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ì§„í–‰í•˜ëŠ” ë©´ë‹´ì…ë‹ˆë‹¤.",
            considerations: "êµ¬ì„±ì›ì˜ ì˜ê²¬ì„ 'ë°©ì–´'ë‚˜ 'ë³€ëª…'ìœ¼ë¡œ ì¹˜ë¶€í•˜ì§€ ë§ê³ , ê°ê´€ì ì¸ ê·¼ê±°ì™€ ë…¼ë¦¬ë¥¼ ë°”íƒ•ìœ¼ë¡œ ê²½ì²­í•˜ëŠ” ìì„¸ê°€ ë§¤ìš° ì¤‘ìš”í•©ë‹ˆë‹¤. ê°ì •ì ì¸ ëŒ€ì‘ì€ í”¼í•´ì•¼ í•©ë‹ˆë‹¤.",
            tips: "â€¢ ë¨¼ì € êµ¬ì„±ì›ì˜ ì…ì¥ì„ ì¶©ë¶„íˆ ë“¤ì–´ì£¼ë©° ê°ì •ì„ í•´ì†Œí•  ê¸°íšŒë¥¼ ì£¼ì„¸ìš”.\nâ€¢ ë…¼ì˜ì˜ ì´ˆì ì„ 'í‰ê°€ ë“±ê¸‰ ë³€ê²½'ì´ ì•„ë‹Œ 'í‰ê°€ ê·¼ê±°ì— ëŒ€í•œ ìƒí˜¸ ì´í•´'ì— ë§ì¶”ì„¸ìš”."
        }
    };

    const personaGuidance = {
        low: "ì„ íƒí•œ êµ¬ì„±ì›ì€ [ì €ì„±ê³¼ì]ì…ë‹ˆë‹¤. ìì‹ ê°ì´ ë‚®ì„ ìˆ˜ ìˆìœ¼ë‹ˆ, ì§ˆì±…ë³´ë‹¤ëŠ” ê²©ë ¤ì™€ í•¨ê»˜ ì‘ê³  êµ¬ì²´ì ì¸ ì„±ê³µ ê²½í—˜ì„ ë§Œë“¤ ìˆ˜ ìˆëŠ” ëª©í‘œë¥¼ ì œì•ˆí•˜ëŠ” ê²ƒì´ íš¨ê³¼ì ì…ë‹ˆë‹¤.",
        mid: "ì„ íƒí•œ êµ¬ì„±ì›ì€ [ì¤‘ê°„ì„±ê³¼ì]ì…ë‹ˆë‹¤. ê°•ì ê³¼ ì•½ì ì— ëŒ€í•´ ê· í˜• ì¡íŒ ì‹œê°ì„ ê°€ì§€ê³  ìˆìœ¼ë¯€ë¡œ, ìŠ¤ìŠ¤ë¡œ ê°œì„ ì ì„ ì°¾ê³  ê³„íšì„ ì„¸ìš°ë„ë¡ ì½”ì¹­ ì§ˆë¬¸ì„ í™œìš©í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.",
        high: "ì„ íƒí•œ êµ¬ì„±ì›ì€ [ê³ ì„±ê³¼ì]ì…ë‹ˆë‹¤. ì´ë¯¸ ë†’ì€ ìˆ˜ì¤€ì˜ ì„±ê³¼ë¥¼ ë‚´ê³  ìˆìœ¼ë¯€ë¡œ, ë” ë„ì „ì ì¸ ëª©í‘œë‚˜ ìƒˆë¡œìš´ ì—­í• (ë¦¬ë”ì‹­, ë©˜í† ë§ ë“±)ì„ ì œì•ˆí•˜ì—¬ ì„±ì¥ ë™ê¸°ë¥¼ ìê·¹í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.",
        custom: "ì§ì ‘ ì„¤ì •í•œ [ë§ì¶¤ ì„±ê²©]ì˜ íŠ¹ì„±ì„ ê³ ë ¤í•˜ì—¬, í•´ë‹¹ êµ¬ì„±ì›ì˜ ê°•ì ì„ ìµœëŒ€í•œ í™œìš©í•˜ê³  ì•½ì ì„ ë³´ì™„í•  ìˆ˜ ìˆëŠ” ë°©í–¥ìœ¼ë¡œ ë©´ë‹´ì„ ì´ëŒì–´ ë³´ì„¸ìš”."
    };

    function showGuidancePopup(contentKey, stage, subScenario = '') {
      const content = guidanceContent[contentKey];
      const personaContent = personaGuidance[currentPersona] || "ì„ íƒí•œ êµ¬ì„±ì›ì˜ íŠ¹ì„±ì„ ê³ ë ¤í•˜ì—¬ ë©´ë‹´ì„ ì§„í–‰í•˜ì„¸ìš”.";

      // íŒì—… ë‚´ìš© ì±„ìš°ê¸°
      document.getElementById('guidanceTitle').innerText = content.title;
      document.getElementById('guidanceDefinition').innerText = content.definition;
      document.getElementById('guidanceConsiderations').innerText = content.considerations;
      document.getElementById('guidanceTips').innerText = content.tips;
      document.getElementById('guidancePersona').innerText = personaContent;

      // ë‹«ê¸° ë° ì‹œì‘ ë²„íŠ¼ì— ì±„íŒ… ì‹œì‘ ê¸°ëŠ¥ ì—°ê²°
      const startButton = document.getElementById('guidanceStartButton');
      const closeButton = document.getElementById('guidanceCloseButton');
      
      const startAction = () => {
          hideGuidanceModal();
          startChat(stage, subScenario, currentPersona);
      };
      
      startButton.onclick = startAction;
      closeButton.onclick = startAction;

      showGuidanceModal();
    }


    // ===== GEMINI API & CHAT LOGIC =====
    const GEMINI_API_KEY = 'AIzaSyAyuLp39374D5PnCk0gYYqAPCgZUFemny0'; // ì—¬ê¸°ì— ì‹¤ì œ API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”.
    const GEMINI_API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${GEMINI_API_KEY}`;

        // [ìƒˆë¡œìš´ í•¨ìˆ˜] AI ë‹µë³€ ìš”ì²­ì„ ì „ë‹´í•˜ëŠ” í•¨ìˆ˜
    async function getAIResponse() {
      const sendButton = document.getElementById('sendButton');
      const coachActionBar = document.getElementById('coachActionBar');
      
      elText.disabled = true;
      sendButton.disabled = true;
      document.getElementById('endChatButton').disabled = true;
      if(coachActionBar) coachActionBar.classList.add('hidden');
      
      appendTypingIndicator(); // íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„° í‘œì‹œ

      try {
        const res = await fetch(GEMINI_API_URL, {
          method: 'POST', headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            contents: history,
            generationConfig: { temperature: 0.8, maxOutputTokens: 1024 }
          })
        });
        if (!res.ok) { // API ì‘ë‹µì´ ì„±ê³µ(200 OK)ì´ ì•„ë‹ ê²½ìš°
          const errorData = await res.json();
          throw new Error(errorData.error?.message || ('API ìš”ì²­ ì‹¤íŒ¨: ' + res.status));
        }
        const data = await res.json();

        hideTyping(); // íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„° ìˆ¨ê¸°ê¸°

        if (data.candidates?.[0] && data.candidates[0].content.parts?.[0]?.text) {
          const rawResponse = data.candidates[0].content.parts[0].text;
const [memberResponse] = rawResponse.split('||COACH||');
appendMessage('model', cleanText(memberResponse));
history.push({ role: 'model', parts: [{ text: rawResponse }] });

if (coachActionBar) {
  const hasCoach = rawResponse.includes('||COACH||');
  coachActionBar.classList.toggle('hidden', !hasCoach);
  document.getElementById('showCoachTipButton').onclick = showCoachAnalysisFromButton;
}

        } else { // ì‘ë‹µ ë‚´ìš©ì´ ì—†ê±°ë‚˜ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•Šì„ ê²½ìš°
          // [ìˆ˜ì •ëœ ë¶€ë¶„]: ì˜¤ë¥˜ ì•„ë°”íƒ€ì™€ ê²½ê³  ë©”ì‹œì§€ í‘œì‹œ
          appendErrorMessage('ì£„ì†¡í•©ë‹ˆë‹¤. ë‹µë³€ì„ ìƒì„±í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì‹œê² ì–´ìš”?');
        }
      } catch (e) { // API í˜¸ì¶œ ìì²´ì—ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì„ ê²½ìš° (ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ë“±)
        hideTyping(); // íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„° ìˆ¨ê¸°ê¸°
        console.error('API Error:', e);
        // [ìˆ˜ì •ëœ ë¶€ë¶„]: ì˜¤ë¥˜ ì•„ë°”íƒ€ì™€ ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
        appendErrorMessage('API í˜¸ì¶œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + e.message + ' ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
      } finally {
        elText.disabled = false;
        sendButton.disabled = false;
        document.getElementById('endChatButton').disabled = false;
        elText.focus();
      }
    }

    // [ìƒˆë¡œ ì¶”ê°€ëœ í•¨ìˆ˜]: ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ íŠ¹ì • ì•„ë°”íƒ€ë¡œ í‘œì‹œ
    function appendErrorMessage(message) {
      const row = document.createElement('div');
      row.className = `row bot error`; // 'error' í´ë˜ìŠ¤ë¥¼ ì¶”ê°€í•˜ì—¬ ìŠ¤íƒ€ì¼ì„ ë‹¤ë¥´ê²Œ í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.
      const avatarDiv = document.createElement('div'); avatarDiv.className = 'avatar';
      const avatarImg = document.createElement('img'); avatarImg.src = 'avatar_error.png'; avatarImg.alt = 'error_avatar';
      avatarDiv.appendChild(avatarImg);
      const bubble = document.createElement('div'); bubble.className = 'bubble bot'; // ê¸°ë³¸ ë´‡ ë²„ë¸” ìŠ¤íƒ€ì¼ ì‚¬ìš©
      bubble.style.backgroundColor = '#fce4ec'; // ë°°ê²½ìƒ‰ì„ ë¶‰ì€ ê³„ì—´ë¡œ ë³€ê²½í•˜ì—¬ ê²½ê³  ê°•ì¡°
      bubble.style.borderColor = '#ef9a9a';
      bubble.style.color = '#c62828'; // í…ìŠ¤íŠ¸ ìƒ‰ìƒ ë³€ê²½
      bubble.textContent = message;
      row.appendChild(avatarDiv); row.appendChild(bubble);
      elMessages.appendChild(row);
      
      const name = document.createElement('div'); name.className = 'name';
      name.textContent = 'ì‹œìŠ¤í…œ ì•Œë¦¼'; // ì˜¤ë¥˜ ë©”ì‹œì§€ì¼ ë•ŒëŠ” 'ì‹œìŠ¤í…œ ì•Œë¦¼'ìœ¼ë¡œ í‘œì‹œ
      elMessages.appendChild(name);

      elMessages.scrollTop = elMessages.scrollHeight;
    }



    // ê¸°ì¡´ì˜ sendMessage í•¨ìˆ˜ë¥¼ ì§€ìš°ê³  ì•„ë˜ ì½”ë“œë¡œ êµì²´í•´ì£¼ì„¸ìš”.
    async function sendMessage(isInitial = false) {
  if (isInitial) {
    // ëŒ€í™” ì‹œì‘ ì‹œ ì²« ë©”ì‹œì§€ë¥¼ ìš”ì²­
    history.push({ role: 'user', parts: [{ text: "ì´ì œ ë©´ë‹´ì„ ì‹œì‘í•˜ê² ìŠµë‹ˆë‹¤. êµ¬ì„±ì›ìœ¼ë¡œì„œ ì €ì—ê²Œ ì²«ë§ˆë””ë¥¼ í•´ì£¼ì„¸ìš”." }] });
  } else {
    // ì‚¬ìš©ìê°€ ì…ë ¥í•œ ë©”ì‹œì§€ ì²˜ë¦¬
    let userText = elText.value.trim(); // 'input'ì„ 'elText'ë¡œ ìˆ˜ì •í•œ ìµœì¢… ë²„ì „ì…ë‹ˆë‹¤.
    userText = preprocessUserText(userText);
    if (!userText) return; // ì…ë ¥ì´ ì—†ìœ¼ë©´ ì¢…ë£Œ
    appendMessage('user', userText);
    history.push({ role: 'user', parts: [{ text: userText }] });
    elText.value = '';
  }
  
  await getAIResponse(); // AI ì‘ë‹µ ìš”ì²­
}

    
    function startChat(stage, scenario, persona) {
      currentStage = stage; 
      currentScenario = scenario; 
      currentPersona = persona;
      elMessages.innerHTML = ''; 
      elText.disabled = false;
      document.getElementById('sendButton').disabled = false;
      document.getElementById('endChatButton').disabled = false;
      document.getElementById('coachActionBar').classList.add('hidden');
      showScreen('chat');
      const systemPrompt = buildCombinedPrompt();
      history = [{ role: 'user', parts: [{ text: systemPrompt + "\\n\\nì´ì œ ë©´ë‹´ì„ ì‹œì‘í•˜ê² ìŠµë‹ˆë‹¤. êµ¬ì„±ì›ìœ¼ë¡œì„œ ì €ì—ê²Œ ì²«ë§ˆë””ë¥¼ í•´ì£¼ì„¸ìš”." }] }];
      sendMessage(true);
    }
    
    // ===== SUMMARY MODAL & END CHAT =====
    let summaryModal, modalSummaryContent;
    function renderCategoryBoard(cats){
      const board = document.getElementById('categoryBoard');
      if (!board) return;
      board.innerHTML = '';
      cats.forEach(c => {
        const item = document.createElement('div'); item.className = 'cat';
        const tl = document.createElement('div'); tl.className = 'traffic-light ' + c.light;
        const label = document.createElement('div'); label.className = 'label'; label.textContent = c.name;
        const score = document.createElement('div'); score.className = 'score'; score.textContent = c.score + 'ì ';
        item.appendChild(tl); item.appendChild(label); item.appendChild(score);
        board.appendChild(item);
      });
    }
    function showModal() {
      if (!summaryModal) summaryModal = document.getElementById('summaryModal');
      if (!modalSummaryContent) modalSummaryContent = document.getElementById('modalSummaryContent');
        summaryModal.style.display = 'flex';
       }
    function hideModal() { 
        if (!summaryModal) summaryModal = document.getElementById('summaryModal');  
        summaryModal.style.display = 'none'; 
    }
    function downloadSummary() {
      const text = modalSummaryContent.innerText;
      const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob); a.download = 'ë©´ë‹´ê²°ê³¼_ìš”ì•½.txt'; a.click(); URL.revokeObjectURL(a.href);
    }
    function emailSummary() {
      const text = modalSummaryContent.innerText;
      const subject = encodeURIComponent('ì„±ê³¼ê´€ë¦¬ ë©´ë‹´ ê²°ê³¼ ìš”ì•½');
      const body = encodeURIComponent('ì•ˆë…•í•˜ì„¸ìš”.\\n\\në©´ë‹´ ê²°ê³¼ ìš”ì•½ì„ ê³µìœ ë“œë¦½ë‹ˆë‹¤.\\n\\n---\\n\\n' + text);
      window.location.href = `mailto:?subject=${subject}&body=${body}`;
    }


    async function endChat() {



    // 1. í•„ìš”í•œ ëª¨ë“  UI ìš”ì†Œë¥¼ ë³€ìˆ˜ë¡œ ì§€ì •í•©ë‹ˆë‹¤.
    const loadingIndicator = document.getElementById('reportLoadingIndicator');
    const reportContainer = document.getElementById('reportContainer');
    const signalArea = document.querySelector('.evaluation-signal');
    const categoryBoard = document.getElementById('categoryBoard');
    const actionButtons = document.querySelector('.modal-actions');

    // 2. ë¦¬í¬íŠ¸ ì˜ì—­ì„ ì œì™¸í•œ ëª¨ë“  UIë¥¼ ìˆ¨ê¸°ê³  ë¡œë”© ë©”ì‹œì§€ë§Œ í‘œì‹œí•©ë‹ˆë‹¤.
    if(signalArea) signalArea.style.display = 'none';
    if(categoryBoard) categoryBoard.style.display = 'none';
    if(actionButtons) actionButtons.style.display = 'none';
    if(reportContainer) reportContainer.style.display = 'none';
    
    loadingIndicator.style.display = 'block';
    loadingIndicator.innerHTML = '<b>â³ AI ì„±ê³¼ê´€ë¦¬ ì „ë¬¸ê°€ê°€ ë©´ë‹´ ë‚´ìš©ì„ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...</b>';
    
    showModal();
    
    const transcript = history.slice(1).map(turn => {
    return `${turn.role === 'user' ? 'ë¦¬ë”' : 'êµ¬ì„±ì›'}: ${turn.parts[0].text.split('||COACH||')[0].trim()}`;
    }).join('\n');

    const learnMoreDescriptions = {
  goal: `
    <b>ëª©í‘œì„¤ì • ë©´ë‹´</b>ì—ì„œëŠ” GROW ëª¨ë¸ì˜ ì¶œë°œì ì¸ <b>Goal</b> ë‹¨ê³„ê°€ í•µì‹¬ì…ë‹ˆë‹¤. 
    êµ¬ì„±ì›ì´ ìŠ¤ìŠ¤ë¡œ ë‹¬ì„±í•˜ê³ ì í•˜ëŠ” ëª©í‘œë¥¼ ëª…í™•í•˜ê²Œ ì •ì˜í•˜ë„ë¡ ë•ê³ , 
    ëª©í‘œê°€ <u>êµ¬ì²´ì ì´ê³ (Specific), ì¸¡ì • ê°€ëŠ¥í•˜ë©°(Measurable), í˜„ì‹¤ì ì´ê³ (Realistic), ê¸°í•œì´ ìˆëŠ”(Time-bound)</u>ì§€ ì ê²€í•´ì•¼ í•©ë‹ˆë‹¤. 
    ë˜í•œ <b>Reality</b> ë‹¨ê³„ì—ì„œëŠ” í˜„ì¬ ìƒí™©ì„ ê°ê´€ì ìœ¼ë¡œ ì§„ë‹¨í•˜ì—¬ ëª©í‘œ ë‹¬ì„±ì— í•„ìš”í•œ ì—­ëŸ‰ê³¼ ìì›ì„ í™•ì¸í•˜ê³ , 
    ê³¼ê±° ì„±ê³¼ë‚˜ ì¥ì• ìš”ì¸ë„ í•¨ê»˜ ê²€í† í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.
  `,
  feedback: `
    <b>ì¤‘ê°„í”¼ë“œë°± ë©´ë‹´</b>ì—ì„œëŠ” <b>Reality</b> ë‹¨ê³„ì—ì„œ í˜„ì¬ ì§„í–‰ ìƒí™©ê³¼ ì„±ê³¼ë¥¼ êµ¬ì²´ì ìœ¼ë¡œ ì ê²€í•´ì•¼ í•©ë‹ˆë‹¤. 
    ë‹¨ìˆœíˆ ê²°ê³¼ë§Œ í™•ì¸í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, êµ¬ì„±ì›ì´ ì²´ê°í•˜ëŠ” ì–´ë ¤ì›€ê³¼ ì¥ì• ìš”ì¸ì„ ê¹Šì´ ìˆê²Œ ë“£ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤. 
    ì´ì–´ì„œ <b>Options</b> ë‹¨ê³„ì—ì„œëŠ” ë¦¬ë”ì™€ êµ¬ì„±ì›ì´ í•¨ê»˜ ë‹¤ì–‘í•œ í•´ê²° ë°©ì•ˆì„ íƒìƒ‰í•˜ê³ , 
    ë‹¨ê¸°Â·ì¤‘ê¸°ì  ëŒ€ì•ˆë“¤ì„ ë‚˜ì—´í•œ ë’¤ ìš°ì„ ìˆœìœ„ë¥¼ ì •í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ë°©í–¥ì„±ì„ ì¡ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
    ì´ ê³¼ì •ì—ì„œ ë¦¬ë”ëŠ” ì§€ì‹œë³´ë‹¤ëŠ” <u>ì§ˆë¬¸ê³¼ ì½”ì¹­</u>ì„ í†µí•´ ìŠ¤ìŠ¤ë¡œ ì„ íƒì§€ë¥¼ ì°¾ë„ë¡ ì§€ì›í•˜ëŠ” ê²ƒì´ í•µì‹¬ì…ë‹ˆë‹¤.
  `,
  evaluation: `
    <b>ìµœì¢…í‰ê°€ ë©´ë‹´</b>ì—ì„œëŠ” ì§€ë‚œ í•œ í•´ì˜ ì„±ê³¼(<b>Reality</b>)ë¥¼ ëŒì•„ë³´ê³ , 
    ë‹¨ìˆœí•œ ê²°ê³¼ ë¹„êµê°€ ì•„ë‹ˆë¼ ëª©í‘œ ë‹¬ì„± ê³¼ì •ì—ì„œ ë‚˜íƒ€ë‚œ <u>ë…¸ë ¥, ì„±ì·¨, ì„±ì¥</u>ì„ ê· í˜• ìˆê²Œ í‰ê°€í•´ì•¼ í•©ë‹ˆë‹¤. 
    ê·¸ë‹¤ìŒ <b>Will</b> ë‹¨ê³„ë¡œ ì´ì–´ì ¸, í‰ê°€ ê²°ê³¼ë¥¼ í† ëŒ€ë¡œ êµ¬ì„±ì›ì´ ìŠ¤ìŠ¤ë¡œ <u>ë‹¤ìŒ ì„±ì¥ì„ ìœ„í•œ ì‹¤í–‰ ì˜ì§€ì™€ êµ¬ì²´ì  ì‹¤í–‰ê³„íš</u>ì„ ìˆ˜ë¦½í•  ìˆ˜ ìˆë„ë¡ ë•ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤. 
    íŠ¹íˆ, ê¸ì •ì ì¸ í”¼ë“œë°±ê³¼ í–¥í›„ ë°œì „ ë°©í–¥ì„ í•¨ê»˜ ì œì‹œí•´ <u>ë™ê¸°ë¶€ì—¬</u>ë¥¼ ë†’ì´ëŠ” ê²ƒì´ íš¨ê³¼ì ì…ë‹ˆë‹¤.
  `,
  objection: `
    <b>ì´ì˜ì œê¸° ë©´ë‹´</b>ì€ GROW ëª¨ë¸ì„ ë³´ì™„ì ìœ¼ë¡œ í™œìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
    <b>Reality</b> ë‹¨ê³„ì—ì„œëŠ” êµ¬ì„±ì›ì´ ëŠë‚€ ë¶ˆí•©ë¦¬í•˜ê±°ë‚˜ ë‚©ë“í•˜ê¸° ì–´ë ¤ìš´ í‰ê°€ ê·¼ê±°ë¥¼ ì¶©ë¶„íˆ ê²½ì²­í•˜ê³ , 
    êµ¬ì²´ì ì¸ ì‚¬ë¡€ì™€ ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì‚¬ì‹¤ ê´€ê³„ë¥¼ ëª…í™•íˆ í•´ì•¼ í•©ë‹ˆë‹¤. 
    ì´ì–´ì„œ <b>Options</b> ë‹¨ê³„ì—ì„œëŠ” ë¬¸ì œ í•´ê²°ì„ ìœ„í•œ ëŒ€ì•ˆì„ í•¨ê»˜ ëª¨ìƒ‰í•  ìˆ˜ ìˆëŠ”ë°, ì´ëŠ” í‰ê°€ ì¬ê²€í† ë¿ë§Œ ì•„ë‹ˆë¼ í–¥í›„ ê°œì„ ì„ ìœ„í•œ í˜‘ì˜ê¹Œì§€ í¬í•¨ë©ë‹ˆë‹¤. 
    ë§ˆì§€ë§‰ìœ¼ë¡œ <b>Will</b> ë‹¨ê³„ì—ì„œëŠ” í–¥í›„ ìœ ì‚¬í•œ ê°ˆë“±ì„ ë°©ì§€í•  ìˆ˜ ìˆëŠ” í•©ì˜ì ì„ ì°¾ê³ , 
    ì¡°ì§ê³¼ êµ¬ì„±ì›ì´ í•¨ê»˜ ì‹ ë¢°ë¥¼ íšŒë³µí•  ìˆ˜ ìˆë„ë¡ ë§ˆë¬´ë¦¬í•˜ëŠ” ê²ƒì´ í•„ìš”í•©ë‹ˆë‹¤.
  `
};
    const learnMoreDescription = learnMoreDescriptions[currentStage] || '<p>íš¨ê³¼ì ì¸ ì„±ê³¼ê´€ë¦¬ ë©´ë‹´ì€ GROW ëª¨ë¸ì— ê¸°ë°˜í•˜ì—¬ ì§„í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>';

    const personaName = (currentMode === 'advanced' && customPersonaData?.name) ? customPersonaData.name : personas[currentPersona].name;

    const evaluationPrompt = `
ë‹¹ì‹ ì€ ì„¸ê³„ ìµœê³ ì˜ ì„±ê³¼ê´€ë¦¬ ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ì£¼ì–´ì§„ ë©´ë‹´ ëŒ€í™”ë¡ì„ ë¶„ì„í•˜ì—¬ ë¦¬ë”ì˜ ì„±ì¥ì„ ë•ê¸° ìœ„í•œ 3ë‹¨ê³„ ë¦¬í¬íŠ¸ë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”.
**ê²°ê³¼ëŠ” ë°˜ë“œì‹œ ì•„ë˜ì˜ [ê²°ê³¼ ì¶œë ¥ í˜•ì‹]ì„ ì •í™•íˆ ë”°ë¼ì„œ, êµ¬ë¶„ì(||BLOCK_SEPARATOR||)ë¥¼ í¬í•¨í•˜ì—¬ ìƒì„±í•´ì•¼ í•©ë‹ˆë‹¤.**

[ë©´ë‹´ ì •ë³´]
- ë©´ë‹´ ì¢…ë¥˜: ${currentStage} (${currentScenario||'ì¼ë°˜'})
- êµ¬ì„±ì›: ${personaName}

[ëŒ€í™”ë¡]
${transcript}
---
[ê°€ì¥ ì¤‘ìš”í•œ ì§€ì‹œì‚¬í•­: ë¦¬í¬íŠ¸ í˜•ì‹ ì¤€ìˆ˜]
- ë‹¹ì‹ ì˜ ë‹¤ë¥¸ ëª¨ë“  ì„ë¬´ë³´ë‹¤, ì§€ê¸ˆë¶€í„° ì„¤ëª…í•  **[í‰ê°€ ê¸°ì¤€]ê³¼ [ê²°ê³¼ ì¶œë ¥ í˜•ì‹]ì„ ì§€í‚¤ëŠ” ê²ƒì´ ê°€ì¥ ì¤‘ìš”**í•©ë‹ˆë‹¤.
- ë¦¬í¬íŠ¸ ë‚´ìš©ì´ ì¡°ê¸ˆ ë¶€ì •í™•í•´ì§€ë”ë¼ë„, **ì¶œë ¥ í˜•ì‹(íŠ¹íˆ '[CAT:...]' íƒœê·¸ 4ê°œì™€ '||BLOCK_SEPARATOR||' êµ¬ë¶„ì)ì€ ì™„ë²½í•´ì•¼ í•©ë‹ˆë‹¤.**
- ë§Œì•½ ëŒ€í™” ë‚´ìš©ì´ ë„ˆë¬´ ë³µì¡í•˜ì—¬ ëª¨ë“  ê·œì¹™ì„ ì§€í‚¤ê¸° ì–´ë µë‹¤ê³  íŒë‹¨ë˜ë©´, ë‹¤ë¥¸ ëª¨ë“  ê²ƒì„ í¬ìƒí•˜ë”ë¼ë„ **'[CAT:...]' íƒœê·¸ 4ê°œë¥¼ ì •í™•íˆ ì¶œë ¥í•˜ëŠ” ê²ƒì„ ìµœìš°ì„  ëª©í‘œ**ë¡œ ì‚¼ìœ¼ì„¸ìš”. ì´ íƒœê·¸ ìƒì„±ì´ ì‹¤íŒ¨í•˜ë©´ ë¦¬í¬íŠ¸ ì „ì²´ê°€ ì‹¤íŒ¨í•©ë‹ˆë‹¤.

[í‰ê°€ ê¸°ì¤€]
ë‹¹ì‹ ì€ ì•„ë˜ 4ê°€ì§€ ì˜ì—­ì— ëŒ€í•´ ì£¼ì–´ì§„ ê¸°ì¤€ì— ë”°ë¼ ë©´ë‹´ì„ í‰ê°€í•˜ê³ , ê° ì˜ì—­ì˜ ì‹ í˜¸ë“± ìƒ‰ìƒê³¼ 0~100ì  ì‚¬ì´ì˜ ì ìˆ˜ë¥¼ ë¶€ì—¬í•´ì•¼ í•©ë‹ˆë‹¤.

A. ê´€ê³„í˜•ì„±(ì‹ ë¢°Â·ì‹¬ë¦¬ì  ì•ˆì „)
- ì •ì˜: ê³µê°, ê²½ì²­, ìš”ì•½, ê°ì • ë¼ë²¨ë§ì„ í†µí•´ ëŒ€í™” ì•ˆì „ì§€ëŒ€ë¥¼ ë§Œë“œëŠ” ëŠ¥ë ¥.
- ê¸°ì¤€: ğŸŸ¢ (ê·¼ê±° 3ê°œ ì´ìƒ + ìš”ì•½Â·ë°˜ì˜ 2íšŒ ì´ìƒ), ğŸŸ¡ (ê·¼ê±° 1~2ê°œ ë˜ëŠ” ì¼ê´€ì„± ë¶€ì¡±), ğŸ”´ (ê³µê° ê²°ì—¬, ë‹¨ì •Â·ëª…ë ¹í˜• ë‹¤ìˆ˜)

B. ê³¼ì •ê´€ë¦¬(ë¬¸ì œì •ì˜Â·ì›ì¸Â·ê³„íš)
- ì •ì˜: ì‚¬ì‹¤ í™•ì¸â†’ì›ì¸ ê°€ì„¤â†’ëŒ€ì•ˆâ†’ìš°ì„ ìˆœìœ„â†’ì‹¤í–‰ê³„íšìœ¼ë¡œ ì´ì–´ì§€ëŠ” êµ¬ì¡°í™”.
- ê¸°ì¤€: ğŸŸ¢ (ë°ì´í„° ê·¼ê±° + ì‹¤í–‰ê³„íš ëª…í™•), ğŸŸ¡ (ì¼ë¶€ ëˆ„ë½), ğŸ”´ (êµ¬ì¡° ì—†ìŒ)

C. ì„±ê³¼ì°½ì¶œ(ê²°ê³¼Â·ì„íŒ©íŠ¸)
- ì •ì˜: ëª©í‘œì™€ ì—°ê³„ëœ ê²°ê³¼ ì§€í–¥ê³¼ ì±…ì„ê°.
- ê¸°ì¤€: ğŸŸ¢ (KPI ì—°ê³„ + ì ê²€ ì£¼ê¸° í•©ì˜), ğŸŸ¡ (KPI ì–¸ê¸‰ë§Œ ìˆê³  í›„ì† ë¯¸í¡), ğŸ”´ (ëª©í‘œ ë¶ˆëª…í™•, ì±…ì„ íšŒí”¼)

D. ì„±ì¥ì§€ì›(ì½”ì¹­Â·í”¼ë“œë°±Â·í•™ìŠµ)
- ì •ì˜: ì½”ì¹­ ì§ˆë¬¸, ê°•ì  í”¼ë“œë°±, ë¦¬ì†ŒìŠ¤ ì—°ê²°, í•™ìŠµÂ·ë¦¬í—ˆì„¤ ì§€ì›.
- ê¸°ì¤€: ğŸŸ¢ (ì½”ì¹­ ëŒ€í™” + ì„±ì¥ í–‰ë™ ì•½ì†), ğŸŸ¡ (ì¡°ì–¸ë§Œ ìˆê³  ì‹¤í—˜ ë¶€ì¬), ğŸ”´ (ì§€ì  ì¤‘ì‹¬, ë‚™ì¸ í‘œí˜„)

---
[ê²°ê³¼ ì¶œë ¥ í˜•ì‹]
[EVALUATION: SCORE=<ì¢…í•©ì ìˆ˜ëŠ” JSì—ì„œ ê³„ì‚°í•˜ë¯€ë¡œ 0ìœ¼ë¡œ ê³ ì •>, LIGHT=<ì¢…í•©ì‹ í˜¸ë“±ì€ JSì—ì„œ ê³„ì‚°í•˜ë¯€ë¡œ ì¤‘ë¦½ì ìœ¼ë¡œ ê³ ì •>]
[CAT:ê´€ê³„í˜•ì„±=<ì‚°ì¶œí•œ ìƒ‰ìƒ>,<ì‚°ì¶œí•œ ì ìˆ˜>]
[CAT:ê³¼ì •ê´€ë¦¬=<ì‚°ì¶œí•œ ìƒ‰ìƒ>,<ì‚°ì¶œí•œ ì ìˆ˜>]
[CAT:ì„±ê³¼ì°½ì¶œ=<ì‚°ì¶œí•œ ìƒ‰ìƒ>,<ì‚°ì¶œí•œ ì ìˆ˜>]
[CAT:ì„±ì¥ì§€ì›=<ì‚°ì¶œí•œ ìƒ‰ìƒ>,<ì‚°ì¶œí•œ ì ìˆ˜>]

ì²« ë²ˆì§¸ ë¸”ë¡ì—ëŠ” '[ë©´ë‹´ ëŒì•„ë³´ê¸°]' ë‚´ìš©ì„ ìƒì„±í•©ë‹ˆë‹¤. ë¨¼ì € ë©´ë‹´ ì „ì²´ ìƒí™©ì— ëŒ€í•œ ìš”ì•½ ë¬¸ë‹¨ì„ ìƒì„±í•œ ë’¤, 'ì£¼ìš” ê´€ì°° í¬ì¸íŠ¸'ì™€ 'ê°œì„  ì œì•ˆ'ì„ ê°ê°ì˜ HTML ì¹´ë“œë¡œ ë§Œë“¤ì–´ì£¼ì„¸ìš”.
[ë©´ë‹´ì˜ ì „ì²´ì ì¸ ìƒí™©ê³¼ ê²°ê³¼ë¥¼ 2~3ë¬¸ì¥ìœ¼ë¡œ ìš”ì•½]

<div class="tip-card-container">
  <div class="tip-card">
    <h5>ğŸ“ ì£¼ìš” ê´€ì°° í¬ì¸íŠ¸</h5>
    <ul>
      <li>[ë¦¬ë”ì˜ í–‰ë™ì´ë‚˜ êµ¬ì„±ì›ì˜ ë°˜ì‘ ë“± ê°ê´€ì  ì‚¬ì‹¤ 1]</li>
      <li>[ê°ê´€ì  ì‚¬ì‹¤ 2]</li>
    </ul>
  </div>
  <div class="tip-card">
    <h5>ğŸ’¡ ê°œì„  ì œì•ˆ</h5>
    <ul>
      <li>[ì•„ì‰¬ì› ë˜ ì ì„ ë³´ì™„í•  êµ¬ì²´ì ì¸ í–‰ë™ ë°©ì•ˆì´ë‚˜ ì§ˆë¬¸ ì˜ˆì‹œ 1]</li>
      <li>[í–‰ë™ ë°©ì•ˆ 2]</li>
    </ul>
  </div>
</div>
||BLOCK_SEPARATOR||
ë‘ ë²ˆì§¸ ë¸”ë¡ì—ëŠ” '[ë©´ë‹´ í‰ê°€]' ë‚´ìš©ì„ ì•„ë˜ì˜ HTML í˜•ì‹ì— ë§ì¶° ìƒì„±í•©ë‹ˆë‹¤.

<div class="evaluation-item">
  <strong>A. ê´€ê³„í˜•ì„± ([ì‚°ì¶œí•œ ì´ëª¨ì§€], [ì‚°ì¶œí•œ ì ìˆ˜]ì ):</strong>
  <p class="evaluation-description">[A í•­ëª©ì— ëŒ€í•œ ë‚´ìš© ì„œìˆ ]</p>
</div>
<div class="evaluation-item">
  <strong>B. ê³¼ì •ê´€ë¦¬ ([ì‚°ì¶œí•œ ì´ëª¨ì§€], [ì‚°ì¶œí•œ ì ìˆ˜]ì ):</strong>
  <p class="evaluation-description">[B í•­ëª©ì— ëŒ€í•œ ë‚´ìš© ì„œìˆ ]</p>
</div>
<div class="evaluation-item">
  <strong>C. ì„±ê³¼ì°½ì¶œ ([ì‚°ì¶œí•œ ì´ëª¨ì§€], [ì‚°ì¶œí•œ ì ìˆ˜]ì ):</strong>
  <p class="evaluation-description">[C í•­ëª©ì— ëŒ€í•œ ë‚´ìš© ì„œìˆ ]</p>
</div>
<div class="evaluation-item">
  <strong>D. ì„±ì¥ì§€ì› ([ì‚°ì¶œí•œ ì´ëª¨ì§€], [ì‚°ì¶œí•œ ì ìˆ˜]ì ):</strong>
  <p class="evaluation-description">[D í•­ëª©ì— ëŒ€í•œ ë‚´ìš© ì„œìˆ ]</p>
</div>

||BLOCK_SEPARATOR||
ì„¸ ë²ˆì§¸ ë¸”ë¡ì—ëŠ” '[ë©´ë‹´ ë°°ì›Œë³´ê¸° (Tip & Skill)]' ë‚´ìš©ì„ ìƒì„±í•©ë‹ˆë‹¤. ë¨¼ì € ì•„ë˜ì— ì œê³µëœ ì„¤ëª…ì„ ìµœìƒë‹¨ì— í¬í•¨í•œ ë’¤, 4ê°€ì§€ í•µì‹¬ ì—­ëŸ‰ì— ëŒ€í•œ íŒì„ HTML ì¹´ë“œ í˜•ì‹ìœ¼ë¡œ ìƒì„±í•´ì£¼ì„¸ìš”.

${learnMoreDescription}

ì•„ë˜ 4ê°€ì§€ í•µì‹¬ ì—­ëŸ‰ì— ëŒ€í•œ íŒì„ HTML ì¹´ë“œ í˜•ì‹ìœ¼ë¡œ ìƒì„±í•´ì£¼ì„¸ìš”.
ê° ì—­ëŸ‰ë³„ë¡œ 2ê°œì˜ ì‹¤í–‰ ê°€ëŠ¥í•œ íŒì„ ë¶ˆë¦¿ í¬ì¸íŠ¸(-)ë¡œ ìƒì„±í•©ë‹ˆë‹¤. ê° ì—­ëŸ‰ì˜ ì œëª©ì—ëŠ” ì—°ê´€ëœ ì´ëª¨ì§€ë¥¼ í¬í•¨í•´ì£¼ì„¸ìš”.
<div class="tip-card-container">
<div class="tip-card">
<h5>ğŸ¤ ê´€ê³„ í˜•ì„± (Rapport)</h5>
<ul>
- (ì‹¤í–‰ íŒ 1)
- (ì‹¤í–‰ íŒ 2)
</ul>
</div>
<div class="tip-card">
<h5>ğŸ¯ ì„±ê³¼ ê´€ë¦¬ (Performance)</h5>
<ul>
- (ì‹¤í–‰ íŒ 1)
- (ì‹¤í–‰ íŒ 2)
</ul>
</div>
<div class="tip-card">
<h5>ğŸ’¡ ì½”ì¹­ ìŠ¤í‚¬ (Coaching)</h5>
<ul>
- (ì‹¤í–‰ íŒ 1)
- (ì‹¤í–‰ íŒ 2)
</ul>
</div>
<div class="tip-card">
<h5>ğŸŒ± ì„±ì¥ ì§€ì› (Development)</h5>
<ul>
- (ì‹¤í–‰ íŒ 1)
- (ì‹¤í–‰ íŒ 2)
</ul>
</div>
</div>

**ë§¤ìš° ì¤‘ìš”: ê° ë¸”ë¡ì—ëŠ” '##'ì™€ ê°™ì€ ë§ˆí¬ë‹¤ìš´ ì œëª©ì´ë‚˜ ëŒ€ê´„í˜¸ ì œëª©ì„ ì ˆëŒ€ í¬í•¨í•˜ì§€ ë§ˆì„¸ìš”. ì˜¤ì§ ë³¸ë¬¸ ë‚´ìš©ë§Œ ì‘ì„±í•´ì•¼ í•©ë‹ˆë‹¤.**
`;

try {
    const res = await fetch(GEMINI_API_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            contents: [{ role: 'user', parts: [{ text: evaluationPrompt }] }],
            generationConfig: { temperature: 0.7, maxOutputTokens: 4096 }
        })
    });
    if (!res.ok) throw new Error(`API Error: ${res.status}`);
    
    const data = await res.json();
    const evaluationText = data.candidates[0].content.parts[0].text;
    // 1. ë©´ë‹´ ë‹¨ê³„ë³„ ê°€ì¤‘ì¹˜ ì •ì˜
    const weights = {
        goal: { 'ê´€ê³„í˜•ì„±': 0.20, 'ê³¼ì •ê´€ë¦¬': 0.40, 'ì„±ê³¼ì°½ì¶œ': 0.10, 'ì„±ì¥ì§€ì›': 0.30 },
        feedback: { 'ê´€ê³„í˜•ì„±': 0.20, 'ê³¼ì •ê´€ë¦¬': 0.35, 'ì„±ê³¼ì°½ì¶œ': 0.20, 'ì„±ì¥ì§€ì›': 0.25 },
        evaluation: { 'ê´€ê³„í˜•ì„±': 0.15, 'ê³¼ì •ê´€ë¦¬': 0.25, 'ì„±ê³¼ì°½ì¶œ': 0.40, 'ì„±ì¥ì§€ì›': 0.20 }
    };
    const currentWeights = weights[currentStage] || weights['feedback']; // ê¸°ë³¸ê°’ì€ ì¤‘ê°„í”¼ë“œë°±

    // 2. AIê°€ í‰ê°€í•œ ì¹´í…Œê³ ë¦¬ë³„ ì ìˆ˜ì™€ ì‹ í˜¸ë“± íŒŒì‹±
    const categories = {};
    let hasRedSignal = false;
    const regex = /\[CAT:([^=]+)=([^,]+),(\d+)\]/g;
    let match;
    while ((match = regex.exec(evaluationText)) !== null) {
        const name = match[1].trim();
        const lightKR = match[2].trim();
        const score = parseInt(match[3], 10);
        const light = lightKR.startsWith('ë…¹') ? 'green' : (lightKR.startsWith('í™©') ? 'yellow' : 'red');
        
        categories[name] = { score, light };
        if (light === 'red') {
            hasRedSignal = true;
        }
    }

    // 3. ê°€ì¤‘ì¹˜ë¥¼ ì ìš©í•˜ì—¬ ì¢…í•© ì ìˆ˜ ê³„ì‚°
    let totalScore = 0;
    for (const name in categories) {
        if (currentWeights[name]) {
            totalScore += categories[name].score * currentWeights[name];
        }
    }
    totalScore = Math.round(totalScore);

    // 4. ì¢…í•© ì‹ í˜¸ë“± ê²°ì • (ì•ˆì „ì¥ì¹˜ ì ìš©)
    let finalLight = 'green';
    if (totalScore < 80) finalLight = 'yellow';
    if (totalScore < 60) finalLight = 'red';
    if (hasRedSignal && finalLight === 'green') {
        finalLight = 'yellow'; // ì•ˆì „ì¥ì¹˜: ë¹¨ê°„ ì‹ í˜¸ê°€ í•˜ë‚˜ë¼ë„ ìˆìœ¼ë©´ ì¢…í•©ì€ ìµœëŒ€ ë…¸ë€ìƒ‰
    }

    // 5. ê³„ì‚°ëœ ìµœì¢… ì ìˆ˜ì™€ ì‹ í˜¸ë“±ì„ UIì— ë°˜ì˜
    const trafficLight = document.getElementById('trafficLight');
    const evaluationScore = document.getElementById('evaluationScore');

    if (trafficLight && evaluationScore) {
      evaluationScore.textContent = `ì¢…í•© ì ìˆ˜: ${totalScore}ì `;
     trafficLight.className = 'traffic-light'; // ì´ˆê¸°í™”
     trafficLight.classList.add(finalLight);
    }
    // ì¹´í…Œê³ ë¦¬ ë³´ë“œ ë Œë”ë§
    const catsToRender = Object.keys(categories).map(name => ({
        name: name,
        light: categories[name].light,
        score: categories[name].score
    }));
    renderCategoryBoard(catsToRender);
    
    // --- [ìƒˆë¡œìš´ ì ìˆ˜ ê³„ì‚° ë¡œì§ ë] ---

    // 3ë‹¨ ë¸”ë¡ìœ¼ë¡œ ë‚´ìš© ë¶„ë¦¬ ë° í‘œì‹œ (ê¸°ì¡´ê³¼ ë™ì¼)
    const contentOnly = evaluationText.replace(/\[(EVALUATION|CAT):[^\]]+\]/g, '').trim();
    const blocks = contentOnly.split('||BLOCK_SEPARATOR||');
    
// endChat() ë§ˆì§€ë§‰ì˜ ë Œë” ë¶€ë¶„ ìˆ˜ì •
document.getElementById('reportBlock1').innerHTML = blocks[0] || 'ë‚´ìš© ì—†ìŒ';
document.getElementById('reportBlock2').innerHTML = blocks[1] || 'ë‚´ìš© ì—†ìŒ';
document.getElementById('reportBlock3').innerHTML = blocks[2] || '<p>í•™ìŠµ ë‚´ìš©ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</p>';

} catch (e) {
    console.error('EndChat Error:', e);
    document.getElementById('reportBlock1').textContent = 'ë¦¬í¬íŠ¸ ìƒì„± ì¤‘ ì˜¤ë¥˜: ' + e.message;
} finally {
    // ë¡œë”© ëë‚˜ë©´ UI ìš”ì†Œë“¤ ë‹¤ì‹œ í‘œì‹œ
    loadingIndicator.style.display = 'none';
    if(signalArea) signalArea.style.display = 'flex';
    if(categoryBoard) categoryBoard.style.display = 'grid';
    if(actionButtons) actionButtons.style.display = 'flex';
    if(reportContainer) reportContainer.style.display = 'flex';
}
    }

// ë‚´ë³´ë‚´ê¸°ìš© í…ìŠ¤íŠ¸ ë¹Œë” ì¶”ê°€
function getReportPlainText() {
  const t = [
    '## 1. ë©´ë‹´ ëŒì•„ë³´ê¸°', document.getElementById('reportBlock1').innerText.trim(),
    '## 2. ë©´ë‹´ í‰ê°€',     document.getElementById('reportBlock2').innerText.trim(),
    '## 3. ë©´ë‹´ ë°°ì›Œë³´ê¸°', document.getElementById('reportBlock3').innerText.trim()
  ].join('\n\n');
  return t.replace(/\n{3,}/g, '\n\n').trim();
}

// êµì²´: downloadSummary() / emailSummary()
function downloadSummary() {
  const text = getReportPlainText();
  const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob); a.download = 'ë©´ë‹´ê²°ê³¼_ìš”ì•½.txt'; a.click(); URL.revokeObjectURL(a.href);
}
function emailSummary() {
  const text = getReportPlainText();
  const subject = encodeURIComponent('ì„±ê³¼ê´€ë¦¬ ë©´ë‹´ ê²°ê³¼ ìš”ì•½');
  const body = encodeURIComponent('ì•ˆë…•í•˜ì„¸ìš”.\n\në©´ë‹´ ê²°ê³¼ ìš”ì•½ì„ ê³µìœ ë“œë¦½ë‹ˆë‹¤.\n\n---\n\n' + text);
  window.location.href = `mailto:?subject=${subject}&body=${body}`;
}



// ë§ˆí¬ë‹¤ìš´ ì œê±° ë° ê°€ë…ì„± í–¥ìƒ í•¨ìˆ˜ (í…ìŠ¤íŠ¸ ì²˜ë¦¬)
function cleanReportMarkdown(text) {
    let cleanedText = text.replace(/##\s*.+\n/g, '') // ## í—¤ë” ì œê±°
                            .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>') // **êµµì€ ê¸€ì”¨** HTML <strong> íƒœê·¸ë¡œ ë³€ê²½
                            .replace(/-\s(.+)/g, '<li>$1</li>') // - ëª©ë¡ì„ <li>ë¡œ ë³€ê²½
                            .replace(/\n\n-\s/g, '\n\n<li>') // ëª©ë¡ ì‹œì‘ ì „ ì¤„ë°”ê¿ˆ ì²˜ë¦¬
                            .replace(/\n\s*(\d+\.)\s*(.+)/g, '\n<li>$1 $2</li>') // 1. 2. ëª©ë¡ì„ <li>ë¡œ ë³€ê²½
                            .replace(/\n\n/g, '<p></p>') // ì´ì¤‘ ì¤„ë°”ê¿ˆì€ ë¬¸ë‹¨ìœ¼ë¡œ
                            .replace(/\n/g, '<br>') // ë‹¨ì¼ ì¤„ë°”ê¿ˆì€ <br>ë¡œ
                            .replace(/<li>/g, '<ul><li>') // ul íƒœê·¸ë¡œ ê°ì‹¸ê¸°
                            .replace(/<\/li><p><\/p><ul><li>/g, '</li></ul><p></p><ul><li>') // ëª©ë¡ ì¤‘ê°„ì— ë¬¸ë‹¨ì´ ë¼ëŠ” ê²½ìš° ë°©ì§€
                            .replace(/<\/li><br><ul><li>/g, '</li></ul><br><ul><li>'); // ëª©ë¡ ì¤‘ê°„ì— brì´ ë¼ëŠ” ê²½ìš° ë°©ì§€

    // ìµœì¢…ì ìœ¼ë¡œ ul íƒœê·¸ê°€ ì—´ë ¤ìˆëŠ”ë° ë‹«íˆì§€ ì•Šì€ ê²½ìš° ì²˜ë¦¬
    if (cleanedText.includes('<ul>') && !cleanedText.includes('</ul>')) {
        cleanedText += '</ul>';
    }
    // ì‹œì‘í•˜ëŠ” <p></p> ì œê±°
    cleanedText = cleanedText.replace(/^<p><\/p>/, '');

    // ë³¸ë¬¸ ì‹œì‘ ì‹œ ë„ì–´ì“°ê¸°(ë“¤ì—¬ì“°ê¸°) ì ìš© - GPT ì¶œë ¥ì— ë”°ë¼ ìœ ë™ì ìœ¼ë¡œ ì¡°ì •
    cleanedText = cleanedText.replace(/(\n|^)(?!<p>|<ul>|<strong>|<li>)/g, '$1&nbsp;&nbsp;');

    return cleanedText;
}
   


    
    // ===== DOM READY & ADVANCED FORM SUBMIT =====
    document.addEventListener('DOMContentLoaded', () => {
      showScreen('hero');
      var sb = document.getElementById('startBtn');
      if (sb){ sb.addEventListener('click', function(e){ e.preventDefault(); goToPersonaSelection(); }); }

      function setupCustomInput(selectId, inputId) {
        const select = document.getElementById(selectId);
        const input = document.getElementById(inputId);
        if (!select || !input) return;
        select.addEventListener('change', function() {
          input.classList.toggle('hidden', this.value !== 'custom');
        });
      }
      setupCustomInput('advPersonalityStrengthsSelect', 'advPersonalityStrengthsCustom');
      setupCustomInput('advPersonalityWeaknessesSelect', 'advPersonalityWeaknessesCustom');
      setupCustomInput('advWorkStrengthsSelect', 'advWorkStrengthsCustom');
      setupCustomInput('advWorkWeaknessesSelect', 'advWorkWeaknessesCustom');

      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SpeechRecognition) {
        const rb = document.getElementById('recordButton'); if (rb) rb.style.display = 'none';
      } else {
        const recognition = new SpeechRecognition();
        const recordButton = document.getElementById('recordButton');
        const recordStatus = document.getElementById('recordStatus');
        const textInput = document.getElementById('text');
        recognition.continuous = false; recognition.interimResults = true; recognition.lang = 'ko-KR';
        recordButton.addEventListener('click', () => { if (recordButton.classList.contains('recording')) recognition.stop(); else recognition.start(); });
        recognition.onstart = () => { recordButton.classList.add('recording'); recordStatus.textContent = 'ìŒì„± ì¸ì‹ ì¤‘...'; };
        recognition.onend = () => { recordButton.classList.remove('recording'); recordStatus.textContent = ''; };
        recognition.onerror = (e) => { recordStatus.textContent = 'ì˜¤ë¥˜: ' + e.error; };
        recognition.onresult = (e) => {
          let finalTranscript = '';
          for (let i = e.resultIndex; i < e.results.length; ++i) { if (e.results[i].isFinal) finalTranscript += e.results[i][0].transcript; }
          if (finalTranscript) textInput.value += finalTranscript;
        };
      }
    });

    function submitAdvancedPersona() {
      function getCustomValue(selectId, inputId) {
        const select = document.getElementById(selectId);
        return select.value === 'custom' ? document.getElementById(inputId).value : select.value;
      }
      const performanceSelect = document.getElementById('advPerformance');
      const performanceValue = performanceSelect.value;
      const performanceText = performanceSelect.options[performanceSelect.selectedIndex].text;
      const performanceDetailText = document.getElementById('advPerformanceDetail').options[document.getElementById('advPerformanceDetail').selectedIndex].text;
      const autoGeneratedName = `${performanceDetailText} ${performanceText}`;
      customPersonaData = {
        name: autoGeneratedName,
        role: document.getElementById('advRole').value,
        rank: document.getElementById('advRank').value,
        years: document.getElementById('advYears').value,
        job: document.getElementById('advJob').value,
        performance: performanceValue,
        personality: `ì¥ì : ${getCustomValue('advPersonalityStrengthsSelect', 'advPersonalityStrengthsCustom')}, ë‹¨ì : ${getCustomValue('advPersonalityWeaknessesSelect', 'advPersonalityWeaknessesCustom')}`,
        extra: `ì—…ë¬´ íŠ¹ì„± - ì¥ì : ${getCustomValue('advWorkStrengthsSelect', 'advWorkStrengthsCustom')}, ë‹¨ì : ${getCustomValue('advWorkWeaknessesSelect', 'advWorkWeaknessesCustom')} / íŠ¹ì´ì‚¬í•­ - ${document.getElementById('advNotablePoints').value}`
      };
      currentPersona = performanceValue;
      useCustomAvatar = true; 
      currentMode = 'advanced';
      showScreen('stageSelection');
    }

</script>
</body>
</html>